# 📋 TASK_20250815_01: 트리거 빌더 실제 기능 구현

## 🎯 목표
Phase 4에서 구축한 UI 구조와 DDD 레이어를 기반으로 실제 동작하는 기능 구현
조건 빌더부터 시작하여 단계별로 견고한 기능을 구현하고 실제 데이터 연동 완성

---

## 🔍 **현재 상태 분석**

### ✅ **이미 준비된 인프라**
- **UI 구조**: 3x2 그리드 레이아웃, 6개 영역 모든 위젯 생성 완료
- **DDD 레이어**: Domain/Infrastructure/Application/UI 4계층 구조 완성
- **MVP 패턴**: Presenter-View-Widget 구조 완료 
- **데이터베이스**: 28개 변수 SQLite DB, 시뮬레이션 데이터 2,862개 레코드
- **UseCase**: TradingVariableUseCase, SimulationDataUseCase 준비 완료

### 🔧 **실제 구현 필요 사항**
1. **조건 빌더 기능**: 변수 선택 → 파라미터 입력 → 조건 생성 플로우
2. **시뮬레이션 연동**: 실제 데이터 로드 → 차트 표시 → 결과 분석
3. **트리거 관리**: 조건 저장 → 목록 표시 → 상세 보기
4. **데이터 소스**: 4가지 소스 타입 실제 동작
5. **에러 처리**: 견고한 예외 처리 및 사용자 피드백

---

## 🚀 **구현 단계별 계획**

### 📊 **Phase 1: 조건 빌더 기능 완전 구현 (1-2일)**

#### 🎯 **1.1 변수 선택 및 파라미터 입력 연동**
- [ ] **변수 콤보박스 실제 데이터 바인딩**
  - [ ] TradingVariableListDTO → UI 콤보박스 연동
  - [ ] 28개 변수 카테고리별 필터링 구현
  - [ ] 검색 기능 실제 동작 구현
- [ ] **파라미터 입력 위젯 동적 생성**
  - [ ] TradingVariableDetailDTO → 파라미터 필드 동적 생성
  - [ ] 타입별 입력 검증 (integer/decimal/boolean/string)
  - [ ] 기본값 설정 및 유효성 검사
- [ ] **시그널 체인 완전 구현**
  - [ ] VariableSelector → ParameterInput → ConditionPreview 연동
  - [ ] 실시간 미리보기 업데이트

#### 🎯 **1.2 조건 미리보기 및 생성**
- [ ] **조건 미리보기 실시간 업데이트**
  - [ ] 사용자 입력 시 즉시 조건 텍스트 생성
  - [ ] 문법 검증 및 오류 표시
  - [ ] 조건 복잡도 표시 (Simple/Medium/Complex)
- [ ] **조건 생성 및 검증**
  - [ ] Domain Layer Condition Entity 생성
  - [ ] ConditionValidationService 실제 검증
  - [ ] 생성된 조건 임시 저장

#### 🎯 **1.3 에러 처리 및 UX 개선**
- [ ] **입력 검증 강화**
  - [ ] 필수 필드 검증
  - [ ] 파라미터 범위 검증  
  - [ ] 실시간 오류 메시지 표시
- [ ] **로딩 상태 표시**
  - [ ] 변수 로드 시 프로그레스바
  - [ ] 조건 검증 시 로딩 인디케이터
  - [ ] 네트워크 지연 대응

---

### 🧪 **Phase 2: 시뮬레이션 시스템 실제 구현 (2-3일)**

#### 🎯 **2.1 데이터 소스 선택기 실제 동작**
- [ ] **4가지 데이터 소스 구현**
  - [ ] `embedded`: 내장 최적화 데이터
  - [ ] `synthetic`: 합성 현실적 데이터  
  - [ ] `fallback`: 단순 폴백 데이터
  - [ ] `real_data`: 실제 sampled_market_data.sqlite3 (현재 구현됨)
- [ ] **소스 전환 시 실시간 업데이트**
  - [ ] 라디오 버튼 변경 시 즉시 차트 업데이트
  - [ ] 데이터 로딩 상태 표시
  - [ ] 실패 시 폴백 처리

#### 🎯 **2.2 시나리오별 시뮬레이션 완전 구현**
- [ ] **5개 시나리오 버튼 실제 동작**
  - [ ] 급등/상승추세/횡보/하락추세/급락 시나리오
  - [ ] LoadSimulationDataUseCase → 실제 데이터 로드
  - [ ] 시나리오별 세그멘테이션 로직 개선
- [ ] **차트 실시간 업데이트**
  - [ ] matplotlib → PyQt6 Canvas 통합
  - [ ] 가격/수익률/거래량 3개 차트 동시 표시
  - [ ] 기술적 지표 오버레이 (SMA, RSI)
- [ ] **로그 시스템 구현**
  - [ ] 시뮬레이션 진행 과정 실시간 로그
  - [ ] 계산 결과 상세 로그
  - [ ] 로그 저장 및 내보내기

#### 🎯 **2.3 성능 최적화**
- [ ] **대용량 데이터 처리 최적화**
  - [ ] 2,862개 레코드 실시간 처리
  - [ ] pandas DataFrame 메모리 최적화
  - [ ] 차트 렌더링 성능 개선
- [ ] **비동기 처리 도입**
  - [ ] UI 블로킹 방지
  - [ ] 백그라운드 데이터 로드
  - [ ] 취소 가능한 작업

---

### 📝 **Phase 3: 트리거 관리 시스템 구현 (1-2일)**

#### 🎯 **3.1 트리거 저장 및 목록 관리**
- [ ] **트리거 저장 기능**
  - [ ] 조건 빌더에서 생성한 조건 → 트리거 저장
  - [ ] SQLite strategies 테이블 연동
  - [ ] 중복 트리거 검증
- [ ] **트리거 목록 표시**
  - [ ] QTreeWidget 실제 데이터 바인딩
  - [ ] 3컬럼 (트리거명/변수/조건) 표시
  - [ ] 정렬 및 필터링 기능

#### 🎯 **3.2 트리거 상세 정보 및 편집**
- [ ] **트리거 선택 시 상세 표시**
  - [ ] TriggerDetailWidget 실제 정보 표시
  - [ ] JSON 형태 상세 뷰어
  - [ ] 클립보드 복사 기능
- [ ] **트리거 편집 및 삭제**
  - [ ] 기존 트리거 수정 기능
  - [ ] 삭제 확인 다이얼로그
  - [ ] 변경 이력 추적

#### 🎯 **3.3 트리거 검색 및 필터링**
- [ ] **검색 기능 구현**
  - [ ] 트리거명/변수명/조건으로 검색
  - [ ] 실시간 검색 결과 표시
  - [ ] 검색 히스토리 저장
- [ ] **필터링 기능**
  - [ ] 변수 타입별 필터
  - [ ] 생성일/수정일 필터
  - [ ] 복잡도별 필터

---

### 🔧 **Phase 4: 통합 테스트 및 품질 보증 (1일)**

#### 🎯 **4.1 전체 워크플로우 테스트**
- [ ] **End-to-End 테스트**
  - [ ] 변수 선택 → 조건 생성 → 트리거 저장 → 시뮬레이션 전체 플로우
  - [ ] 모든 시나리오 조합 테스트
  - [ ] 에러 케이스 처리 검증
- [ ] **성능 벤치마크**
  - [ ] 28개 변수 로드 시간 측정
  - [ ] 2,862개 데이터 처리 시간 측정
  - [ ] 메모리 사용량 프로파일링

#### 🎯 **4.2 사용자 경험 개선**
- [ ] **반응성 개선**
  - [ ] 모든 UI 상호작용 100ms 이내 반응
  - [ ] 로딩 상태 명확한 표시
  - [ ] 프로그레스 인디케이터 정확성
- [ ] **에러 메시지 개선**
  - [ ] 사용자 친화적 오류 메시지
  - [ ] 해결 방법 제시
  - [ ] 로그 레벨별 구분

#### 🎯 **4.3 문서화 및 유지보수성**
- [ ] **코드 문서화**
  - [ ] 모든 public 메소드 독스트링
  - [ ] 복잡한 로직 인라인 주석
  - [ ] 아키텍처 다이어그램 업데이트
- [ ] **테스트 코드 작성**
  - [ ] UseCase 단위 테스트
  - [ ] Repository 통합 테스트
  - [ ] UI 위젯 테스트

---

## 📊 **현재 파일 구조 분석**

### 🔍 **구현 필요 파일들**

#### **조건 빌더 관련**
```
shared/components/condition_builder/
├── condition_builder_widget.py          # ✅ 구조 완성, 🔧 기능 구현 필요
├── variable_selector_widget.py          # ✅ 구조 완성, 🔧 데이터 바인딩 필요  
├── parameter_input_widget.py            # ✅ 구조 완성, 🔧 동적 생성 구현 필요
└── condition_preview_widget.py          # ✅ 구조 완성, 🔧 실시간 업데이트 필요
```

#### **시뮬레이션 관련**
```
tabs/trigger_builder/widgets/
├── simulation_control_widget.py         # ✅ 구조 완성, 🔧 실제 연동 필요
└── simulation_result_widget.py          # ✅ 구조 완성, 🔧 차트 업데이트 필요

shared/components/
├── data_source_selector.py              # ✅ 구조 완성, 🔧 4가지 소스 구현 필요
└── simple_data_source_selector.py       # 🗑️ 제거 예정 (단순화된 버전)
```

#### **트리거 관리 관련**
```
tabs/trigger_builder/widgets/
├── trigger_list_widget.py               # ✅ 구조 완성, 🔧 데이터 바인딩 필요
└── trigger_detail_widget.py             # ✅ 구조 완성, 🔧 상세 표시 구현 필요
```

#### **Application Layer**
```
application/use_cases/simulation/
└── load_simulation_data_use_case.py     # ✅ 구조 완성, 🔧 성능 최적화 필요

application/use_cases/trigger_builder/
└── trading_variable_use_cases.py        # ✅ 구조 완성, 🔧 검색 기능 개선 필요
```

---

## 🎯 **성공 기준**

### 🔥 **최우선 완료 기준**
1. **조건 빌더 완전 동작**: 변수 선택 → 파라미터 입력 → 조건 생성 → 미리보기 전체 플로우
2. **시뮬레이션 실제 연동**: 5개 시나리오 × 4개 데이터 소스 = 20가지 조합 모두 동작
3. **성능 요구사항**: 변수 로드 < 1초, 시뮬레이션 실행 < 2초, UI 반응 < 100ms
4. **견고성**: 모든 에러 케이스에서 적절한 메시지 및 복구 제공

### 🎨 **품질 기준**
```
기능 완전성:
🎯 28개 변수 모두 정상 로드 및 파라미터 입력
🎯 5개 시나리오 모두 실제 데이터로 시뮬레이션
🎯 트리거 CRUD 완전 동작 (생성/읽기/수정/삭제)
🎯 검색/필터링 실시간 동작

성능 목표:
🎯 초기 로딩: < 2초
🎯 변수 선택: < 500ms  
🎯 시뮬레이션 실행: < 3초
🎯 메모리 사용량: < 200MB

사용자 경험:
🎯 모든 버튼/입력 즉시 반응
🎯 로딩 상태 명확한 표시
🎯 에러 발생 시 명확한 안내
🎯 데이터 없을 시 적절한 폴백
```

### 🔧 **기술적 품질 기준**
```
코드 품질:
✅ DDD 4계층 의존성 방향 준수
✅ MVP 패턴 완전 적용 (Passive View)
✅ UseCase 단위 테스트 90% 커버리지
✅ 모든 public API 독스트링 완비

아키텍처 품질:
✅ 단일 책임 원칙 준수
✅ 인터페이스 분리 원칙 준수  
✅ 의존성 역전 원칙 준수
✅ 확장에 열림, 수정에 닫힘 원칙 준수
```

---

## 📋 **체크리스트**

### 🎯 **Phase 1: 조건 빌더 (1-2일)**
- [ ] 변수 콤보박스 실제 데이터 바인딩 완료
- [ ] 파라미터 입력 위젯 동적 생성 완료
- [ ] 조건 미리보기 실시간 업데이트 완료
- [ ] 입력 검증 및 에러 처리 완료
- [ ] 시그널 체인 완전 동작 확인

### 🎯 **Phase 2: 시뮬레이션 시스템 (2-3일)**  
- [ ] 4가지 데이터 소스 모두 동작 확인
- [ ] 5개 시나리오 실제 데이터 로드 확인
- [ ] 차트 실시간 업데이트 완료
- [ ] 로그 시스템 구현 완료
- [ ] 성능 최적화 (< 3초 목표) 달성

### 🎯 **Phase 3: 트리거 관리 (1-2일)**
- [ ] 트리거 저장/로드 기능 완료
- [ ] 트리거 목록 실제 데이터 표시 완료
- [ ] 트리거 상세 정보 표시 완료
- [ ] 검색/필터링 기능 완료
- [ ] 편집/삭제 기능 완료

### 🎯 **Phase 4: 통합 테스트 (1일)**
- [ ] End-to-End 워크플로우 테스트 통과
- [ ] 성능 벤치마크 목표 달성
- [ ] 사용자 경험 개선 완료
- [ ] 문서화 및 테스트 코드 완성

---

## 🔄 **이전 태스크와의 관계**

### ✅ **TASK_20250814_09 완료 처리**
- Phase 4는 UI 구조와 DDD 레이어 구축으로 **완료** 처리
- 실제 기능 구현은 별도 태스크 (본 태스크)로 분리

### 🔗 **활용 가능한 기존 인프라**
- **UI 레이아웃**: 3x2 그리드, 6개 영역 그대로 활용
- **DDD 구조**: Domain/Infrastructure/Application/UI 그대로 활용
- **MVP 패턴**: Presenter-View-Widget 구조 그대로 활용
- **데이터베이스**: 28개 변수, 시뮬레이션 데이터 그대로 활용

### 🎯 **차별점**
- 이전: 구조 구축 및 스크린샷 기반 UI 복제
- 현재: **실제 동작하는 기능** 구현 및 데이터 연동

---

## 📌 **핵심 전략**

**🎯 실용적 접근**: 완벽한 이론보다는 실제 동작하는 기능 우선  
**🔧 점진적 구현**: 조건 빌더 → 시뮬레이션 → 트리거 관리 순서로 단계별 완성  
**🧪 지속적 테스트**: 각 단계마다 실제 동작 확인 후 다음 단계 진행  
**📊 성능 중심**: 모든 기능이 사용자 기대 시간 내에 동작하도록 최적화  

**🎉 최종 목표**: 사용자가 실제로 조건을 만들고, 시뮬레이션을 실행하고, 트리거를 관리할 수 있는 완전한 기능!
