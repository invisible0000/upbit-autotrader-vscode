# π“‹ TASK_20250820_03: Market Data Storage κ°λ°

## π― νƒμ¤ν¬ λ©ν‘
- **μ£Όμ” λ©ν‘**: λ§μΌ“ λ°μ΄ν„°μ μμ†μ„±, μΊμ‹±, λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤ ν†µν•© μΈν„°νμ΄μ¤ μ κ³µ
- **μ™„λ£ κΈ°μ¤€**: μ¤ν¬λ¦¬λ„, λ°±ν…μ¤ν„° λ“±μ΄ ν†µν•©λ μΈν„°νμ΄μ¤λ΅ ν¨μ¨μ μΌλ΅ λ°μ΄ν„°μ— μ ‘κ·Όν•  μ μλ” μ‹μ¤ν…

## π“ ν„μ¬ μƒν™© λ¶„μ„ (μ—…λ°μ΄νΈ: 2025-08-20)
### β… **μμ΅΄μ„± νƒμ¤ν¬ ν„μ¬ μƒν™©**
- **TASK_20250820_01**: Phase 1 μ™„λ£ β… (WebSocket μ¥μ• λ³µκµ¬, μ¤λƒ…μƒ·/μ‹¤μ‹κ°„ κµ¬λ¶„)
- **TASK_20250820_02**: Phase 1 μ¤€λΉ„ μ™„λ£ β… (λ³‘ν–‰ κ°λ° κ°€λ¥)
- **3λ² νƒμ¤ν¬ μ‹μ‘ μ΅°κ±΄**: 2λ² νƒμ¤ν¬μ™€ λ…λ¦½μ  λ³‘ν–‰ κ°λ° κ°€λ¥

### Storage Layerμ μ—­ν•  μ •μ (Layer 3)
- **Layer 3 ν¬μ§€μ…**: κ°€μ¥ μƒμ„ λ μ΄μ–΄, λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤μ™€ μ§μ ‘ μ—°κ²°
- **μ„ νƒμ  μμ†μ„±**: μΊ”λ“¤ λ°μ΄ν„°λ§ DB μ €μ¥, μ‹¤μ‹κ°„ λ°μ΄ν„°λ” λ©”λ¨λ¦¬ μΊμ‹λ§
- **μΊμ‹± μ „λµ**: λ©”λ¨λ¦¬/λ””μ¤ν¬ μΊμ‹, λ§λ£ μ •μ±… (λ°μ΄ν„° νƒ€μ…λ³„ μ°¨λ³„ν™”)
- **λ‹¤μ¤‘ API μΈν„°νμ΄μ¤**: μΊ”λ“¤(DB+μΊμ‹), ν‹°μ»¤/νΈκ°€μ°½/μ²΄κ²°(λ©”λ¨λ¦¬λ§)
- **λ‹¨μν• λ°μ΄ν„° μ κ³µ**: λ³µμ΅ν• μµμ ν™” μ—†μ΄ μμν• λ°μ΄ν„° μ €μ¥/μ΅°νλ§ λ‹΄λ‹Ή
- **Smart Router μ—°λ™**: WebSocket μ¥μ• λ³µκµ¬ μ‹μ¤ν…κ³Ό ν‘λ ¥ν•μ—¬ μ•μ •μ  λ°μ΄ν„° μ €μ¥

### ν•µμ‹¬ κΈ°λ¥ μ”κµ¬μ‚¬ν•­
1. **μΊ”λ“¤ λ°μ΄ν„° μμ†μ„±**: OHLCV λ°μ΄ν„°μ ν¨μ¨μ  DB μ €μ¥ (λ°±ν…μ¤νΈ, μ°¨νΈμ©)
2. **μ‹¤μ‹κ°„ λ°μ΄ν„° μΊμ‹±**: ν‹°μ»¤/νΈκ°€μ°½/μ²΄κ²°μ λ©”λ¨λ¦¬ μΊμ‹ (DB μ €μ¥ μ—†μ)
3. **λΉ λ¥Έ μ΅°ν**: μΊ”λ“¤ DB μΈλ±μ¤ μµμ ν™”, μ‹¤μ‹κ°„ λ°μ΄ν„° λ©”λ¨λ¦¬ μ•΅μ„Έμ¤
4. **μ¦λ¶„ μ—…λ°μ΄νΈ**: κΈ°μ΅΄ μΊ”λ“¤ λ°μ΄ν„°μ— μƒ λ°μ΄ν„° ν¨μ¨μ  μ¶”κ°€
5. **λ°μ΄ν„° μ •ν•©μ„±**: μΊ”λ“¤ λ°μ΄ν„° νΈλμ­μ…, λ°±μ—…, λ³µκµ¬ (μ‹¤μ‹κ°„ λ°μ΄ν„°λ” μ μ™Έ)

## π’Ύ Storage Layer λ°μ΄ν„° μ •μ±…

### β… **DB μμ†μ„± λ€μƒ (market_data.sqlite3)**
- **μΊ”λ“¤ λ°μ΄ν„° (OHLCV)**
  - **ν…μ΄λΈ”**: candles (symbol, timeframe, timestamp, open, high, low, close, volume)
  - **μΈλ±μ¤**: (symbol, timeframe, timestamp) λ³µν•© μΈλ±μ¤
  - **ννΈν™” κ΄€λ¦¬**: μλ™ VACUUM, μΈλ±μ¤ μ¬κµ¬μ„±, ν†µκ³„ μ—…λ°μ΄νΈ
  - **μ‚¬μ©μ²**: λ°±ν…μ¤νΈ, μ°¨νΈ ν‘μ‹, κΈ°μ μ  λ¶„μ„

### π”„ **λ©”λ¨λ¦¬ μΊμ‹ λ€μƒ**
- **ν‹°μ»¤ λ°μ΄ν„°**: ν„μ¬κ°€, λ³€λ™λ¥  (TTL: 5λ¶„)
- **νΈκ°€μ°½ λ°μ΄ν„°**: λ§¤μ/λ§¤λ„ νΈκ°€ (TTL: 30μ΄)
- **μ²΄κ²° λ°μ΄ν„°**: μµκ·Ό κ±°λ λ‚΄μ—­ (TTL: 10λ¶„)

### π« **Storageμ—μ„ μ μ™Έ**
- **μ „λµ μ‹¤ν–‰ λ°μ΄ν„°**: strategies.sqlite3μΌλ΅ λ¶„λ¦¬
- **μ‚¬μ©μ μ„¤μ •**: settings.sqlite3μΌλ΅ λ¶„λ¦¬
- **μ„μ‹ νμΌ**: μ‹μ¤ν… temp λ””λ ‰ν† λ¦¬ ν™μ©

## π› οΈ μ¤λ§νΈ DB μµμ ν™” μ „λµ

### π“ **ννΈν™” κ°μ§€ λ° κ΄€λ¦¬**
SQLiteμ—μ„ μ‹¬λ³Ό/νƒ€μ„ν”„λ μ„λ³„ λ€λ‰ INSERT/UPDATEλ΅ μΈν• ννΈν™”λ” ν•„μ—°μ μ…λ‹λ‹¤. μ΄λ¥Ό μ¤λ§νΈν•κ² κ΄€λ¦¬ν•λ” μ „λµ:

#### **1. μ‹¤μ‹κ°„ ννΈν™” λ¨λ‹ν„°λ§**
```python
class FragmentationMonitor:
    def check_fragmentation_ratio(self) -> float:
        """
        SELECT (page_count - freelist_count) * 100.0 / page_count
        FROM pragma_page_count(), pragma_freelist_count()
        """
        # ννΈν™”μ¨ = (μ „μ²΄νμ΄μ§€ - λΉνμ΄μ§€) / μ „μ²΄νμ΄μ§€
        # 85% μ΄μƒ μ‹ VACUUM ν•„μ”

    async def monitor_insert_patterns(self):
        """
        - μ‹¬λ³Όλ³„ INSERT λΉλ„ μ¶”μ 
        - νƒ€μ„ν”„λ μ„λ³„ λ°μ΄ν„° μ¦κ°€μ¨ λ¶„μ„
        - Hot/Cold λ°μ΄ν„° ν¨ν„΄ μ‹λ³„
        """
```

#### **2. μ΅°κ±΄λ¶€ μλ™ VACUUM**
```python
class SmartVacuumScheduler:
    async def evaluate_vacuum_need(self) -> bool:
        """
        VACUUM μ‹¤ν–‰ μ΅°κ±΄:
        1. ννΈν™”μ¨ > 15%
        2. λΉ νμ΄μ§€ > 1000κ°
        3. λ§μ§€λ§‰ VACUUM ν›„ 1μ£ΌμΌ κ²½κ³Ό
        4. ν„μ¬ μ‹κ°„μ΄ κ±°λ λΉ„ν™μ„± μ‹κ°„λ€ (μƒλ²½ 2-4μ‹)
        """

    async def incremental_vacuum(self, pages: int = 100):
        """
        PRAGMA incremental_vacuum(100)
        - μ „μ²΄ VACUUM λ€μ‹  μ μ§„μ  μ •λ¦¬
        - μ„λΉ„μ¤ μ¤‘λ‹¨ μ—†μ΄ μ‹¤ν–‰ κ°€λ¥
        """
```

#### **3. μΈλ±μ¤ μµμ ν™”**
```python
class IndexOptimizer:
    async def analyze_index_usage(self):
        """
        EXPLAIN QUERY PLANμΌλ΅ μΈλ±μ¤ μ‚¬μ©λ¥  λ¶„μ„:
        - μ‚¬μ©λμ§€ μ•λ” μΈλ±μ¤ μ κ±°
        - μ»¤λ²„λ§ μΈλ±μ¤ μƒμ„± κ²€ν† 
        - μΈλ±μ¤ ν‚¤ μμ„ μµμ ν™”
        """

    async def reindex_if_needed(self, table: str):
        """
        μ΅°κ±΄λ¶€ REINDEX:
        1. μΈλ±μ¤ ν†µκ³„κ°€ μ¤λλ κ²½μ°
        2. λ€λ‰ INSERT ν›„
        3. μΏΌλ¦¬ μ„±λ¥ μ €ν• κ°μ§€ μ‹
        """
```

## π”„ μ²΄κ³„μ  μ‘μ—… μ μ°¨ (μ—…λ°μ΄νΈ)

### π“ **Phase 1 μ‹μ‘ μ΅°κ±΄ ν™•μΈ**
- β… Smart Router Phase 1 μ™„λ£ (WebSocket μ¥μ• λ³µκµ¬ ν¬ν•¨)
- β… Coordinator Phase 1 μ¤€λΉ„ μ™„λ£ (λ³‘ν–‰ κ°λ° κ°€λ¥)
- π’΅ **λ…λ¦½μ  λ³‘ν–‰ κ°λ°**: Storageλ” Coordinatorμ™€ λ…λ¦½μ μΌλ΅ κ°λ° κ°€λ¥

### Phase 1: λ°μ΄ν„° λ¨λΈ λ° μ¤ν‚¤λ§ μ„¤κ³„ π“ **μ¤€λΉ„ μ™„λ£**
- [ ] 1.1 μΊ”λ“¤ λ°μ΄ν„° ν…μ΄λΈ” μ¤ν‚¤λ§ μ„¤κ³„ (OHLCV + λ©”νƒ€λ°μ΄ν„°)
- [ ] 1.2 λ©”λ¨λ¦¬ μΊμ‹ λ¨λΈ μ„¤κ³„ (ν‹°μ»¤, νΈκ°€μ°½, μ²΄κ²°μ©)
- [ ] 1.3 μΊ”λ“¤ λ°μ΄ν„° μΈλ±μ¤ μ „λµ μ„¤κ³„ (λ³µν•© μΈλ±μ¤, λ²”μ„ μΏΌλ¦¬ μµμ ν™”)
- [ ] 1.4 λ°μ΄ν„° μ••μ¶• λ° μ •κ·ν™” μ „λµ (μΊ”λ“¤ λ°μ΄ν„°λ§)

### Phase 2: ν•µμ‹¬ μ €μ¥μ† κµ¬ν„
- [ ] 2.1 IMarketDataStorage μΈν„°νμ΄μ¤ μ •μ (μΊ”λ“¤ DB + μ‹¤μ‹κ°„ μΊμ‹)
- [ ] 2.2 SQLite κΈ°λ° CandleRepository κµ¬ν„ (DB μ €μ¥)
- [ ] 2.3 λ©”λ¨λ¦¬ κΈ°λ° RealtimeDataCache κµ¬ν„ (ν‹°μ»¤/νΈκ°€μ°½/μ²΄κ²°)
- [ ] 2.4 Smart Router λ©”λ¨λ¦¬ μΊμ‹ μ—°λ™ μΈν„°νμ΄μ¤ κµ¬ν„ β… **μ¶”κ°€**
- [ ] 2.5 νΈλμ­μ… κ΄€λ¦¬ λ° λ΅¤λ°± μ²λ¦¬ (μΊ”λ“¤ λ°μ΄ν„°λ§)

### Phase 3: μΊμ‹± μ‹μ¤ν… κµ¬ν„
- [ ] 3.1 IDataCache μΈν„°νμ΄μ¤ μ •μ
- [ ] 3.2 λ©”λ¨λ¦¬ μΊμ‹ κµ¬ν„ (LRU, TTL μ •μ±…)
- [ ] 3.3 λ””μ¤ν¬ μΊμ‹ κµ¬ν„ (μ„μ‹ νμΌ κΈ°λ°)
- [ ] 3.4 μΊμ‹ λ¬΄ν¨ν™” λ° λ™κΈ°ν™” λ΅μ§

### Phase 4: κΈ°λ³Έ λΉ„μ¦λ‹μ¤ μΈν„°νμ΄μ¤
- [ ] 4.1 IMarketDataService ν†µν•© μΈν„°νμ΄μ¤ μ •μ (λ‹¤μ¤‘ νƒ€μ…)
- [ ] 4.2 μΊ”λ“¤ λ°μ΄ν„° μ„λΉ„μ¤ (get_candle_data)
- [ ] 4.3 ν‹°μ»¤ λ°μ΄ν„° μ„λΉ„μ¤ (get_ticker_data)
- [ ] 4.4 νΈκ°€μ°½ λ°μ΄ν„° μ„λΉ„μ¤ (get_orderbook_data)
- [ ] 4.5 μ²΄κ²° λ°μ΄ν„° μ„λΉ„μ¤ (get_trade_data)

### Phase 5: DB μµμ ν™” λ° ννΈν™” κ΄€λ¦¬
- [ ] 5.1 μ¤λ§νΈ VACUUM μ¤μΌ€μ¤„λ¬ κµ¬ν„ (ννΈν™” μ„κ³„κ°’ κΈ°λ°)
- [ ] 5.2 μΈλ±μ¤ μ„±λ¥ λ¨λ‹ν„°λ§ λ° μλ™ μ¬κµ¬μ„±
- [ ] 5.3 ν…μ΄λΈ” ν†µκ³„ μλ™ μ—…λ°μ΄νΈ (ANALYZE)
- [ ] 5.4 μΏΌλ¦¬ μ„±λ¥ λ¶„μ„ λ° μµμ ν™” μ μ•

## π› οΈ ν΄λ” κµ¬μ΅° λ° νμΌ μ„¤κ³„

### ν΄λ” κµ¬μ΅°
```
market_data_storage/
β”β”€β”€ __init__.py
β”β”€β”€ interfaces/                    # μ¶”μƒ μΈν„°νμ΄μ¤
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ storage.py                # IMarketDataStorage
β”‚   β”β”€β”€ cache.py                  # IDataCache
β”‚   β”β”€β”€ repository.py             # IRepository
β”‚   β””β”€β”€ service.py                # IMarketDataService
β”β”€β”€ implementations/               # ν•µμ‹¬ κµ¬ν„μ²΄
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ sqlite_storage.py         # SQLite κΈ°λ° μ €μ¥μ†
β”‚   β”β”€β”€ market_data_service.py    # ν†µν•© λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤ (λ‹¤μ¤‘ νƒ€μ…)
β”‚   β”β”€β”€ candle_repository.py      # μΊ”λ“¤ λ°μ΄ν„° μ €μ¥μ†
β”‚   β”β”€β”€ ticker_repository.py      # ν‹°μ»¤ λ°μ΄ν„° μ €μ¥μ†
β”‚   β”β”€β”€ orderbook_repository.py   # νΈκ°€μ°½ λ°μ΄ν„° μ €μ¥μ†
β”‚   β”β”€β”€ trade_repository.py       # μ²΄κ²° λ°μ΄ν„° μ €μ¥μ†
β”‚   β””β”€β”€ metadata_repository.py    # λ©”νƒ€λ°μ΄ν„° μ €μ¥μ†
β”β”€β”€ cache/                         # μΊμ‹± μ‹μ¤ν…
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ memory_cache.py           # λ©”λ¨λ¦¬ μΊμ‹ (LRU)
β”‚   β”β”€β”€ disk_cache.py             # λ””μ¤ν¬ μΊμ‹
β”‚   β”β”€β”€ cache_manager.py          # μΊμ‹ ν†µν•© κ΄€λ¦¬
β”‚   β””β”€β”€ cache_policies.py         # μΊμ‹ μ •μ±… (TTL, LRU λ“±)
β”β”€β”€ persistence/                   # μμ†μ„± κ΄€λ¦¬
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ schema_manager.py         # μ¤ν‚¤λ§ λ²„μ „ κ΄€λ¦¬
β”‚   β”β”€β”€ migration_runner.py       # λ°μ΄ν„° λ§μ΄κ·Έλ μ΄μ…
β”‚   β””β”€β”€ integrity_checker.py      # λ°μ΄ν„° μ •ν•©μ„± κ²€μ¦
β”β”€β”€ optimization/                  # DB μµμ ν™” (μƒλ΅ μ¶”κ°€)
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ fragmentation_monitor.py  # ννΈν™” λ¨λ‹ν„°λ§
β”‚   β”β”€β”€ vacuum_scheduler.py       # μ¤λ§νΈ VACUUM μ¤μΌ€μ¤„λ¬
β”‚   β”β”€β”€ index_optimizer.py        # μΈλ±μ¤ μµμ ν™”
β”‚   β””β”€β”€ query_analyzer.py         # μΏΌλ¦¬ μ„±λ¥ λ¶„μ„
β”β”€β”€ models/                        # λ°μ΄ν„° λ¨λΈ
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ stored_candle.py          # μ €μ¥μ© μΊ”λ“¤ λ¨λΈ
β”‚   β”β”€β”€ query_criteria.py         # μΏΌλ¦¬ μ΅°κ±΄ λ¨λΈ
β”‚   β”β”€β”€ cache_entry.py            # μΊμ‹ μ—”νΈλ¦¬ λ¨λΈ
β”‚   β””β”€β”€ storage_metadata.py       # μ €μ¥μ† λ©”νƒ€λ°μ΄ν„°
β””β”€β”€ utils/                         # μ ν‹Έλ¦¬ν‹°
    β”β”€β”€ __init__.py
    β”β”€β”€ compression.py             # λ°μ΄ν„° μ••μ¶• μ ν‹Έ
    β”β”€β”€ indexing.py                # μΈλ±μ¤ κ΄€λ¦¬ μ ν‹Έ
    β”β”€β”€ query_optimizer.py         # μΏΌλ¦¬ μµμ ν™”
    β””β”€β”€ performance_monitor.py     # μ„±λ¥ λ¨λ‹ν„°λ§
```

## π― ν•µμ‹¬ κµ¬ν„ λ©ν‘

### 1. ν¨μ¨μ  λ°μ΄ν„° μ €μ¥
- **μΊ”λ“¤ λ°μ΄ν„°**: μ¤‘λ³µ λ°μ΄ν„° μλ™ μ²λ¦¬ (UPSERT), λ°°μΉ insert μµμ ν™”
- **μ‹¤μ‹κ°„ λ°μ΄ν„°**: λ©”λ¨λ¦¬ μΊμ‹ TTL κ΄€λ¦¬, μλ™ μ •λ¦¬
- **νΈλμ­μ… λ³΄μ¥**: μΊ”λ“¤ λ°μ΄ν„° μ €μ¥ μ‹ ACID μ†μ„± λ³΄μ¥
- **μ••μ¶• μ €μ¥**: ν•„μ”μ‹ μ¤λλ λ°μ΄ν„° μ••μ¶• κ΄€λ¦¬

### 2. μ§€λ¥μ  μΊμ‹± μ‹μ¤ν…
- **4λ‹¨κ³„ κ³„μΈµμ  μΊμ‹**: Storage λ©”λ¨λ¦¬ β†’ Smart Router λ©”λ¨λ¦¬ β†’ λ””μ¤ν¬ μΊμ‹ β†’ SQLite DB β… **ν™•μ •**
- **μλ™ μµμ ν™”**: ννΈν™”μ¨ 15% μ΄κ³Ό μ‹ incremental_vacuum μ‹¤ν–‰
- **μΈλ±μ¤ κ΄€λ¦¬**: ν†µκ³„ μ—…λ°μ΄νΈ, μ‚¬μ©ν•μ§€ μ•λ” μΈλ±μ¤ μ •λ¦¬
- **μΏΌλ¦¬ μµμ ν™”**: λλ¦° μΏΌλ¦¬ κ°μ§€ μ‹ μΈλ±μ¤ μ¶”μ²
- **Smart Router μ—°λ™**: Smart Routerμ μ‹¤μ‹κ°„ λ©”λ¨λ¦¬ μΊμ‹ μ°μ„  ν™μ© β… **ν™•μ •**

### 3. λ‹¨μν• λ°μ΄ν„° μΈν„°νμ΄μ¤
- **κΈ°λ³Έ CRUD**: μΊ”λ“¤/ν‹°μ»¤/νΈκ°€μ°½/μ²΄κ²° λ°μ΄ν„°μ μ €μ¥/μ΅°νλ§ μ κ³µ
- **λ©”νƒ€λ°μ΄ν„° κ΄€λ¦¬**: μ”μ²­ ν†µκ³„, μ„±λ¥ μ§€ν‘ λ“± κΈ°λ³Έ μ •λ³΄ μ κ³µ
- **λ°μ΄ν„° μ •ν•©μ„±**: νƒ€μ„μ¤νƒ¬ν”„ κΈ°λ° μ¤‘λ³µ κ²€μ‚¬, μ—°μ†μ„± κ²€μ¦
- **ν΄λΌμ΄μ–ΈνΈ λ…λ¦½**: κ° ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”ν• λ°μ΄ν„°λ¥Ό μ§μ ‘ μ”μ²­

## π”— λ‹¤λ¥Έ λ μ΄μ–΄μ™€μ ν‘λ ¥

### Market Data Coordinator (Layer 2) ν‘λ ¥ (μ—…λ°μ΄νΈ)
- **λ°μ΄ν„° μμ‹ **: Coordinatorκ°€ ν†µν•©ν• λ€μ©λ‰ λ°μ΄ν„°λ¥Ό μ €μ¥
- **μ¦λ¶„ μ”μ²­**: μΊμ‹μ— μ—†λ” λ°μ΄ν„°λ§ Coordinatorμ— μ”μ²­
- **μ„±λ¥ ν”Όλ“λ°±**: μ €μ¥μ† μ„±λ¥ μ§€ν‘λ¥Ό Coordinatorμ— μ „λ‹¬
- **μ¥μ• λ³µκµ¬ μ§€μ›**: Smart Routerμ WebSocket μ¥μ• λ³µκµ¬ λ°μ΄ν„° μ•μ •μ  μ €μ¥
- **λ³‘ν–‰ κ°λ°**: Coordinator μ™„μ„± μ΄μ „μ—λ„ λ…λ¦½μ  κ°λ° λ° ν…μ¤νΈ κ°€λ¥

### λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤μ™€μ ν‘λ ¥
- **λ°μ΄ν„° μ”μ²­ μ‘λ‹µ**: ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­ν• λ°μ΄ν„°λ¥Ό μλ” κ·Έλ€λ΅ μ κ³µ
- **μΊμ‹ ν™μ©**: μµκ·Ό λ°μ΄ν„°λ” μΊμ‹μ—μ„ μ¦‰μ‹ μ‘λ‹µ
- **DB μ΅°ν**: μΊμ‹μ— μ—†λ” λ°μ΄ν„°λ” DBμ—μ„ μ΅°ν ν›„ μ κ³µ
- **λ©”νƒ€λ°μ΄ν„° μ κ³µ**: λ°μ΄ν„° ν’μ§, μμ§‘ μ‹κ°„ λ“± κΈ°λ³Έ μ •λ³΄λ§ μ κ³µ

## π’΅ μ„±λ¥ μµμ ν™” μ „λµ

### 1. λ°μ΄ν„°λ² μ΄μ¤ μµμ ν™”
- **ννΈν™” κ΄€λ¦¬**: μ¤λ§νΈ VACUUM μ¤μΌ€μ¤„λ¬, μ„κ³„κ°’ κΈ°λ° μλ™ μ‹¤ν–‰
- **μΈλ±μ¤ μµμ ν™”**: μ‚¬μ© ν¨ν„΄ λ¶„μ„, μ»¤λ²„λ§ μΈλ±μ¤, μλ™ REINDEX
- **ν†µκ³„ κ΄€λ¦¬**: ANALYZE μλ™ μ‹¤ν–‰, μΏΌλ¦¬ ν”λλ„ μµμ ν™”
- **μ••μ¶•**: μ¤λλ λ°μ΄ν„° μ••μ¶• μ €μ¥ (μ„ νƒμ )

### 2. μΊμ‹± μµμ ν™”
- **κ³„μΈµ κµ¬μ΅°**: λ©”λ¨λ¦¬ β†’ λ””μ¤ν¬ β†’ DB μμ°¨ μ΅°ν
- **μ‚¬μ „ λ΅λ”©**: μμ£Ό μ‚¬μ©λλ” λ°μ΄ν„° λ―Έλ¦¬ μΊμ‹
- **μ§€λ¥μ  λ§λ£**: κ±°λ μ‹κ°„ κ³ λ ¤ν• TTL μ •μ±…
- **μ••μ¶• μΊμ‹**: λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μµμ ν™”

### 3. μΏΌλ¦¬ μµμ ν™”
- **λ°°μΉ μ΅°ν**: μ—¬λ¬ μ‹¬λ³Όμ„ ν• λ²μ— μ΅°ν
- **λ²”μ„ μΏΌλ¦¬**: μ‹κ°„ λ²”μ„ κΈ°λ° ν¨μ¨μ  μ΅°ν
- **κ²°κ³Ό μΊμ‹**: λ³µμ΅ν• μΏΌλ¦¬ κ²°κ³Ό μ„μ‹ μ €μ¥
- **λΉ„λ™κΈ° μ²λ¦¬**: I/O λΈ”λ΅ν‚Ή μµμ†ν™”

## π”§ μ΄μ λ° λ¨λ‹ν„°λ§

### 1. λ°μ΄ν„° μ •ν•©μ„±
- **μ¤‘λ³µ κ²€μ‚¬**: νƒ€μ„μ¤νƒ¬ν”„ κΈ°λ° μ¤‘λ³µ λ°μ΄ν„° κ°μ§€
- **μ—°μ†μ„± κ²€μ¦**: μ‹κ°„ μμ„ λ° λ„λ½ κµ¬κ°„ κ²€μ‚¬
- **λ¬΄κ²°μ„± ν™•μΈ**: μ™Έλν‚¤ μ μ•½, λ°μ΄ν„° νƒ€μ… κ²€μ¦

### 2. μ„±λ¥ λ¨λ‹ν„°λ§
- **μΏΌλ¦¬ μ„±λ¥**: λλ¦° μΏΌλ¦¬ κ°μ§€ λ° μµμ ν™” (EXPLAIN QUERY PLAN)
- **ννΈν™” μ¶”μ **: μ‹¤μ‹κ°„ ννΈν™”μ¨ λ¨λ‹ν„°λ§, μ„κ³„κ°’ μ•λ¦Ό
- **μΊμ‹ ν¨μ¨**: ννΈμ¨, λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ¶”μ 
- **μ €μ¥μ† μ©λ‰**: λ””μ¤ν¬ μ‚¬μ©λ‰, μ¦κ°€μ¨ λ¨λ‹ν„°λ§

### 3. μλ™ν™” μ΄μ
- **μ¤λ§νΈ VACUUM**: ννΈν™” μ„κ³„κ°’ κΈ°λ° μλ™ μ‹¤ν–‰
- **μΈλ±μ¤ κ΄€λ¦¬**: ν†µκ³„ μ—…λ°μ΄νΈ, μ‚¬μ©ν•μ§€ μ•λ” μΈλ±μ¤ μ •λ¦¬
- **μΊμ‹ μ •λ¦¬**: λ§λ£λ μΊμ‹ μλ™ μ •λ¦¬
- **μ„±λ¥ νλ‹**: μΏΌλ¦¬ ν¨ν„΄ λ¶„μ„ ν›„ μλ™ μµμ ν™” μ μ•

## π― μ„±κ³µ κΈ°μ¤€
- β… **μΊ”λ“¤ λ°μ΄ν„° μ΅°ν**: μµκ·Ό 1000κ° μΊ”λ“¤ μ΅°ν < 100ms (DB μµμ ν™”)
- β… **μ‹¤μ‹κ°„ λ°μ΄ν„° μ‘λ‹µ**: ν‹°μ»¤/νΈκ°€μ°½ μ΅°ν < 10ms (λ©”λ¨λ¦¬ μΊμ‹)
- β… **μΊ”λ“¤ λ°μ΄ν„° μ €μ¥**: 10λ§κ° μΊ”λ“¤ λ°°μΉ μ €μ¥ < 5μ΄ (DB μµμ ν™”)
- β… **λ©”λ¨λ¦¬ ν¨μ¨μ„±**: μ‹¤μ‹κ°„ λ°μ΄ν„° λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μµμ ν™” (DB μ €μ¥ μ—†μ)
- β… **λ°μ΄ν„° μ •ν•©μ„±**: μ¤‘λ³µ μ—†κ³  μ—°μ†μ„± μλ” λ°μ΄ν„° λ³΄μ¥

## π€ κ°λ° μ°μ„ μμ„
1. **Phase 1**: λ°μ΄ν„° λ¨λΈ λ° μ¤ν‚¤λ§ μ„¤κ³„
2. **Phase 2**: κΈ°λ³Έ μ €μ¥μ† κµ¬ν„ (SQLite)
3. **Phase 3**: λ©”λ¨λ¦¬ μΊμ‹± μ‹μ¤ν…
4. **Phase 4**: κΈ°λ³Έ λΉ„μ¦λ‹μ¤ μΈν„°νμ΄μ¤
5. **Phase 5**: μ„±λ¥ μµμ ν™” λ° μ΄μ κΈ°λ¥

---
**μμ΅΄μ„±**: β… TASK_20250820_01 Smart Routing Phase 1 μ™„λ£ (WebSocket μ¥μ• λ³µκµ¬ ν¬ν•¨)
**μ‹μ‘ μ΅°κ±΄**: TASK_20250820_02 Coordinatorμ™€ λ…λ¦½μ  λ³‘ν–‰ κ°λ° κ°€λ¥
**μ—°κ΄€ νƒμ¤ν¬**: TASK_20250820_04 Backbone APIμ™€ ν†µν•©
**μμƒ μ†μ”μ‹κ°„**: 3-4μΌ (λ…λ¦½μ  λ³‘ν–‰ κ°λ°λ΅ ν¨μ¨μ„± ν™•λ³΄)
**ν•µμ‹¬ κ°€μΉ**: λ§μΌ“ λ°μ΄ν„°μ μ•μ •μ  μ €μ¥ λ° λΉ λ¥Έ μ΅°ν
