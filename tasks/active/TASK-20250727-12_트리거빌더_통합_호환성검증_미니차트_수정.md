# TASK-20250727-12: 트리거 빌더 UI 통합 호환성검증 및 미니차트 수정

## 📋 태스크 개요
**생성일**: 2025-07-27  
**담당자**: GitHub Copilot  
**우선순위**: 높음 🚨  
**예상 소요시간**: 4-6시간  
**선행 태스크**: TASK-20250726-11 (하이브리드 지표시스템 트리거빌더 통합 완료)

## 🎯 목표
**트리거 빌더 UI 개선 작업 중 발생한 호환성 검증 오류와 미니차트 기능 문제를 해결하여 GitHub 업로드 가능한 완성된 UI 시스템 구축**

## 🚨 **현재 상황 분석**
**핵심 문제**: `integrated_condition_manager.py`가 여전히 메인 제어 역할을 하고 있어 새로 개선한 컴포넌트들이 작동하지 않음

**발견된 문제점**:
1. ❌ **호환성 검증 시스템 오류**: SMA↔EMA가 호환되어야 하는데 "충돌"로 표시됨
2. ❌ **미니차트 개선 로직 연동 실패**: 개선된 차트 로직이 작동하지 않고 기본 폴백만 실행됨
3. ⚠️ **제어권 이전 미완료**: integrated_condition_manager.py에서 새로운 컴포넌트들로의 제어권 이전 필요

## 📋 **우선순위별 해결 과제**

### 🚨 **HIGH PRIORITY - 핵심 기능 수정**

#### **1️⃣ 호환성 검증 시스템 오류 해결**
**문제 상황**:
```
- 외부 변수 설정에서 SMA와 EMA 선택 시 호환성 충돌 메시지 표시
- 원인: condition_dialog.py의 check_variable_compatibility() 메서드가 잘못된 호환성 서비스 호출
```

**필요 작업**:
- [ ] `compatibility_validator.py`의 `check_compatibility()` 함수 직접 호출로 변경
- [ ] SMA, EMA 모두 'trend' 카테고리로 올바른 매핑 확인
- [ ] 호환성 메시지 UI 정상 표시 확인

**수정 대상 파일**:
```
📁 upbit_auto_trading/ui/desktop/screens/strategy_management/trigger_builder/components/
├── condition_dialog.py          # check_variable_compatibility() 메서드 수정
└── compatibility_validator.py   # 호환성 검증 로직 확인
```

#### **2️⃣ 미니차트 개선 로직 연동 실패**
**문제 상황**:
```
- simulation_result_widget.py에 구현한 차트 카테고리 기반 플롯팅이 호출되지 않음
- 원인: integrated_condition_manager.py가 여전히 구 버전 차트 업데이트 방식 사용
```

**필요 작업**:
- [ ] `integrated_condition_manager.py`의 차트 업데이트 로직을 새 컴포넌트로 연결
- [ ] `update_simulation_chart()` 메서드에 `variable_info`, `base_variable_data`, `external_variable_data` 파라미터 전달
- [ ] 오버레이/서브플롯 분기 로직 정상 작동 확인

**수정 대상 파일**:
```
📁 upbit_auto_trading/ui/desktop/screens/strategy_management/
├── integrated_condition_manager.py     # 차트 업데이트 로직 수정
└── trigger_builder/components/
    └── simulation_result_widget.py     # 개선된 차트 로직 연동 확인
```

### 🔧 **MEDIUM PRIORITY - UI 세부 개선**

#### **3️⃣ 스핀박스 삼각형 화살표 문제**
**문제**: 스핀박스에 사각형 화살표가 표시됨 (삼각형이 너무 커서 잘림)

**해결 방법**:
- [ ] `parameter_widgets.py`의 스핀박스 스타일에서 화살표 크기 조정
- [ ] `border-left/right/top/bottom` 값을 `4px` → `3px`로 축소

#### **4️⃣ 시뮬레이션 버튼 스트레치 미작동**
**문제**: 버튼 크기가 변화하지 않음

**해결 방법**:
- [ ] `simulation_control_widget.py`에서 `QGridLayout`의 stretch 설정 확인
- [ ] 부모 레이아웃의 stretch 정책과 충돌 여부 확인
- [ ] `setSizePolicy`를 `Expanding`으로 명시적 설정

#### **5️⃣ 트리거 상세정보 카테고리 표시 안됨**
**문제**: 개선된 DB 스키마 기반 카테고리 정보가 표시되지 않음

**해결 방법**:
- [ ] `trigger_detail_widget.py`의 `_format_trigger_detail()` 메서드에서
- [ ] `variable_definitions.py` 임포트 오류 해결
- [ ] 카테고리 매핑 함수 정상 호출 확인

### 🎨 **LOW PRIORITY - 최종 마무리**

#### **6️⃣ 변수 콤보박스 폭 추가 확장**
- [ ] 현재: 30% 증가 완료
- [ ] 추가 요청: 더 넓게 확장 가능

#### **7️⃣ 범주 이모티콘 표시 확인**
- [ ] 현재: 한글 + 이모티콘으로 변경 완료
- [ ] 확인 필요: 실제 UI에서 정상 표시 여부

## 🔍 **디버깅 체크리스트**

### **즉시 확인해야 할 항목들**

#### **1️⃣ 어떤 파일이 실제로 호출되는가?**
- [ ] `integrated_condition_manager.py` vs `trigger_builder/components/*`
- [ ] 차트 업데이트 경로 추적 필요

#### **2️⃣ 호환성 검증 경로**
- [ ] `chart_variable_service.py` vs `compatibility_validator.py`
- [ ] 어떤 함수가 실제로 호출되는지 확인

#### **3️⃣ 컴포넌트 연결 상태**
- [ ] `condition_dialog.py`의 이벤트가 올바른 핸들러로 연결되었는지
- [ ] 시뮬레이션 결과가 올바른 차트 위젯으로 전달되는지

## 📋 **단계별 실행 계획**

### **🔍 PHASE 1: 문제 진단 및 분석 (30분)**

#### **Step 1.1: 호출 경로 추적**
- [ ] `condition_dialog.py`의 호환성 검증 호출 경로 확인
- [ ] `integrated_condition_manager.py`의 차트 업데이트 경로 확인
- [ ] 실제 실행되는 코드와 의도된 코드 비교

#### **Step 1.2: 컴포넌트 연결 상태 점검**
- [ ] 이벤트 핸들러 연결 상태 확인
- [ ] 데이터 전달 경로 검증
- [ ] UI 위젯 간 통신 상태 점검

### **🔧 PHASE 2: 호환성 검증 수정 (1-2시간)**

#### **Step 2.1: condition_dialog.py 수정**
- [ ] `check_variable_compatibility()` 메서드에서 올바른 호환성 서비스 호출
- [ ] `compatibility_validator.py`의 `check_compatibility()` 직접 사용
- [ ] SMA, EMA 호환성 테스트 및 검증

#### **Step 2.2: 호환성 메시지 UI 수정**
- [ ] 호환성 결과 메시지 정상 표시 확인
- [ ] 'trend' 카테고리 매핑 정확성 검증
- [ ] 사용자에게 적절한 피드백 제공

### **🎨 PHASE 3: 미니차트 로직 연동 (2-3시간)**

#### **Step 3.1: integrated_condition_manager.py 수정**
- [ ] 차트 업데이트 로직을 새 컴포넌트로 연결
- [ ] `update_simulation_chart()` 메서드 파라미터 추가
- [ ] `variable_info`, `base_variable_data`, `external_variable_data` 전달

#### **Step 3.2: simulation_result_widget.py 연동**
- [ ] 차트 카테고리 기반 플롯팅 로직 활성화
- [ ] 오버레이/서브플롯 분기 로직 정상 작동 확인
- [ ] 기본 폴백 대신 개선된 로직 실행 확인

### **✨ PHASE 4: UI 세부사항 개선 (1시간)**

#### **Step 4.1: 스타일 및 레이아웃 수정**
- [ ] 스핀박스 화살표 크기 조정
- [ ] 시뮬레이션 버튼 스트레치 설정
- [ ] 변수 콤보박스 폭 확장

#### **Step 4.2: 정보 표시 개선**
- [ ] 트리거 상세정보 카테고리 표시 수정
- [ ] 범주 이모티콘 정상 표시 확인
- [ ] 전체 UI 일관성 검토

### **🧪 PHASE 5: 통합 테스트 및 검증 (30분)**

#### **Step 5.1: 기능 통합 테스트**
- [ ] 호환성 검증 기능 테스트
- [ ] 미니차트 표시 기능 테스트
- [ ] 전체 UI 워크플로우 테스트

#### **Step 5.2: 최종 검증**
- [ ] GitHub 업로드 준비 상태 확인
- [ ] 모든 기능 정상 작동 확인
- [ ] 문서 업데이트 및 정리

## 📁 **주요 수정 대상 파일**

```
📁 upbit_auto_trading/ui/desktop/screens/strategy_management/
├── integrated_condition_manager.py                    # 제어권 이전 및 차트 연동
└── trigger_builder/components/
    ├── condition_dialog.py                           # 호환성 검증 수정
    ├── simulation_result_widget.py                   # 미니차트 로직 연동
    ├── simulation_control_widget.py                  # 버튼 스트레치 수정
    ├── trigger_detail_widget.py                      # 카테고리 표시 수정
    └── parameter_widgets.py                          # 스핀박스 스타일 수정
```

## 🎯 **성공 기준**

### **기능적 요구사항**
- [x] **호환성 검증**: SMA↔EMA가 "호환"으로 정상 표시
- [x] **미니차트**: 오버레이/서브플롯 구분된 차트가 정상 작동
- [x] **제어권 이전**: 새로운 컴포넌트들이 실제로 동작

### **UI/UX 요구사항**
- [x] **스핀박스**: 삼각형 화살표 정상 표시
- [x] **버튼**: 시뮬레이션 버튼 스트레치 정상 작동
- [x] **정보 표시**: 트리거 상세정보에 카테고리 표시

### **시스템 요구사항**
- [x] **안정성**: 기존 기능 모두 정상 작동
- [x] **성능**: 응답 속도 저하 없음
- [x] **호환성**: 기존 데이터와 완전 호환

## 📝 **다음 세션 시작 프롬프트**

```
안녕하세요! 트리거 빌더 UI 개선 작업을 계속 진행하겠습니다.

현재 상황:
1. SMA↔EMA 호환성 검증이 "충돌"로 잘못 표시됨
2. 개선된 미니차트 로직이 작동하지 않고 기본 폴백만 실행됨
3. integrated_condition_manager.py가 여전히 메인 제어 역할을 하고 있음

우선순위:
1. 호환성 검증 오류 수정 (condition_dialog.py)
2. 미니차트 연동 수정 (integrated_condition_manager.py → simulation_result_widget.py)
3. 차트 카테고리 기반 플롯팅 로직 활성화

목표: 실제 UI에서 호환성 메시지가 정상 표시되고, 오버레이/서브플롯 구분된 미니차트가 작동하는 것 확인

현재 파일들:
- d:\projects\upbit-autotrader-vscode\upbit_auto_trading\ui\desktop\screens\strategy_management\trigger_builder\components\condition_dialog.py
- d:\projects\upbit-autotrader-vscode\upbit_auto_trading\ui\desktop\screens\strategy_management\trigger_builder\components\simulation_result_widget.py
- d:\projects\upbit-autotrader-vscode\upbit_auto_trading\ui\desktop\screens\strategy_management\integrated_condition_manager.py

먼저 호환성 검증 문제부터 해결해주세요.
```

## 📌 **핵심 메모**
**integrated_condition_manager.py에서 새로운 컴포넌트들로의 제어권 이전이 핵심 과제입니다.**

---

## 🔄 **태스크 상태 추적**

**생성일**: 2025-07-27  
**마지막 업데이트**: 2025-07-27  
**진행률**: 0% (시작 전)  
**현재 단계**: PHASE 1 (문제 진단 및 분석)  
**담당자**: GitHub Copilot  

---

## 📚 **관련 문서**
- [TASK-20250726-11: 하이브리드 지표시스템 트리거빌더 통합](TASK-20250726-11_하이브리드_지표시스템_트리거빌더_통합_호환성검증.md)
- [TASK-20250725-09: 트리거 빌더 완전 리팩토링](TASK-20250725-09_트리거빌더_완전_리팩토링_통합.md)
- [trigger_usage_guide.md](../../trigger_usage_guide.md)
