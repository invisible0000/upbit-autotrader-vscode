# 📋 TASK_20250818_01: 매매 변수 배율(Multiplier) 기능 추가

## 🎯 태스크 목표
- **주요 목표**: 7개 핵심 매매 변수에 배율 기능 추가하여 임계값 정밀 조절 가능
- **완료 기준**:
  - 모든 대상 변수에서 50.0%~200.0% 배율 설정 가능
  - 기존 100% 호환성 유지 (기본값 100.0%)
  - UI에서 실시간 배율 조절 및 즉시 반영

## 📊 현재 상황 분석
### 문제점
1. 고정된 임계값으로 인한 시장 상황별 적응 한계
2. 변수별 민감도 조절 불가능
3. 사용자 맞춤형 매매 전략 구성의 제약

### 사용 가능한 리소스
- 기존 tv_variable_parameters 테이블 구조
- ParameterWidgetFactory UI 시스템
- 7개 대상 변수의 기존 계산 로직

## 🔄 체계적 작업 절차 (필수 준수)
### 8단계 작업 절차
1. **📋 작업 항목 확인**: 태스크 문서에서 구체적 작업 내용 파악
2. **🔍 검토 후 세부 작업 항목 생성**: 작업을 더 작은 단위로 분해
3. **⚡ 작업중 마킹**: 해당 작업 항목을 `[-]` 상태로 변경
4. **⚙️ 작업 항목 진행**: 실제 작업 수행
5. **✅ 작업 내용 확인**: 결과물 검증 및 품질 확인
6. **📝 상세 작업 내용 업데이트**: 태스크 문서에 진행사항 기록
7. **[x] 작업 완료 마킹**: 해당 작업 항목을 완료 상태로 변경
8. **⏳ 작업 승인 대기**: 다음 단계 진행 전 검토 및 승인

### 작업 상태 마커
- **[ ]**: 미완료 (미시작)
- **[-]**: 진행 중 (현재 작업)
- **[x]**: 완료

## 🛠️ 작업 계획

### Phase 1: DB 파라미터 추가 (1일)
- [ ] ATR, HIGH_PRICE, LOW_PRICE, OPEN_PRICE에 multiplier_percent 파라미터 추가
- [ ] RSI, VOLUME, BOLLINGER_BAND에 multiplier_percent 파라미터 추가
- [ ] 파라미터 메타데이터 정의 (range: 50.0-200.0, default: 100.0, step: 0.1)

### Phase 2: UI 위젯 확장 (2일)
- [ ] QDoubleSpinBox 위젯을 활용한 배율 입력 컴포넌트 설계
- [ ] ParameterWidgetFactory에 배율 위젯 생성 메서드 추가
- [ ] % 접미사 표시 및 소수점 1자리 정밀도 설정
- [ ] 실시간 배율 변경 시 미리보기 기능 구현

### Phase 3: 계산 로직 통합 (2일)
- [ ] 기존 변수 계산기에 배율 적용 로직 추가
- [ ] 성능 최적화: 직접 곱셈 방식 (조건문 회피)
- [ ] 기존 호환성 검증: 100% 배율 시 기존 결과와 동일 확인
- [ ] 오류 처리: 잘못된 배율 값에 대한 안전장치

### Phase 4: 테스트 및 검증 (1일)
- [ ] 각 변수별 배율 적용 단위 테스트
- [ ] 트리거 빌더에서 배율 설정/조회 통합 테스트
- [ ] 7규칙 전략에서 배율 기능 활용 검증
- [ ] 성능 테스트: 기존 대비 20% 이하 증가 확인

## 🛠️ 개발할 도구
- `multiplier_parameter_migrator.py`: DB 파라미터 일괄 추가 도구
- `multiplier_widget_factory.py`: 배율 전용 UI 위젯 팩토리
- `multiplier_calculation_validator.py`: 배율 계산 정확도 검증 도구

## 🎯 성공 기준
- ✅ 7개 변수 모두 50.0%~200.0% 배율 설정 가능
- ✅ UI에서 배율 조절 시 300ms 이내 반영
- ✅ 기존 전략 100% 호환성 유지 (100% 배율 기본값)
- ✅ 백테스팅에서 배율 적용 결과 정확도 99% 이상
- ✅ "ATR 150%" vs "RSI 90%" 등 직관적 표현 가능

## 💡 작업 시 주의사항
### 안전성 원칙
- 기존 tv_variable_parameters 테이블 백업 필수
- 단계별 롤백 지점 설정
- 기본값 100.0% 보장으로 기존 전략 무영향

### 성능 최적화
- 배율 100%일 때도 직접 곱셈 사용 (조건문 회피)
- 컴파일러 최적화 활용: value * 1.0
- 캐싱 불필요: 단순 곱셈 연산

## 🚀 즉시 시작할 작업
```sql
-- Step 1: ATR 변수에 배율 파라미터 추가
INSERT INTO tv_variable_parameters (
    variable_id, parameter_name, parameter_type, default_value,
    min_value, max_value, display_name_ko, description
) VALUES (
    'ATR', 'multiplier_percent', 'float', '100.0',
    '50.0', '200.0', '배율(%)', 'ATR 값에 적용할 배율 (100.0 = 원값)'
);
```

## 📈 예상 활용 사례
```yaml
# 변동성 강화 전략
ATR 배율 150%: 고변동성 장에서 보수적 진입
HIGH_PRICE 배율 102%: 저항선 돌파 기준 2% 상향
RSI 배율 90%: 과매수/과매도 신호 10% 민감도 증가

# 보수적 전략
ATR 배율 80%: 저변동성 장에서 적극적 진입
VOLUME 배율 120%: 거래량 기준 20% 상향 조정
```

---
**다음 에이전트 시작점**: tv_variable_parameters 테이블에 multiplier_percent 파라미터 추가부터 시작
**우선순위**: ATR → HIGH_PRICE → LOW_PRICE → OPEN_PRICE → RSI → VOLUME → BOLLINGER_BAND 순서로 단계적 적용
