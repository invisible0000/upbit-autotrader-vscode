# TASK-20250810-01: API ν‚¤ λ΅λ“ μ¤λ¥ κΈ΄κΈ‰ μμ •

## π“‹ μ‘μ—… κ°μ”
**μ°μ„ μμ„**: π”΄ κΈ΄κΈ‰
**λ‹΄λ‹Ήμ**: GitHub Copilot
**μƒμ„±μΌ**: 2025-08-10
**μμƒ μ†μ”**: 2-3μ‹κ°„

## π― λ¬Έμ  μ •μ
API μκ²©μ¦λ… νμΌ(`config/secure/api_credentials.json`)κ³Ό μ•”νΈν™” ν‚¤(`settings.sqlite3:secure_keys`)κ°€ μ΅΄μ¬ν•μ§€λ§ `ApiKeyService`μ—μ„ "API ν‚¤ λ΅λ“ μ¤‘ μ¤λ¥" λ°μƒν•μ—¬ μ‹¤κ±°λ κΈ°λ¥ μ°¨λ‹¨λ¨.

## π” ν„μ¬ μƒνƒ λ¶„μ„
- β… `config/secure/api_credentials.json` νμΌ μ΅΄μ¬ ν™•μΈλ¨
- β… `settings.sqlite3:secure_keys` ν…μ΄λΈ”μ— 3κ° λ μ½”λ“ μ΅΄μ¬
- β `ApiKeyService.load_api_keys()` νΈμ¶μ‹ λΉ μμ™Έ λ°μƒ
- β UIμ—μ„ "API ν‚¤ νμΌμ΄ μ—†μµλ‹λ‹¤" κ²½κ³  ν‘μ‹

## π“ μ„λΈ νƒμ¤ν¬ λ¶„ν• 

### **μ„λΈνƒμ¤ν¬ 1.1: νμΌ κ²½λ΅ λ° κ¶ν• κ²€μ¦** (λ‚μ΄λ„: β­)
- [ ] **1.1.1**: `config/secure/api_credentials.json` νμΌ μ½κΈ° κ¶ν• ν™•μΈ
- [ ] **1.1.2**: νμΌ λ‚΄μ© κµ¬μ΅° κ²€μ¦ (JSON ν•μ‹, ν•„μ ν‚¤ μ΅΄μ¬)
- [ ] **1.1.3**: νμΌ ν¬κΈ° λ° μΈμ½”λ”© ν™•μΈ

**TDD ν…μ¤νΈ**:
```python
def test_api_credentials_file_accessibility():
    """API μκ²©μ¦λ… νμΌ μ ‘κ·Όμ„± ν…μ¤νΈ"""
    file_path = Path("config/secure/api_credentials.json")
    assert file_path.exists()
    assert file_path.is_file()
    assert os.access(file_path, os.R_OK)
```

### **μ„λΈνƒμ¤ν¬ 1.2: μ•”νΈν™” ν‚¤ κ²€μ¦** (λ‚μ΄λ„: β­β­)
- [ ] **1.2.1**: `settings.sqlite3:secure_keys` ν…μ΄λΈ” κµ¬μ΅° ν™•μΈ
- [ ] **1.2.2**: μ•”νΈν™” ν‚¤ μ ν¨μ„± κ²€μ¦ (key_type, key_value)
- [ ] **1.2.3**: λ³µνΈν™” ν”„λ΅μ„Έμ¤ λ‹¨κ³„λ³„ ν…μ¤νΈ

**TDD ν…μ¤νΈ**:
```python
def test_encryption_key_validity():
    """μ•”νΈν™” ν‚¤ μ ν¨μ„± ν…μ¤νΈ"""
    service = ApiKeyService()
    encryption_keys = service._load_encryption_keys()
    assert len(encryption_keys) > 0
    for key in encryption_keys:
        assert key.key_type in ['master', 'api', 'backup']
        assert len(key.key_value) >= 32  # μµμ† 256bit
```

### **μ„λΈνƒμ¤ν¬ 1.3: ApiKeyService λ΅μ§ λ””λ²„κΉ…** (λ‚μ΄λ„: β­β­β­)
- [ ] **1.3.1**: `load_api_keys()` λ©”μ„λ“ μμ™Έ μ²λ¦¬ λ΅μ§ κ²€ν† 
- [ ] **1.3.2**: νμΌ μ½κΈ° β†’ λ³µνΈν™” β†’ νμ‹± λ‹¨κ³„λ³„ λ¶„λ¦¬ ν…μ¤νΈ
- [ ] **1.3.3**: λ΅κΉ… λ λ²¨ μ¦κ°€ν•μ—¬ μƒμ„Έ μ¤λ¥ μ¶”μ 

**TDD ν…μ¤νΈ**:
```python
def test_api_key_loading_process():
    """API ν‚¤ λ΅λ”© ν”„λ΅μ„Έμ¤ λ‹¨κ³„λ³„ ν…μ¤νΈ"""
    service = ApiKeyService()

    # 1λ‹¨κ³„: νμΌ μ½κΈ°
    raw_data = service._read_credentials_file()
    assert raw_data is not None

    # 2λ‹¨κ³„: λ³µνΈν™”
    decrypted_data = service._decrypt_credentials(raw_data)
    assert decrypted_data is not None

    # 3λ‹¨κ³„: νμ‹±
    api_keys = service._parse_api_credentials(decrypted_data)
    assert 'access_key' in api_keys
    assert 'secret_key' in api_keys
```

### **μ„λΈνƒμ¤ν¬ 1.4: μ—λ¬ λ©”μ‹μ§€ μƒμ„Έν™”** (λ‚μ΄λ„: β­)
- [ ] **1.4.1**: λΉ μμ™Έ λ€μ‹  κµ¬μ²΄μ  μ¤λ¥ λ©”μ‹μ§€ μ¶”κ°€
- [ ] **1.4.2**: λ‹¨κ³„λ³„ μ‹¤ν¨ μ§€μ  μ‹λ³„ λ΅κΉ… μ¶”κ°€
- [ ] **1.4.3**: μ‚¬μ©μ μΉν™”μ  μ¤λ¥ μ•λ‚΄ λ©”μ‹μ§€ μ‘μ„±

**UX κ²€μ¦**:
```python
def test_user_friendly_error_messages():
    """μ‚¬μ©μ μΉν™”μ  μ¤λ¥ λ©”μ‹μ§€ ν…μ¤νΈ"""
    try:
        service = ApiKeyService()
        service.load_api_keys()
    except ApiKeyLoadError as e:
        assert "νμΌμ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤" in str(e) or \
               "λ³µνΈν™”μ— μ‹¤ν¨ν–μµλ‹λ‹¤" in str(e) or \
               "μλ»λ ν•μ‹μ…λ‹λ‹¤" in str(e)
        assert len(str(e)) > 10  # μλ―Έμλ” κΈΈμ΄
```

## π§ ν†µν•© ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### **μ‹λ‚λ¦¬μ¤ A: μ •μƒ μΌ€μ΄μ¤**
1. κΈ°μ΅΄ μκ²©μ¦λ… νμΌλ΅ API ν‚¤ λ΅λ“
2. Upbit API μ—°κ²° ν…μ¤νΈ μν–‰
3. UIμ—μ„ "μ—°κ²°λ¨" μƒνƒ ν™•μΈ

### **μ‹λ‚λ¦¬μ¤ B: νμΌ μ†μƒ μΌ€μ΄μ¤**
1. μκ²©μ¦λ… νμΌ μΌλ¶€ μ†μƒ μ‹λ®¬λ μ΄μ…
2. μ μ ν• μ¤λ¥ λ©”μ‹μ§€ ν‘μ‹ ν™•μΈ
3. λ³µκµ¬ κ°€μ΄λ“ μ κ³µ ν™•μΈ

### **μ‹λ‚λ¦¬μ¤ C: μ•”νΈν™” ν‚¤ λ¶μΌμΉ μΌ€μ΄μ¤**
1. μλ»λ μ•”νΈν™” ν‚¤λ΅ λ³µνΈν™” μ‹λ„
2. λ³΄μ•μ„ μ„ν• μ¬μ„¤μ • μ•λ‚΄ ν™•μΈ
3. λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦

## β… μ™„λ£ μ΅°κ±΄
- [ ] API ν‚¤ λ΅λ“ μ„±κ³µλ¥  100% (κΈ°μ΅΄ μ ν¨ νμΌ κΈ°μ¤€)
- [ ] μ¤λ¥ λ°μƒμ‹ κµ¬μ²΄μ  λ©”μ‹μ§€ μ κ³µ (μµμ† 3κ°€μ§€ μ‹λ‚λ¦¬μ¤)
- [ ] UIμ—μ„ μ •ν™•ν• μ—°κ²° μƒνƒ ν‘μ‹
- [ ] λ¨λ“  TDD ν…μ¤νΈ ν†µκ³Ό (μµμ† μ»¤λ²„λ¦¬μ§€ 90%)

## π¨ λ¦¬μ¤ν¬ λ° μ£Όμμ‚¬ν•­
1. **λ³΄μ•**: API ν‚¤ λ””λ²„κΉ…μ‹ λ΅κ·Έμ— ν‰λ¬Έ λ…Έμ¶ κΈμ§€
2. **λ°μ΄ν„° λ¬΄κ²°μ„±**: κΈ°μ΅΄ μ•”νΈν™”λ λ°μ΄ν„° μ†μƒ λ°©μ§€
3. **UX**: μ‚¬μ©μκ°€ μ΄ν•΄ν•  μ μλ” μ¤λ¥ λ©”μ‹μ§€ ν•„μ
4. **μ„±λ¥**: ν‚¤ λ΅λ”© ν”„λ΅μ„Έμ¤ 5μ΄ μ΄λ‚΄ μ™„λ£

## π“ κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ
- [ ] κΈ°μ΅΄ API ν‚¤λ΅ μ •μƒ λ΅κ·ΈμΈ ν™•μΈ
- [ ] μƒλ΅μ΄ API ν‚¤ λ“±λ΅ ν”„λ΅μ„Έμ¤ μ •μƒ λ™μ‘
- [ ] μλ»λ API ν‚¤ μ…λ ¥μ‹ μ μ ν• μ¤λ¥ μ²λ¦¬
- [ ] ν”„λ΅λ•μ… ν™κ²½μ—μ„ μ‹¤κ±°λ κ°€λ¥ μƒνƒ ν™•μΈ
- [ ] κ°λ° ν™κ²½μ—μ„ λ¨μκ±°λ μ •μƒ λ™μ‘ ν™•μΈ

## π”„ λ‹¤μ νƒμ¤ν¬ μ—°κ³„
μ„±κ³µμ‹ β†’ **TASK-20250810-05** (ν”„λ΅νμΌ μ „ν™μ‹ API ν‚¤ μ μ§€)
μ‹¤ν¨μ‹ β†’ API ν‚¤ κ΄€λ¦¬ μ‹μ¤ν… μ „λ©΄ μ¬κ²€ν†  ν•„μ”
