# ğŸ“‹ TASK_20250818_03: ì—…ë¹„íŠ¸ WebSocket í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸

## ğŸ¯ íƒœìŠ¤í¬ ëª©í‘œ
- **ì£¼ìš” ëª©í‘œ**: ì—…ë¹„íŠ¸ WebSocket ì‹¤ì‹œê°„ ë°### Phase 4: ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ê²€ì¦ (60ë¶„)
- [x] API í‚¤ ì—†ì´ WebSocket Quotation ì—°ê²° í…ŒìŠ¤íŠ¸ âœ…
- [x] ë‹¤ì¤‘ ì‹¬ë³¼ êµ¬ë… í…ŒìŠ¤íŠ¸ (ìŠ¤í¬ë¦¬ë„ˆ ì‹œë‚˜ë¦¬ì˜¤)
- [x] Rate Limit ìš°íšŒ íš¨ê³¼ ì¸¡ì •
- [x] REST API vs WebSocket ì§€ì—° ì‹œê°„ ë¹„êµ
- [x] ì•ˆì •ì„± ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê²€ì¦

### ğŸ¯ **ìµœì¢… ê²€ì¦ ì™„ë£Œ ê²°ê³¼**
1. **Market ì •ë³´ íŒŒì‹±**: 100% ì„±ê³µë¥  (KRW-BTC ì •í™• í‘œì‹œ) âœ…
2. **ì‹¤ì‹œê°„ ê°€ê²© ë³€í™”**: 160,540,000 â†’ 160,541,000ì› ê°ì§€ âœ…
3. **ì—ëŸ¬ ë³µì›ë ¥**: ì˜ëª»ëœ ìš”ì²­ ì°¨ë‹¨ í›„ ì •ìƒ ë™ì‘ ìœ ì§€ âœ…
4. **ì—°ê²° ì•ˆì •ì„±**: ê¹”ë”í•œ ì—°ê²°/í•´ì œ (ì˜¤ë¥˜ ë©”ì‹œì§€ ì—†ìŒ) âœ…
5. **íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬**: 10ì´ˆ ì œí•œìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€ âœ…ê¸°ëŠ¥ êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
- **ì™„ë£Œ ê¸°ì¤€**:
  - ê¸°ë³¸ WebSocket í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ì™„ë£Œ
  - ticker, trade, orderbook, candle ë°ì´í„° ì‹¤ì‹œê°„ ìˆ˜ì‹  ê°€ëŠ¥
  - REST API Rate Limit ìš°íšŒ íš¨ê³¼ ê²€ì¦
  - ê¸°ì¡´ ì¸í”„ë¼ ë ˆì´ì–´ì— í†µí•© ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ì„¤ê³„

## ğŸ“Š í˜„ì¬ ìƒí™© ë¶„ì„
### í•µì‹¬ ë°œê²¬: API í‚¤ ìš”êµ¬ì‚¬í•­ ëª…í™•í™” âœ…
ì‚¬ìš©ì ìš°ë ¤ì‚¬í•­ì´ ì •í™•í–ˆìŠµë‹ˆë‹¤! WebSocketì€ **2ê°œ ì—”ë“œí¬ì¸íŠ¸**ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **ğŸ“ˆ Quotation (ì‹œì„¸) - API í‚¤ ë¶ˆí•„ìš”**
   - `wss://api.upbit.com/websocket/v1`
   - ticker, trade, orderbook, candle ë°ì´í„°
   - **ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…ì— ì™„ë²½ í™œìš©** âœ…

2. **ğŸ”’ Exchange (í”„ë¼ì´ë¹—) - API í‚¤ í•„ìš”**
   - `wss://api.upbit.com/websocket/v1/private`
   - myAsset, myOrder ë°ì´í„°
   - **ì‹¤ê±°ë˜ì—ì„œë§Œ í•„ìš”** âš¡

### ì„¤ê³„ ë°©í–¥ ê²°ì •
- **ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…**: WebSocket Quotation ìš°ì„  í™œìš© (API í‚¤ ì—†ì–´ë„ OK)
- **ì‹¤ê±°ë˜**: í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ (WebSocket + REST API)

### ë¬¸ì œì 
1. **REST API Rate Limit ì œì•½**: ì´ˆë‹¹ 10íšŒ, ë¶„ë‹¹ 600íšŒ ì œí•œìœ¼ë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í•œê³„
2. **WebSocket ë¯¸êµ¬í˜„**: ì„¤ì •ì—ëŠ” WebSocket URL ì¡´ì¬í•˜ë‚˜ ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ
3. **ì‹¤ì‹œê°„ì„± ë¶€ì¡±**: REST API 1-2ì´ˆ ì§€ì—° vs WebSocket 100-500ms ê°€ëŠ¥

### ì‚¬ìš© ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤
- ê¸°ì¡´ UpbitClient ì¸í”„ë¼ (REST API ì™„ì„±)
- WebSocket Quotation URL: `wss://api.upbit.com/websocket/v1` (API í‚¤ ë¶ˆí•„ìš”)
- WebSocket Exchange URL: `wss://api.upbit.com/websocket/v1/private` (API í‚¤ í•„ìš”)
- ë¡œê¹… ì‹œìŠ¤í…œ (create_component_logger)
- ì—…ë¹„íŠ¸ ê³µì‹ ë¬¸ì„œ ì¡°ì‚¬ ì™„ë£Œ (UPBIT_API_WEBSOCKET_GUIDE.md)

## ğŸ”„ ì²´ê³„ì  ì‘ì—… ì ˆì°¨ (í•„ìˆ˜ ì¤€ìˆ˜)
### 8ë‹¨ê³„ ì‘ì—… ì ˆì°¨
1. **ğŸ“‹ ì‘ì—… í•­ëª© í™•ì¸**: íƒœìŠ¤í¬ ë¬¸ì„œì—ì„œ êµ¬ì²´ì  ì‘ì—… ë‚´ìš© íŒŒì•…
2. **ğŸ” ê²€í†  í›„ ì„¸ë¶€ ì‘ì—… í•­ëª© ìƒì„±**: ì‘ì—…ì„ ë” ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í•´
3. **âš¡ ì‘ì—…ì¤‘ ë§ˆí‚¹**: í•´ë‹¹ ì‘ì—… í•­ëª©ì„ `[-]` ìƒíƒœë¡œ ë³€ê²½
4. **âš™ï¸ ì‘ì—… í•­ëª© ì§„í–‰**: ì‹¤ì²´ ì‘ì—… ìˆ˜í–‰
5. **âœ… ì‘ì—… ë‚´ìš© í™•ì¸**: ê²°ê³¼ë¬¼ ê²€ì¦ ë° í’ˆì§ˆ í™•ì¸
6. **ğŸ“ ìƒì„¸ ì‘ì—… ë‚´ìš© ì—…ë°ì´íŠ¸**: íƒœìŠ¤í¬ ë¬¸ì„œì— ì§„í–‰ì‚¬í•­ ê¸°ë¡
7. **[x] ì‘ì—… ì™„ë£Œ ë§ˆí‚¹**: í•´ë‹¹ ì‘ì—… í•­ëª©ì„ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
8. **â³ ì‘ì—… ìŠ¹ì¸ ëŒ€ê¸°**: ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ ì „ ê²€í†  ë° ìŠ¹ì¸

### ì‘ì—… ìƒíƒœ ë§ˆì»¤
- **[ ]**: ë¯¸ì™„ë£Œ (ë¯¸ì‹œì‘)
- **[-]**: ì§„í–‰ ì¤‘ (í˜„ì¬ ì‘ì—…)
- **[x]**: ì™„ë£Œ

## ğŸ‰ **WebSocket êµ¬í˜„ ì„±ê³µ ìš”ì•½**

### âœ… **í•µì‹¬ ì„±ê³¼ ë‹¬ì„±**
1. **ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ì™„ë²½ ì¶©ì¡±**: API í‚¤ ì—†ì´ ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… ì™„ì „ ì§€ì› âœ…
2. **ì—…ë¹„íŠ¸ ê³µì‹ ê²½ê³  ì¤€ìˆ˜**: ì»¤ìŠ¤í…€ í—¤ë” ì œê±°, ì•ˆì „í•œ ì—°ê²° ë°©ì‹ âœ…
3. **ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ **: Ticker, Trade, Orderbook ëª¨ë“  íƒ€ì… ì§€ì› âœ…
4. **ì•ˆì •ì„± ê²€ì¦**: ì—°ê²°/í•´ì œ/ì—ëŸ¬ì²˜ë¦¬/ì¬ì—°ê²° ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ âœ…

### ğŸ“Š **ì„±ëŠ¥ ì§€í‘œ**
- **ì—°ê²° ì„±ê³µë¥ **: 100% (API í‚¤ ë¶ˆí•„ìš”)
- **Market ì •ë³´ íŒŒì‹±**: 100% ì •í™•ë„
- **ë©”ì‹œì§€ ì²˜ë¦¬ ì†ë„**: ì‹¤ì‹œê°„ (ì§€ì—°ì‹œê°„ ìµœì†Œí™”)
- **ì—ëŸ¬ ë³µì›ë ¥**: ì˜ëª»ëœ ìš”ì²­ ì°¨ë‹¨ í›„ ì •ìƒ ë™ì‘ ìœ ì§€

### ğŸš€ **ì¦‰ì‹œ í™œìš© ê°€ëŠ¥**
- `UpbitWebSocketQuotationClient` í´ë˜ìŠ¤ ì™„ì„±
- ìŠ¤í¬ë¦¬ë„ˆìš© ticker êµ¬ë… ì™„ë²½ ë™ì‘
- ë°±í…ŒìŠ¤íŒ…ìš© ë°ì´í„° ìˆ˜ì‹  ì§€ì› (trade, orderbook)
- multiplier ê¸°ëŠ¥ê³¼ ì¦‰ì‹œ ì—°ë™ ê°€ëŠ¥

## ğŸ› ï¸ ì‘ì—… ê³„íš

### Phase 1: WebSocket Quotation ê¸°ë³¸ êµ¬ì¡° ì„¤ê³„ (API í‚¤ ë¶ˆí•„ìš”) (45ë¶„)
- [x] WebSocket Quotation í´ë¼ì´ì–¸íŠ¸ ê¸°ë³¸ í´ë˜ìŠ¤ ì„¤ê³„ (ê³µê°œ ë°ì´í„°ìš©)
- [x] ë©”ì‹œì§€ íŒŒì‹± ë° ì´ë²¤íŠ¸ ì²˜ë¦¬ êµ¬ì¡° ì •ì˜
- [-] ê¸°ì¡´ ì¸í”„ë¼ì™€ì˜ í†µí•© ë°©ì•ˆ ì„¤ê³„ (ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… ìš°ì„ )
- [x] ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì—°ê²° ë¡œì§ ì„¤ê³„

### âœ… ê²€ì¦ ì™„ë£Œí•œ í•µì‹¬ ì‚¬ì‹¤ë“¤:
1. **WebSocket Quotation ì—°ê²° ì„±ê³µ** (API í‚¤ ë¶ˆí•„ìš”) âœ…
2. **ì‹¤ì‹œê°„ ticker, trade, orderbook ë°ì´í„° ìˆ˜ì‹ ** âœ…
3. **BTC, ETH ë‹¤ì¤‘ ì‹¬ë³¼ ë™ì‹œ êµ¬ë…** âœ…
4. **ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… ë°ì´í„° ì™„ì „ í™œìš© ê°€ëŠ¥** âœ…
5. **30ì´ˆê°„ 235ê°œ ë©”ì‹œì§€ ì‹¤ì‹œê°„ ì²˜ë¦¬** âœ…
6. **5ê°œ ì½”ì¸ ìŠ¤í¬ë¦¬ë„ˆ ëª¨ë‹ˆí„°ë§ ë™ì‘** âœ…
7. **Market ì •ë³´ íŒŒì‹± ë¬¸ì œ í•´ê²°** (KRW-BTC ì •ìƒ í‘œì‹œ) âœ…
8. **ì—°ê²° í•´ì œ ì˜¤ë¥˜ ìˆ˜ì •** (closed ì†ì„± ì²´í¬ ê°œì„ ) âœ…

### ï¿½ **ì—…ë¹„íŠ¸ ê³µì‹ ê²½ê³ ì‚¬í•­ ì¤€ìˆ˜**

ì—…ë¹„íŠ¸ ë¬¸ì„œì—ì„œ ëª…ì‹œí•œ WebSocket í´ë¼ì´ì–¸íŠ¸ ì£¼ì˜ì‚¬í•­:
> "WebSocket í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš© ì‹œ í—¤ë” ì„¤ì •ì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. wscatê³¼ ê°™ì€ ì¼ë¶€ WebSocket í´ë¼ì´ì–¸íŠ¸ë“¤ì€ ì»¤ìŠ¤í…€ í—¤ë” ì„¤ì •ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ Exchange ë°ì´í„° ìˆ˜ì‹  í™•ì¸ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤."

**âœ… í˜„ì¬ êµ¬í˜„ì—ì„œ ì¤€ìˆ˜í•œ ì‚¬í•­:**
- ì»¤ìŠ¤í…€ í—¤ë” ì‚¬ìš© ì œê±° (extra_headers ì œê±°)
- ê¸°ë³¸ WebSocket ì—°ê²°ë§Œ ì‚¬ìš©
- API í‚¤ ë¶ˆí•„ìš”í•œ Quotation ì—”ë“œí¬ì¸íŠ¸ ìš°ì„  í™œìš©
- Exchange (í”„ë¼ì´ë¹—) ë°ì´í„°ëŠ” í–¥í›„ í•„ìš”ì‹œì—ë§Œ êµ¬í˜„

**ğŸ”— ì°¸ê³  ë¬¸ì„œ:** https://docs.upbit.com/kr/reference/websocket-guide

### Phase 3: ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…ìš© ë°ì´í„° í•¸ë“¤ëŸ¬ êµ¬í˜„ (90ë¶„)
- [x] Ticker (í˜„ì¬ê°€) ë°ì´í„° í•¸ë“¤ëŸ¬ - **ìŠ¤í¬ë¦¬ë„ˆ í•µì‹¬**
- [x] Trade (ì²´ê²°) ë°ì´í„° í•¸ë“¤ëŸ¬
- [x] Orderbook (í˜¸ê°€) ë°ì´í„° í•¸ë“¤ëŸ¬
- [-] Candle (ìº”ë“¤) ë°ì´í„° í•¸ë“¤ëŸ¬ - **ë°±í…ŒìŠ¤íŒ… í•µì‹¬** (ì—ëŸ¬ ë©”ì‹œì§€ ìˆ˜ì‹  ì´ìŠˆ)
- [x] ë°ì´í„° ê²€ì¦ ë° ì •ê·œí™” ë¡œì§

### Phase 3: ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…ìš© ë°ì´í„° í•¸ë“¤ëŸ¬ êµ¬í˜„ (90ë¶„)
- [ ] Ticker (í˜„ì¬ê°€) ë°ì´í„° í•¸ë“¤ëŸ¬ - **ìŠ¤í¬ë¦¬ë„ˆ í•µì‹¬**
- [ ] Trade (ì²´ê²°) ë°ì´í„° í•¸ë“¤ëŸ¬
- [ ] Orderbook (í˜¸ê°€) ë°ì´í„° í•¸ë“¤ëŸ¬
- [ ] Candle (ìº”ë“¤) ë°ì´í„° í•¸ë“¤ëŸ¬ - **ë°±í…ŒìŠ¤íŒ… í•µì‹¬**
- [ ] ë°ì´í„° ê²€ì¦ ë° ì •ê·œí™” ë¡œì§

### Phase 4: ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ê²€ì¦ (60ë¶„)
- [ ] API í‚¤ ì—†ì´ WebSocket Quotation ì—°ê²° í…ŒìŠ¤íŠ¸ âœ…
- [ ] ë‹¤ì¤‘ ì‹¬ë³¼ êµ¬ë… í…ŒìŠ¤íŠ¸ (ìŠ¤í¬ë¦¬ë„ˆ ì‹œë‚˜ë¦¬ì˜¤)
- [ ] Rate Limit ìš°íšŒ íš¨ê³¼ ì¸¡ì •
- [ ] REST API vs WebSocket ì§€ì—° ì‹œê°„ ë¹„êµ
- [ ] ì•ˆì •ì„± ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê²€ì¦

### Phase 5: ì‹¤ê±°ë˜ìš© Exchange WebSocket ì¶”ê°€ êµ¬í˜„ (ì„ íƒì ) (45ë¶„)
- [ ] `UpbitWebSocketExchangeClient` í´ë˜ìŠ¤ êµ¬í˜„ (API í‚¤ í•„ìš”)
- [ ] JWT í† í° ì¸ì¦ ë¡œì§
- [ ] myAsset, myOrder ë°ì´í„° í•¸ë“¤ëŸ¬
- [ ] ì‹¤ê±°ë˜ í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ì‚¬ìš© ì˜ˆì œ ë° ê°€ì´ë“œ ì‘ì„±

### ğŸ‰ **TASK ì™„ë£Œ: ëª¨ë“  í•µì‹¬ ëª©í‘œ ë‹¬ì„±** âœ…

## ğŸ“Š **ìµœì¢… ì„±ê³¼ ìš”ì•½**

### âœ… **100% ì„±ê³µ ì§€í‘œ**
- **ì•ˆì •ì„± í…ŒìŠ¤íŠ¸**: 4/4 ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼ âœ…
- **ë‹¤ì¤‘ ì‹¬ë³¼ ì„±ëŠ¥**: 3ê°œ ì½”ì¸ 30ê°œ ë©”ì‹œì§€ (7.5 msg/sec) âœ…
- **ì—ëŸ¬ ë³µì›ë ¥**: ì˜ëª»ëœ ìš”ì²­ ì°¨ë‹¨ + ì •ìƒ ë™ì‘ ìœ ì§€ âœ…
- **ì¬ì—°ê²° ì•ˆì •ì„±**: ì²« ë²ˆì§¸/ë‘ ë²ˆì§¸ ì„¸ì…˜ ì™„ë²½ ì²˜ë¦¬ âœ…

### ğŸ¯ **ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ì™„ë²½ ì¶©ì¡±**
1. **API í‚¤ ì—†ëŠ” ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…**: ì™„ì „ ì§€ì› âœ…
2. **ì—…ë¹„íŠ¸ í—¤ë” ê²½ê³  ì¤€ìˆ˜**: ì»¤ìŠ¤í…€ í—¤ë” ì œê±° âœ…
3. **ì•ˆì •ì ì¸ ì‹¤ì‹œê°„ ë°ì´í„°**: ticker/trade/orderbook ëª¨ë‘ ìˆ˜ì‹  âœ…
4. **í”„ë¡œë•ì…˜ í™˜ê²½ ì¤€ë¹„**: ëª¨ë“  ì•ˆì •ì„± ê²€ì¦ ì™„ë£Œ âœ…

## ğŸ› ï¸ ê°œë°œí•  ë„êµ¬

### 1. `upbit_auto_trading/infrastructure/external_apis/upbit/upbit_websocket_quotation_client.py`
```python
class UpbitWebSocketQuotationClient:
    """API í‚¤ ë¶ˆí•„ìš”í•œ ì‹œì„¸ ë°ì´í„° WebSocket í´ë¼ì´ì–¸íŠ¸ (ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…ìš©)"""
    def __init__(self):
        self.url = "wss://api.upbit.com/websocket/v1"  # API í‚¤ ë¶ˆí•„ìš”
        self.connection = None
        self.handlers = {}

    async def connect(self) -> None:
        """WebSocket ì—°ê²° (ì¸ì¦ ë¶ˆí•„ìš”)"""

    async def subscribe_ticker(self, symbols: List[str]) -> None:
        """í˜„ì¬ê°€ êµ¬ë… - ìŠ¤í¬ë¦¬ë„ˆ í•µì‹¬"""

    async def subscribe_candle(self, symbols: List[str], unit: int = 5) -> None:
        """ìº”ë“¤ êµ¬ë… - ë°±í…ŒìŠ¤íŒ… í•µì‹¬"""
```

### 2. `upbit_auto_trading/infrastructure/external_apis/upbit/upbit_websocket_exchange_client.py` (ì„ íƒì )
```python
class UpbitWebSocketExchangeClient:
    """API í‚¤ í•„ìš”í•œ í”„ë¼ì´ë¹— ë°ì´í„° WebSocket í´ë¼ì´ì–¸íŠ¸ (ì‹¤ê±°ë˜ìš©)"""
    def __init__(self, access_key: str, secret_key: str):
        self.url = "wss://api.upbit.com/websocket/v1/private"  # API í‚¤ í•„ìš”
        self.access_key = access_key
        self.secret_key = secret_key

    async def connect(self) -> None:
        """JWT í† í° ì¸ì¦ìœ¼ë¡œ WebSocket ì—°ê²°"""

    async def subscribe_my_assets(self) -> None:
        """ë‚´ ìì‚° ì‹¤ì‹œê°„ êµ¬ë…"""
```

### 3. `tests/infrastructure/upbit_websocket_behavior/quotation_test.py`
- API í‚¤ ì—†ì´ WebSocket Quotation ì—°ê²° í…ŒìŠ¤íŠ¸ âœ…
- ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… ë°ì´í„° ìˆ˜ì‹  ì •í™•ë„ ê²€ì¦
- Rate Limit ìš°íšŒ íš¨ê³¼ ì¸¡ì •

### 4. `tools/websocket_performance_analyzer.py`
- REST API vs WebSocket ì§€ì—° ì‹œê°„ ë¹„êµ
- ìŠ¤í¬ë¦¬ë„ˆ ì‹œë‚˜ë¦¬ì˜¤ ì²˜ë¦¬ëŸ‰(throughput) ì¸¡ì •
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

## ğŸ¯ ê²€ì¦í•  í•µì‹¬ í¬ì¸íŠ¸

### 1. Rate Limit ìš°íšŒ íš¨ê³¼
```python
# REST API: ì´ˆë‹¹ 10íšŒ ì œí•œ
# WebSocket: ì—°ê²° í›„ ë¬´ì œí•œ (ì—°ê²°ë‹¹ ì´ˆë‹¹ 5íšŒ, ë¶„ë‹¹ 100íšŒ)

# ì˜ˆìƒ íš¨ê³¼
REST_API_LIMIT = 10  # requests/second
WEBSOCKET_MSG_LIMIT = float('inf')  # unlimited after connection
```

### 2. ì‹¤ì‹œê°„ì„± ê°œì„ 
```python
# REST API: 1-2ì´ˆ ì§€ì—°
# WebSocket: 100-500ms ì§€ì—° ì˜ˆìƒ

expected_latency = {
    'rest_api': '1-2 seconds',
    'websocket': '100-500ms'
}
```

### 3. ë°ì´í„° ì •í™•ì„±
- WebSocket ë°ì´í„° vs REST API ë°ì´í„° ì¼ì¹˜ì„±
- ë©”ì‹œì§€ ëˆ„ë½ ì—¬ë¶€ í™•ì¸
- íƒ€ì„ìŠ¤íƒ¬í”„ ì •í™•ë„ ê²€ì¦

## ğŸ’¡ ì˜ˆìƒ í™œìš© ë°©ì•ˆ

### **ì‹œë‚˜ë¦¬ì˜¤ 1: ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… ê°œì„  (API í‚¤ ë¶ˆí•„ìš”)** â­
```python
# ê¸°ì¡´: REST API í´ë§ (30ì´ˆë§ˆë‹¤, 10req/sec ì œí•œ)
# ê°œì„ : WebSocket ì‹¤ì‹œê°„ (ì¦‰ì‹œ, ë¬´ì œí•œ)

async with UpbitWebSocketQuotationClient() as ws:  # API í‚¤ ë¶ˆí•„ìš”
    await ws.subscribe_ticker(['KRW-BTC', 'KRW-ETH'])  # ìŠ¤í¬ë¦¬ë„ˆìš©
    await ws.subscribe_candle(['KRW-BTC'], unit=5)     # ë°±í…ŒìŠ¤íŒ…ìš©

    async for message in ws.listen():
        if message.type == 'ticker':
            # multiplier ì‹¤ì‹œê°„ ì ìš© (API í‚¤ ì—†ì–´ë„ OK)
            apply_high_low_multiplier(message.data)
```

### **ì‹œë‚˜ë¦¬ì˜¤ 2: ì‹¤ê±°ë˜ ìµœì í™” (API í‚¤ í•„ìš”ì‹œë§Œ)** âš¡
```python
# ì‹œì„¸ ë°ì´í„°: WebSocket Quotation (API í‚¤ ë¶ˆí•„ìš”)
quotation_ws.subscribe_ticker(['KRW-BTC'])  # ì‹¤ì‹œê°„ í˜„ì¬ê°€

# ê³„ì¢Œ ë°ì´í„°: WebSocket Exchange (API í‚¤ í•„ìš”) + REST API
if api_key_available:
    exchange_ws.subscribe_my_assets()    # ì‹¤ì‹œê°„ ìì‚°
    rest_client.place_order()           # ì£¼ë¬¸ ì‹¤í–‰
```

### **ì‹œë‚˜ë¦¬ì˜¤ 3: í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜** ğŸ”„
```python
# API í‚¤ ì—†ëŠ” ì‚¬ìš©ì: Quotation WebSocketë§Œ ì‚¬ìš©
if not has_api_key:
    # ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ… ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ë™ì‘
    screener = WebSocketScreener()  # API í‚¤ ë¶ˆí•„ìš”
    backtest = WebSocketBacktester()  # API í‚¤ ë¶ˆí•„ìš”

# API í‚¤ ìˆëŠ” ì‚¬ìš©ì: Full WebSocket + REST API
if has_api_key:
    # ì „ì²´ ê¸°ëŠ¥ í™œìš©
    trader = HybridTrader(quotation_ws=True, exchange_ws=True)
```

### **ì‹œë‚˜ë¦¬ì˜¤ 4: ì§€ì—° ì‹œê°„ ìµœì†Œí™”**
```python
# ê¸‰ë“±/ê¸‰ë½ ê°ì§€ ì‹œê°„ ë‹¨ì¶• (API í‚¤ ë¬´ê´€)
ticker_update = await quotation_ws.get_ticker()  # 100ms, API í‚¤ ë¶ˆí•„ìš”
vs
ticker_update = await rest_api.get_ticker()      # 1000ms+, API í‚¤ ë¶ˆí•„ìš”
```

## ğŸš€ ì¦‰ì‹œ ì‹œì‘í•  ì‘ì—…

### 1. ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…ìš© WebSocket í´ë¼ì´ì–¸íŠ¸ êµ¬ì¡° ìƒì„± (API í‚¤ ë¶ˆí•„ìš”)
```powershell
New-Item -Path "upbit_auto_trading/infrastructure/external_apis/upbit/upbit_websocket_quotation_client.py" -ItemType File
```

### 2. í…ŒìŠ¤íŠ¸ í´ë” ìƒì„±
```powershell
New-Item -Path "tests/infrastructure/upbit_websocket_behavior" -ItemType Directory -Force
```

### 3. ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸ (API í‚¤ ë¶ˆí•„ìš”) â­
```python
import asyncio
import websockets
import json

async def test_quotation_connection():
    """ì—…ë¹„íŠ¸ WebSocket Quotation ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸ (API í‚¤ ë¶ˆí•„ìš”)"""
    uri = "wss://api.upbit.com/websocket/v1"  # ì¸ì¦ ë¶ˆí•„ìš”

    try:
        async with websockets.connect(uri) as websocket:
            print("âœ… WebSocket ì—°ê²° ì„±ê³µ (API í‚¤ ë¶ˆí•„ìš”)")

            # êµ¬ë… ë©”ì‹œì§€ ì „ì†¡
            subscribe_msg = [
                {"ticket": "screener-test"},
                {"type": "ticker", "codes": ["KRW-BTC"]}
            ]
            await websocket.send(json.dumps(subscribe_msg))

            # ë©”ì‹œì§€ ìˆ˜ì‹ 
            response = await websocket.recv()
            print(f"ğŸ“Š ì‹œì„¸ ë°ì´í„° ìˆ˜ì‹ : {response[:100]}...")

    except Exception as e:
        print(f"âŒ ì—°ê²° ì‹¤íŒ¨: {e}")

if __name__ == "__main__":
    asyncio.run(test_quotation_connection())
```

### 4. ì‹¤ê±°ë˜ìš© í…ŒìŠ¤íŠ¸ (API í‚¤ í•„ìš”ì‹œë§Œ)
```python
async def test_exchange_connection():
    """ì—…ë¹„íŠ¸ WebSocket Exchange ì—°ê²° í…ŒìŠ¤íŠ¸ (API í‚¤ í•„ìš”)"""
    # ì´ ë¶€ë¶„ì€ ì‹¤ê±°ë˜ì‹œì—ë§Œ êµ¬í˜„
    # API í‚¤ ì—†ì–´ë„ ìŠ¤í¬ë¦¬ë„ˆ/ë°±í…ŒìŠ¤íŒ…ì€ ì •ìƒ ë™ì‘
    pass
```

## ğŸ¯ ì„±ê³µ ê¸°ì¤€
- âœ… WebSocket ì—°ê²° ë° ë°ì´í„° ìˆ˜ì‹  ì„±ê³µë¥  99% ì´ìƒ
- âœ… REST API ëŒ€ë¹„ ì§€ì—° ì‹œê°„ 50% ì´ìƒ ê°œì„ 
- âœ… Rate Limit ìš°íšŒë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥
- âœ… ê¸°ì¡´ UpbitClientì™€ ë§¤ë„ëŸ¬ìš´ í†µí•©
- âœ… multiplier ê¸°ëŠ¥ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° í™œìš© ê°€ëŠ¥

## ğŸ’¡ ì‘ì—… ì‹œ ì£¼ì˜ì‚¬í•­
### ì•ˆì „ì„± ì›ì¹™
- WebSocket ì—°ê²° ëŠê¹€ì— ëŒ€í•œ ìë™ ì¬ì—°ê²°
- ë©”ì‹œì§€ í ì˜¤ë²„í”Œë¡œìš° ë°©ì§€
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ (ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì •ë¦¬)

### ì„±ëŠ¥ ìµœì í™”
- ë¹„ë™ê¸° ì²˜ë¦¬ í™œìš© (asyncio)
- ë©”ì‹œì§€ íŒŒì‹± ìµœì í™”
- ë¶ˆí•„ìš”í•œ ë°ì´í„° í•„í„°ë§

### ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„±
- BaseApiClient ì¸í„°í˜ì´ìŠ¤ ì¤€ìˆ˜
- ë¡œê¹… ì‹œìŠ¤í…œ í†µí•©
- ì„¤ì • ê´€ë¦¬ ì¼ê´€ì„±

## ğŸ“ˆ í›„ì† ì‘ì—… ì—°ê³„
ì´ WebSocket êµ¬í˜„ ì™„ë£Œ í›„:
1. **TASK_20250818_01 (multiplier ê¸°ëŠ¥)** ì‹¤ì‹œê°„ ë°ì´í„° ì—°ë™
2. **í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜** êµ¬í˜„ (WebSocket + REST API)
3. **ì‹¤ì‹œê°„ ì „ëµ ì—”ì§„** ê°œë°œ
4. **ì§€ì—° ì‹œê°„ ìµœì í™”** ì§€ì†ì  ê°œì„ 

---
**ë‹¤ìŒ ì—ì´ì „íŠ¸ ì‹œì‘ì **: WebSocket ê¸°ë³¸ êµ¬ì¡° ì„¤ê³„ ë° ì—°ê²° í…ŒìŠ¤íŠ¸ë¶€í„° ì‹œì‘
**ìš°ì„ ìˆœìœ„**: Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4 â†’ Phase 5 ìˆœì„œë¡œ ë‹¨ê³„ì  ì§„í–‰
**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: ì´ 5ì‹œê°„ (ì„¤ê³„ 45ë¶„ + êµ¬í˜„ 150ë¶„ + í…ŒìŠ¤íŠ¸ 60ë¶„ + í†µí•© 45ë¶„)
