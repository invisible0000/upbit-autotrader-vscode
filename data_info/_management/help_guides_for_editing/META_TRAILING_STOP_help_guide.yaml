variable_id: META_TRAILING_STOP
help_documents:
  concept:
    title: META_TRAILING_STOP (트레일링 스탑) 개념과 정의
    content: |
      ## 트레일링 스탑의 기본 개념

      META_TRAILING_STOP은 추적 변수의 극값(최고점/최저점)을 실시간으로 기록하고,
      설정된 임계값만큼 벗어나면 신호를 발생시킨 후 자동 비활성화되는
      동적 위험 관리 도구입니다. 수익 보호와 손실 제한을 동시에 제공합니다.

      ### 기술적 정의

      ```
      상향 추적: tracked_high = MAX(tracked_high, current_value)
               신호 조건: current_value <= tracked_high × (1 - threshold%)

      하향 추적: tracked_low = MIN(tracked_low, current_value)
               신호 조건: current_value >= tracked_low × (1 + threshold%)
      ```

      ### 변수 메타데이터

      - **Purpose Category**: price
      - **Chart Category**: overlay
      - **Comparison Group**: price_comparable
      - **단위**: KRW (원화 기준) 또는 % (비율)
      - **동작 특성**: 일회성 신호 후 자동 비활성화

      ### 동적 추적 메커니즘

      **상향 추적 (Upward Tracking)**: 최고점을 지속적으로 갱신하며 하락을 감시합니다.
      수익이 증가하는 동안 추적 기준점이 상승하여 더 높은 수준에서 보호받습니다.
      주로 수익 보호와 이익 실현에 사용됩니다.

      **하향 추적 (Downward Tracking)**: 최저점을 지속적으로 갱신하며 상승을 감시합니다.
      손실이 확대되는 동안 추적 기준점이 하락하여 반등시 조기 신호를 제공합니다.
      주로 손실 제한과 반등 포착에 사용됩니다.

      ### 일회성 보호 메커니즘

      트레일링 스탑은 신호 발생 즉시 비활성화되어 일회성 보호만 제공합니다.
      이는 과도한 신호 발생을 방지하고, 명확한 진입/청산 시점을 제공하기 위함입니다.
      지속적인 보호가 필요한 경우 새로운 트레일링 스탑을 재설정해야 합니다.

      ### 시장 적응성

      트레일링 스탑은 시장의 방향성과 변동성에 자동으로 적응합니다.
      강한 상승장에서는 높은 수익 보호 수준을 제공하고,
      변동성 큰 시장에서는 적절한 여유 공간을 제공하여 조기 청산을 방지합니다.
  usage:
    title: 트리거 빌더에서 META_TRAILING_STOP 실전 활용법
    content: |
      ## 트리거 빌더 조건 설정 방법

      ### 기본 수익 보호 전략

      ```
      조건 1: TRAILING_STOP_SIGNAL = TRUE  # 트레일링 스탑 신호 발생
      조건 2: PROFIT_PERCENT > 3  # 최소 수익 확보 후 활성화
      조건 3: CURRENT_PRICE <= TRACKED_HIGH × 0.95  # 고점 대비 5% 하락
      ```

      ### 수익 보호 전략 구현

      **표준 수익 보호:**
      ```
      트레일링 설정:
      - 추적 방향: 상향 추적 (극값 갱신)
      - 추적 변수: CURRENT_PRICE
      - 임계값: -5% (극값 비율)
      - 활성화 조건: PROFIT_PERCENT > 5

      동작 예시:
      진입가 5천만원 → 6천만원 도달 (20% 수익)
      → 트레일링 활성화 → 5700만원 하회시 매도 신호
      ```

      **단계별 수익 보호:**
      ```
      1단계: PROFIT_PERCENT > 10 → 트레일링 -3% 설정
      2단계: PROFIT_PERCENT > 25 → 트레일링 -5% 설정
      3단계: PROFIT_PERCENT > 50 → 트레일링 -7% 설정

      높은 수익일수록 더 큰 하락 허용으로 과도한 조기 청산 방지
      ```

      ### 손실 제한 전략 구현

      **진입가 기준 손절:**
      ```
      손절 트레일링:
      - 추적 방향: 하향 추적
      - 추적 변수: AVG_BUY_PRICE (고정 기준점)
      - 임계값: -7% (진입가 비율)

      실행 조건:
      CURRENT_PRICE <= AVG_BUY_PRICE × 0.93
      → 7% 손실시 즉시 손절 신호
      ```

      **동적 손절 라인:**
      ```
      변동성 기반 손절:
      - 임계값 = -(ATR / CURRENT_PRICE × 300)
      - 고변동성시: 더 큰 손절 허용 (-10%)
      - 저변동성시: 더 작은 손절 설정 (-5%)
      ```

      ### 반등 포착 전략

      **바닥 반등 감지:**
      ```
      반등 트레일링:
      - 추적 방향: 하향 추적 (최저점 추적)
      - 추적 변수: CURRENT_PRICE
      - 임계값: +3% (극값 비율)

      매수 신호:
      하락 중 최저점 갱신 → 3% 반등시 매수 진입
      ```

      ### 조합 전략 구현

      **이동평균 + 트레일링 스탑:**
      ```
      진입 조건:
      - CURRENT_PRICE > EMA_20  # 20일선 상향 돌파
      - EMA_20 > EMA_50  # 상승 추세 확인

      트레일링 보호:
      - 진입 후 즉시 상향 추적 -4% 설정
      - EMA_20 이탈시 트레일링과 별도로 청산 검토
      ```

      **RSI + 트레일링 스탑 조합:**
      ```
      과매도 진입:
      - RSI < 30  # 과매도 구간 진입
      - CURRENT_PRICE < BOLLINGER_BAND_LOWER

      보호 전략:
      - 진입가 기준 -5% 손절 트레일링
      - RSI > 50 도달시 상향 추적 -3% 추가 설정
      ```

      ### 다중 시간 프레임 활용

      **계층적 트레일링 시스템:**
      ```
      장기 트레일링 (일봉):
      - 주간 고점 기준 -7% 트레일링
      - 주요 추세 전환 감지용

      단기 트레일링 (15분봉):
      - 일중 고점 기준 -3% 트레일링
      - 단기 수익 실현용
      ```
  advanced:
    title: META_TRAILING_STOP 고급 알고리즘 최적화
    content: |
      ## 고급 트레일링 수학적 모델

      ### 적응형 임계값 시스템

      시장 조건에 따른 동적 임계값 조정:
      ```
      기본 임계값 = 설정값 (예: -5%)
      변동성 계수 = ATR / CURRENT_PRICE
      시장 조건 계수 = (RSI - 50) / 50

      최종 임계값 = 기본값 × (1 + 변동성계수 × 0.5 + 시장조건계수 × 0.3)

      예시: 고변동성 + 과매수 → 임계값 확대 (-7%)
           저변동성 + 과매도 → 임계값 축소 (-3%)
      ```

      ### 확률적 트레일링 모델

      **베이지안 업데이트 기반:**
      ```
      청산 확률 = P(추세전환 | 현재하락폭, 과거패턴, 시장조건)

      동적 실행:
      확률 > 70%: 즉시 청산
      확률 50-70%: 50% 물량 청산
      확률 < 50%: 트레일링 지속
      ```

      ### 기관투자자 수준의 트레일링

      **포트폴리오 레벨 트레일링:**
      ```
      개별 종목 트레일링 = 기본설정 × 포트폴리오 비중 가중치

      고비중 종목 (>20%): 보수적 트레일링 (-3%)
      중비중 종목 (5-20%): 표준 트레일링 (-5%)
      저비중 종목 (<5%): 공격적 트레일링 (-7%)

      위험 분산 효과로 개별 종목 변동성 허용도 조정
      ```

      ### 볼륨 가중 트레일링

      **거래량 기반 임계값 조정:**
      ```
      거래량 계수 = VOLUME / VOLUME_SMA(20)

      고거래량 (계수 > 2.0): 임계값 확대 (-7%)
      # 강한 매도 압력 → 더 큰 하락 허용

      저거래량 (계수 < 0.5): 임계값 축소 (-3%)
      # 약한 매도 압력 → 조기 보호
      ```

      ### 옵션 시장 연계 트레일링

      **내재변동성 기반 조정:**
      ```
      IV_비율 = 현재_내재변동성 / 역사적_변동성

      트레일링 조정:
      IV_비율 > 1.5: 임계값 확대 (큰 변동성 예상)
      IV_비율 < 0.8: 임계값 축소 (안정성 예상)
      ```

      ### 머신러닝 기반 트레일링

      **LSTM 예측 모델 활용:**
      ```
      입력 변수:
      - 과거 30일 가격/거래량 패턴
      - 현재 트레일링 상태 (고점 갱신 여부)
      - 거시경제 지표

      출력:
      - 다음 5일간 하락 확률
      - 예상 최대 하락폭
      - 최적 임계값 추천
      ```

      ### 백테스팅 최적화

      **Walk-Forward 트레일링 최적화:**
      ```
      최적화 과정:
      1. 3개월 데이터로 최적 임계값 탐색 (-1% ~ -15%)
      2. 다음 2주간 아웃오브샘플 테스트
      3. 위험조정수익률 기준 파라미터 선택
      4. 2주마다 롤링 업데이트

      평가 지표:
      - 보호 효율성: (트레일링 수익 - 보유 수익) / 최대 드로우다운
      - 신호 적시성: 실제 고점 - 트레일링 신호 시점
      ```

      ### 극한 상황 대응

      **플래시 크래시 대응:**
      ```
      극한 상황 감지:
      5분간 -10% 이상 하락 OR 일일 거래량 > 평균의 1000%

      비상 트레일링:
      - 모든 기존 트레일링 무효화
      - 비상 임계값 -15% 설정
      - 호가창 유동성 확인 후 청산
      ```

      ### 심리적 분석 통합

      **공포/탐욕 지수 연계:**
      ```
      Fear & Greed Index 기반 조정:

      극도 탐욕 (>80): 보수적 트레일링 (-3%)
      탐욕 (60-80): 표준 트레일링 (-5%)
      중립 (40-60): 표준 트레일링 (-5%)
      공포 (20-40): 공격적 트레일링 (-7%)
      극도 공포 (<20): 매우 공격적 트레일링 (-10%)
      ```

      ### 세금 최적화 트레일링

      **세무 효율적 청산:**
      ```
      보유 기간 고려:
      단기 보유 (<1년): 보수적 트레일링으로 세금 부담 최소화
      장기 보유 (>1년): 공격적 트레일링으로 수익 극대화

      연말 효과:
      11-12월: 손실 실현 목적 트레일링 (-3%)
      1-2월: 이익 이연 목적 트레일링 (-7%)
      ```

      ### 성과 측정 전문 지표

      **트레일링 특화 메트릭:**
      ```
      보호 효율성 = 방어한 손실 / 포기한 수익
      타이밍 정확도 = 고점 대비 청산가 비율
      재진입 성공률 = 트레일링 후 재진입 수익률
      ```

      ### 주의사항

      - 횡보장에서 잦은 트레일링 신호로 수수료 증가
      - 일회성 신호로 지속적 보호 불가
      - 갭 하락시 예상보다 큰 손실 발생 가능
      - 과도한 최적화는 실제 시장에서 성능 저하 위험
