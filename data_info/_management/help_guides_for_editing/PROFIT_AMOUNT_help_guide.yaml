variable_id: PROFIT_AMOUNT
help_documents:
  concept:
    title: 현재 수익 금액의 이해
    content: |
      현재 수익 금액은 매수 평균가 대비 현재 시장가격 기준으로 계산된 절대적 손익을 나타내는 핵심 지표입니다.
      이는 투자 성과를 실시간으로 모니터링하고 손익분기점 관리를 위한 기본적이면서도 중요한 상태 변수입니다.

      ## 기본 개념과 계산 방식
      현재 수익 금액은 (현재가 - 평균 매수가) × 보유 수량으로 계산됩니다.
      예를 들어, 평균 매수가가 100,000원이고 현재가가 110,000원이며 1개를 보유한다면,
      현재 수익 금액은 (110,000 - 100,000) × 1 = 10,000원이 됩니다.

      이 지표는 capital_comparable 그룹에 속하여 원화 기준의 다른 자본 관련 변수들과 직접 비교가 가능합니다.
      차트상에서는 subplot 형태로 표시되어 가격 차트와 독립적으로 손익 변화를 추적할 수 있습니다.

      ## 손익의 실시간 성격
      현재 수익 금액은 시장가격이 변동할 때마다 실시간으로 업데이트됩니다.
      이는 실현손익이 아닌 미실현손익(unrealized PnL)을 의미하며,
      실제 매도를 통해 손익을 확정하기 전까지는 변동할 수 있는 잠재적 손익입니다.

      포지션을 분할 매수했을 경우, 가중평균 매수가를 기준으로 현재 수익 금액이 계산됩니다.
      예를 들어, 첫 번째 매수에서 1개를 100,000원에, 두 번째 매수에서 1개를 120,000원에 구매했다면,
      평균 매수가는 110,000원이 되고, 현재가가 115,000원일 때 수익 금액은 (115,000 - 110,000) × 2 = 10,000원입니다.

      ## 절대값과 상대값의 의미
      현재 수익 금액은 절대적인 원화 단위로 표시되어 실제 손익의 크기를 직관적으로 파악할 수 있습니다.
      이는 수익률(percentage)과 달리 투자 규모에 따른 실제 손익의 차이를 명확하게 보여줍니다.
      10% 수익률이라도 100만원 투자와 1억원 투자의 절대 수익은 10만원과 1천만원으로 큰 차이가 있습니다.

      ## 심리적 영향과 행동 경제학적 측면
      현재 수익 금액은 투자자의 심리적 상태에 직접적인 영향을 미칩니다.
      손실 영역(음수)에서는 손실 회피 편향이 작동하여 손절을 미루는 경향이 나타나고,
      수익 영역(양수)에서는 조기 이익 실현 성향이 강해지는 것이 일반적입니다.

      특히 큰 금액의 수익이나 손실이 표시될 때는 감정적 거래 결정을 유발할 수 있으므로,
      사전에 설정한 목표 수익과 최대 허용 손실 기준을 준수하는 것이 중요합니다.

      ## 리스크 관리에서의 역할
      현재 수익 금액은 포지션별 리스크 모니터링의 핵심 지표입니다.
      절대 손실 한도(maximum drawdown)를 설정하여 특정 금액 이상의 손실이 발생하면
      자동으로 손절 주문을 실행하는 리스크 관리 시스템의 기준이 됩니다.

      또한 목표 수익 금액 달성 시 부분 익절이나 전체 익절을 실행하는
      이익 실현 전략의 트리거로도 활용됩니다.

  usage:
    title: PROFIT_AMOUNT 활용 전략
    content: |
      현재 수익 금액은 트리거 빌더에서 손익 기반 매매 조건을 설정하는 핵심 변수입니다.
      절대적 손익 기준을 통해 감정에 좌우되지 않는 체계적인 거래 전략을 구현할 수 있습니다.

      ## 트리거 빌더 기본 문법
      ```
      조건: PROFIT_AMOUNT >= 50000
      액션: 포지션 50% 익절 매도

      조건: PROFIT_AMOUNT <= -30000
      액션: 전체 포지션 손절 매도

      조건: PROFIT_AMOUNT > 100000
      액션: 트레일링 스탑 활성화
      ```

      수익 금액을 기준으로 한 단계별 익절 전략은 수익을 보호하면서 추가 상승 가능성을 열어둡니다.
      첫 번째 목표 도달시 일부 익절로 원금을 회수하고, 나머지 포지션으로 추가 수익을 추구하는 방식입니다.

      ## 손절선 관리 전략
      ```
      IF PROFIT_AMOUNT <= -50000:
          1차 경고: 포지션 30% 매도

      IF PROFIT_AMOUNT <= -100000:
          2차 손절: 포지션 70% 매도

      IF PROFIT_AMOUNT <= -150000:
          최종 손절: 전체 포지션 매도
      ```

      단계적 손절 전략은 급격한 하락에서도 일부 포지션을 보존하여 반등 기회를 잡을 수 있게 합니다.
      각 단계별 손절 기준은 개인의 리스크 허용도와 투자 규모에 따라 조정되어야 합니다.

      ## 동적 목표 수익 관리
      ```
      IF PROFIT_AMOUNT >= INITIAL_TARGET:
          새로운 목표 = PROFIT_AMOUNT * 1.5
          손절선 = PROFIT_AMOUNT * 0.5로 상향 조정

      IF 현재 수익이 최고점 대비 20% 하락:
          보유 포지션 50% 익절
      ```

      수익이 목표에 도달하면 새로운 더 높은 목표를 설정하고 손절선도 함께 상향 조정합니다.
      이는 상승 추세에서 수익을 극대화하면서도 하락시 기본 수익을 보호하는 전략입니다.

      ## 변동성 기반 수익 관리
      ```
      daily_volatility = calculate_daily_volatility(20)

      IF PROFIT_AMOUNT >= daily_volatility * POSITION_SIZE * 2:
          고변동성 대응: 포지션 40% 익절

      IF PROFIT_AMOUNT <= -daily_volatility * POSITION_SIZE * 1.5:
          변동성 손절: 포지션 60% 매도
      ```

      시장 변동성을 고려한 동적 손익 기준 설정은 시장 상황에 적응적인 거래를 가능하게 합니다.
      높은 변동성 구간에서는 더 보수적인 기준을, 낮은 변동성에서는 더 공격적인 기준을 적용합니다.

      ## 시간 기반 수익 실현
      ```
      IF PROFIT_AMOUNT > 0 AND holding_period > 7일:
          장기 보유 보너스: 익절 기준 20% 상향

      IF PROFIT_AMOUNT > 0 AND holding_period < 1일:
          단기 차익: 즉시 익절 고려
      ```

      보유 기간을 고려한 수익 실현 전략은 세금 효율성과 거래 비용을 최적화합니다.
      장기 보유시 더 높은 수익을 추구하고, 단기 거래에서는 빠른 차익 실현을 우선시합니다.

      ## 포트폴리오 수준 수익 관리
      개별 포지션의 수익 금액뿐만 아니라 전체 포트폴리오 수준에서의 수익 관리도 중요합니다.
      한 종목에서 큰 수익이 발생했을 때 다른 종목의 손실과 상쇄하여 전체적인 리스크를 관리할 수 있습니다.

  advanced:
    title: 현재 수익 금액 고급 활용 전략
    content: |
      현재 수익 금액을 활용한 고급 전략은 행동재무학과 정량분석을 결합하여 보다 정교한 손익 관리를 구현합니다.
      기관투자자 수준의 위험 관리 기법과 심리적 편향을 극복하는 체계적 접근법을 포함합니다.

      ## 행동재무학 기반 손익 관리
      ```python
      # 프로스펙트 이론 적용
      loss_aversion_factor = 2.25  # 손실이 이익보다 2.25배 더 크게 느껴짐

      adjusted_profit_threshold = base_profit_threshold * loss_aversion_factor

      IF PROFIT_AMOUNT >= adjusted_profit_threshold:
          조기 익절 방지: 목표 수익 50% 상향 조정

      IF PROFIT_AMOUNT <= -base_loss_threshold / loss_aversion_factor:
          손실 확대 방지: 즉시 손절 실행
      ```

      프로스펙트 이론을 적용하여 투자자의 심리적 편향을 수치화하고 이를 보정하는 거래 기준을 설정합니다.
      손실 회피 성향과 조기 익절 성향을 고려하여 더 합리적인 손익 기준을 수립할 수 있습니다.

      ## 켈리 기준 연동 손익 관리
      ```python
      # 켈리 기준과 현재 수익의 결합
      kelly_optimal_fraction = calculate_kelly_fraction(win_rate, avg_win, avg_loss)
      current_position_value = POSITION_SIZE * CURRENT_PRICE
      optimal_position_value = TOTAL_CAPITAL * kelly_optimal_fraction

      IF PROFIT_AMOUNT > 0 AND current_position_value > optimal_position_value * 1.2:
          오버포지션 조정: 초과분에 해당하는 수익 즉시 실현
      ```

      켈리 기준과 연동하여 최적 포지션 크기를 벗어났을 때 수익 실현을 통해 포지션을 조정합니다.
      이는 수학적으로 최적화된 포지션 관리와 수익 실현을 동시에 달성하는 전략입니다.

      ## VaR 기반 동적 손실 한도
      ```python
      # 95% 신뢰구간 VaR 계산
      daily_returns = calculate_daily_returns(period=252)
      var_95 = calculate_var(daily_returns, confidence=0.95)

      dynamic_stop_loss = POSITION_SIZE * CURRENT_PRICE * var_95 * holding_period_adjustment

      IF PROFIT_AMOUNT <= -dynamic_stop_loss:
          VaR 기반 손절 실행
      ```

      Value at Risk(VaR) 모델을 활용하여 통계적으로 신뢰할 수 있는 손실 한도를 설정합니다.
      보유 기간과 시장 변동성을 고려한 동적 손절선은 과도한 손실을 방지하면서도 정상적인 변동성은 허용합니다.

      ## 샤프 비율 최적화 수익 실현
      ```python
      # 실시간 샤프 비율 모니터링
      current_sharpe = calculate_rolling_sharpe(returns, period=30)

      IF PROFIT_AMOUNT > 0 AND current_sharpe < threshold_sharpe:
          리스크 대비 수익 악화: 포지션 50% 감축

      IF current_sharpe > target_sharpe AND PROFIT_AMOUNT > min_profit:
          최적 포인트 도달: 단계적 익절 시작
      ```

      샤프 비율을 실시간으로 모니터링하여 리스크 대비 수익률이 최적화된 시점에서 익절을 실행합니다.
      이는 단순한 절대 수익보다 리스크 조정 수익률을 고려한 보다 정교한 접근법입니다.

      ## 기계학습 기반 수익 예측 모델
      ```python
      # LSTM 기반 수익 궤적 예측
      predicted_profit_path = lstm_model.predict(current_market_features)

      IF predicted_profit_path.max() < PROFIT_AMOUNT * 1.1:
          수익 정점 예측: 현재 수준에서 익절

      IF predicted_profit_path.min() < PROFIT_AMOUNT * 0.8:
          하락 위험 감지: 방어적 포지션 축소
      ```

      머신러닝 모델을 활용하여 현재 수익이 향후 어떻게 변화할지 예측하고,
      예측 결과에 따라 선제적인 포지션 조정을 실행합니다.

      ## 멀티 타임프레임 수익 분석
      다양한 시간대에서의 수익 패턴을 분석하여 최적의 익절/손절 타이밍을 포착합니다.
      분봉, 시간봉, 일봉 단위에서의 수익 변화율을 종합적으로 고려한 의사결정 프레임워크를 구축할 수 있습니다.

      이러한 고급 기법들은 단순한 절대 수익 기준을 넘어서 확률론적 사고와 정량적 분석을 통합한 체계적인 손익 관리를 가능하게 합니다.
