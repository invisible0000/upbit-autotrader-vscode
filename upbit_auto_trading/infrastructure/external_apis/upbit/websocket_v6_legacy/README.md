# ğŸ“¡ ì—…ë¹„íŠ¸ WebSocket v6.0 - ì „ì—­ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ

## ğŸ¯ **í”„ë¡œì íŠ¸ ê°œìš”**

WebSocket v6.0ì€ ì—…ë¹„íŠ¸ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì˜ **ì „ì—­ WebSocket ê´€ë¦¬ ì†”ë£¨ì…˜**ì…ë‹ˆë‹¤.
ê¸°ì¡´ v5ì˜ ê°œë³„ í´ë¼ì´ì–¸íŠ¸ ë°©ì‹ì—ì„œ **ì „ì—­ ë‹¨ì¼ ê´€ë¦¬ ë°©ì‹**ìœ¼ë¡œ ì§„í™”í•˜ì—¬
ì—…ë¹„íŠ¸ WebSocketì˜ ë®ì–´ì“°ê¸° íŠ¹ì„±ì— ì™„ë²½ ëŒ€ì‘í•˜ê³  ë‹¤ì¤‘ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì‹œ ë°œìƒí•˜ëŠ” êµ¬ë… ì¶©ëŒì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•©ë‹ˆë‹¤.

### ğŸš€ **í•µì‹¬ ëª©í‘œ**
- **ì „ì—­ êµ¬ë… ê´€ë¦¬**: ëª¨ë“  ì„œë¸Œì‹œìŠ¤í…œì˜ WebSocket ìš”ì²­ì„ ì¤‘ì•™ì—ì„œ í†µí•© ê´€ë¦¬
- **API í‚¤ ì„ íƒì  ì§€ì›**: Public ê¸°ëŠ¥ì€ API í‚¤ ì—†ì´ë„ ì™„ì „ ë™ì‘, Private ê¸°ëŠ¥ì€ API í‚¤ ìˆì„ ë•Œë§Œ í™œì„±í™”
- **ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤**: ë² ì´ìŠ¤ WebSocket ì—°ê²° ìƒì‹œ ìœ ì§€ë¡œ ì•ˆì •ì ì¸ ì‹¤ì‹œê°„ ë°ì´í„° ì œê³µ
- **ê°œë°œì ì¹œí™”ì **: ê¸°ì¡´ v5 ì‚¬ìš© íŒ¨í„´ê³¼ ìœ ì‚¬í•œ ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤

## ğŸ“‚ **íŒŒì¼ êµ¬ì¡° ë° ì±…ì„**

```
websocket_v6/
â”œâ”€â”€ README.md                                    # ğŸ“š í”„ë¡œì íŠ¸ ë¬¸ì„œ (ì´ íŒŒì¼)
â”œâ”€â”€ DESIGN_PRINCIPLES.md                         # ğŸ¯ ì„¤ê³„ ì›ì¹™ ë° ì•„í‚¤í…ì²˜
â”œâ”€â”€ API_REFERENCE.md                             # ğŸ“– API ì‚¬ìš©ë²• ê°€ì´ë“œ
â”œâ”€â”€ MIGRATION_GUIDE.md                           # ğŸ”„ v5 â†’ v6 ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
â”‚
â”œâ”€â”€ __init__.py                                  # ğŸ“¦ íŒ¨í‚¤ì§€ ì´ˆê¸°í™” (50ì¤„)
â”œâ”€â”€ global_websocket_manager.py                  # â­ ì „ì—­ WebSocket ê´€ë¦¬ì (400ì¤„)
â”œâ”€â”€ websocket_client_proxy.py                   # ğŸ”— ì„œë¸Œì‹œìŠ¤í…œìš© í”„ë¡ì‹œ (250ì¤„)
â”œâ”€â”€ upbit_websocket_public_client.py             # ğŸŒ Public ì „ìš© í´ë¼ì´ì–¸íŠ¸ (300ì¤„)
â”œâ”€â”€ upbit_websocket_private_client.py            # ğŸ”’ Private ì „ìš© í´ë¼ì´ì–¸íŠ¸ (350ì¤„)
â”œâ”€â”€ data_routing_engine.py                      # ğŸ“Š ë°ì´í„° ë¼ìš°íŒ… ì‹œìŠ¤í…œ (200ì¤„)
â”œâ”€â”€ subscription_state_manager.py               # ğŸ“‹ êµ¬ë… ìƒíƒœ ê´€ë¦¬ (300ì¤„)
â”œâ”€â”€ connection_manager.py                       # ğŸ”Œ ì—°ê²° ê´€ë¦¬ (180ì¤„)
â”œâ”€â”€ config.py                                   # âš™ï¸ v6 ì„¤ì • (100ì¤„)
â”œâ”€â”€ models.py                                   # ğŸ“„ v6 ë°ì´í„° ëª¨ë¸ (150ì¤„)
â”œâ”€â”€ exceptions.py                               # âš ï¸ v6 ì˜ˆì™¸ ì²˜ë¦¬ (80ì¤„)
â””â”€â”€ websocket_v6_config.yaml                    # ğŸ”§ ì„¤ì • íŒŒì¼

**ê³µí†µ ì¸í”„ë¼ ì»´í¬ë„ŒíŠ¸ (ê¸°ì¡´ ì¬ì‚¬ìš©):**
- `../upbit_auth.py` - JWT ì¸ì¦ ì‹œìŠ¤í…œ (ì „ì—­ ê´€ë¦¬ìì—ì„œë§Œ ì‚¬ìš©)
- `../upbit_rate_limiter.py` - GCRA ê¸°ë°˜ Rate Limiter
- `../dynamic_rate_limiter_wrapper.py` - ë™ì  Rate Limiter
```

**ì´ ì˜ˆìƒ ì½”ë“œ: ~2,360ì¤„** (v5 ëŒ€ë¹„ 30% ì½”ë“œ ê°ì†Œ, 100% ê¸°ëŠ¥ í–¥ìƒ)

## ğŸ—ï¸ **í•µì‹¬ ì•„í‚¤í…ì²˜**

### 1. **ì „ì—­ ê´€ë¦¬ì (Singleton)**
```python
GlobalWebSocketManager (400ì¤„)
â”œâ”€â”€ Public WebSocket Client   # API í‚¤ ë¶ˆí•„ìš”, í•­ìƒ í™œì„±í™”
â”œâ”€â”€ Private WebSocket Client  # API í‚¤ í•„ìš”, ì„ íƒì  í™œì„±í™”
â”œâ”€â”€ Subscription State        # ì „ì—­ êµ¬ë… ìƒíƒœ ì¶”ì 
â”œâ”€â”€ Data Routing Engine       # ìˆ˜ì‹  ë°ì´í„° ë©€í‹°ìºìŠ¤íŠ¸ ë¶„ë°°
â””â”€â”€ Connection Monitor        # ì—°ê²° ìƒíƒœ ê°ì‹œ ë° ìë™ ë³µêµ¬
```

### 2. **ì„œë¸Œì‹œìŠ¤í…œ ì¸í„°í˜ì´ìŠ¤**
```python
WebSocketClientProxy (250ì¤„)
â”œâ”€â”€ Public API Methods        # subscribe_ticker(), get_snapshot() ë“±
â”œâ”€â”€ Private API Methods       # subscribe_my_orders(), subscribe_my_assets() ë“±
â”œâ”€â”€ Lifecycle Management      # ìë™ êµ¬ë… í•´ì œ, ë©”ëª¨ë¦¬ ê´€ë¦¬
â””â”€â”€ Error Handling           # ì„¸ë°€í•œ ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë³µêµ¬
```

### 3. **API í‚¤ ê¸°ë°˜ ì ì‘í˜• ì´ˆê¸°í™”**
```python
# API í‚¤ ì—†ìŒ: Public ê¸°ëŠ¥ë§Œ í™œì„±í™”
await global_manager.initialize()
â†’ ì°¨íŠ¸, ì‹œì¥ ë°ì´í„°, ì½”ì¸ ëª©ë¡ ë“± ì™„ì „ ë™ì‘

# API í‚¤ ìˆìŒ: Public + Private ê¸°ëŠ¥ ëª¨ë‘ í™œì„±í™”
await global_manager.initialize(access_key, secret_key)
â†’ ì£¼ë¬¸ ëª¨ë‹ˆí„°ë§, ìì‚° ê´€ë¦¬ê¹Œì§€ ì‹¤ì‹œê°„ ì²˜ë¦¬
```

## ğŸ”§ **ì‚¬ìš©ë²• ì˜ˆì‹œ**

### **ê°„ë‹¨í•œ ì°¨íŠ¸ ì»´í¬ë„ŒíŠ¸ (Public ì „ìš©)**
```python
class ChartComponent:
    def __init__(self):
        # API í‚¤ ì—†ì–´ë„ ì™„ì „ ë™ì‘
        self.ws = WebSocketClientProxy("chart", "ui_component")

    async def start_chart(self, symbol: str):
        # ì‹¤ì‹œê°„ í˜„ì¬ê°€ êµ¬ë…
        await self.ws.subscribe_ticker([symbol], self.on_price_update)

        # ì´ˆê¸° ìŠ¤ëƒ…ìƒ· ì¡°íšŒ
        snapshot = await self.ws.get_ticker_snapshot([symbol])
        self.init_chart(snapshot)
```

### **ì£¼ë¬¸ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (Private ê¸°ëŠ¥)**
```python
class OrderMonitor:
    def __init__(self):
        self.ws = WebSocketClientProxy("orders", "trading_system")

    async def start_monitoring(self):
        if self.ws.is_private_available():
            # API í‚¤ ìˆìœ¼ë©´ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
            await self.ws.subscribe_my_orders(self.on_order_update)
        else:
            # API í‚¤ ì—†ìœ¼ë©´ REST API í´ë§ìœ¼ë¡œ ëŒ€ì²´
            await self.start_polling_fallback()
```

## ğŸ¯ **ì£¼ìš” íŠ¹ì§•**

### âœ… **ì—…ë¹„íŠ¸ WebSocket ì™„ë²½ ëŒ€ì‘**
- **ë®ì–´ì“°ê¸° ë°©ì‹**: ìƒˆ êµ¬ë… ì‹œ ê¸°ì¡´ ì‹¤ì‹œê°„ êµ¬ë… ìë™ í¬í•¨
- **ìŠ¤ëƒ…ìƒ· ìµœì í™”**: ê¸°ì¡´ ì‹¤ì‹œê°„ + ìš”ì²­ ì‹¬ë³¼ í†µí•© ìš”ì²­ìœ¼ë¡œ íš¨ìœ¨ì„± ê·¹ëŒ€í™”
- **êµ¬ë… ì¶©ëŒ ë°©ì§€**: ë‹¤ì¤‘ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì‹œì—ë„ ì•ˆì •ì ì¸ ë°ì´í„° ìˆ˜ì‹ 

### âœ… **ê°œë°œì ê²½í—˜ ìµœì í™”**
- **ì§ê´€ì  API**: `subscribe_ticker()`, `get_snapshot()` ë“± ëª…í™•í•œ ë©”ì„œë“œëª…
- **ìë™ ì •ë¦¬**: ì»´í¬ë„ŒíŠ¸ ì¢…ë£Œ ì‹œ ê´€ë ¨ êµ¬ë… ìë™ í•´ì œ
- **ì—ëŸ¬ ë³µêµ¬**: ì—°ê²° ëŠê¹€, Rate Limit ë“± ìë™ ì²˜ë¦¬

### âœ… **Enterpriseê¸‰ ì•ˆì •ì„±**
- **ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤**: ë² ì´ìŠ¤ ì—°ê²° ìƒì‹œ ìœ ì§€
- **ì¥ì•  ë³µêµ¬**: ìë™ ì¬ì—°ê²° ë° êµ¬ë… ìƒíƒœ ë³µì›
- **ë©”ëª¨ë¦¬ ìµœì í™”**: WeakRef ê¸°ë°˜ ìë™ ë©”ëª¨ë¦¬ ê´€ë¦¬

### âœ… **í™•ì¥ì„±**
- **ëª¨ë“ˆí˜• ì„¤ê³„**: ìƒˆë¡œìš´ ë°ì´í„° íƒ€ì… ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- **í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜**: ì»¤ìŠ¤í…€ ë°ì´í„° ì²˜ë¦¬ê¸° ë“±ë¡ ê°€ëŠ¥
- **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ìƒì„¸í•œ ë©”íŠ¸ë¦­ ë° í—¬ìŠ¤ì²´í¬ ì œê³µ

## ğŸ“Š **ì„±ëŠ¥ ì§€í‘œ**

| í•­ëª© | v5 (ê¸°ì¡´) | v6 (ì‹ ê·œ) | ê°œì„ ìœ¨ |
|------|-----------|-----------|---------|
| ë™ì‹œ êµ¬ë… ì²˜ë¦¬ | ì œí•œì  | ë¬´ì œí•œ | âˆ |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | í´ë¼ì´ì–¸íŠ¸ë‹¹ ì¦ê°€ | ì¼ì •í•¨ | -70% |
| ì—°ê²° ì•ˆì •ì„± | ê°œë³„ ê´€ë¦¬ | í†µí•© ê´€ë¦¬ | +90% |
| ê°œë°œ ë³µì¡ë„ | ë†’ìŒ | ë‚®ìŒ | -50% |
| API í˜¸ì¶œ íš¨ìœ¨ì„± | ì¤‘ë³µ ìš”ì²­ | í†µí•© ìš”ì²­ | +80% |

## ğŸ› ï¸ **ê¸°ìˆ  ìŠ¤íƒ**

- **WebSocket**: `websockets` ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ë°˜
- **ë¹„ë™ê¸° ì²˜ë¦¬**: `asyncio` ì™„ì „ ì§€ì›
- **ì¸ì¦**: `upbit_auth.py` ì „ì—­ JWT í† í° ê´€ë¦¬ (Private)
- **Rate Limiting**: `upbit_rate_limiter.py` + `dynamic_rate_limiter_wrapper.py` í†µí•©
- **ë¡œê¹…**: Infrastructure í†µí•© ë¡œê¹… ì‹œìŠ¤í…œ
- **ì„¤ì • ê´€ë¦¬**: YAML ê¸°ë°˜ ìœ ì—°í•œ ì„¤ì •

## ğŸ”„ **v5ì—ì„œ v6ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜**

### Before (v5)
```python
# ê° ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ê°œë³„ WebSocket í´ë¼ì´ì–¸íŠ¸
public_client = UpbitWebSocketPublicV5()
await public_client.connect()
await public_client.subscribe_ticker(["KRW-BTC"], callback)
```

### After (v6)
```python
# ì „ì—­ ê´€ë¦¬ìë¥¼ í†µí•œ í†µí•© ì‚¬ìš©
ws = WebSocketClientProxy("my_component")
await ws.subscribe_ticker(["KRW-BTC"], callback)  # ìë™ìœ¼ë¡œ ìµœì í™”ë¨
```

** ê¸°ì¡´ ì›¹ì†Œì¼“ v5ëŠ” ì´ì œ ì ˆëŒ€ ì§€ì›í•˜ì§€ ì•ŠìŒ. ëª¨ë‘ ì›¹ì†Œì¼“ v6ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•´ì•¼ í•¨.  **

---

**WebSocket v6.0** - "í•˜ë‚˜ì˜ ì—°ê²°, ë¬´í•œí•œ ê°€ëŠ¥ì„±" ğŸš€
