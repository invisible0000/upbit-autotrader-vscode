# ë¹ˆ ìº”ë“¤ ì°¸ì¡°ì  ë°©í–¥ì— ë”°ë¥¸ ë¡œì§ ë³€ê²½
### ë¹ˆ ìº”ë“¤ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„
#### í˜„ì¬ì‹œê°„ ê¸°ì¤€ ë¹ˆ ìº”ë“¤ì´ ì—†ëŠ” ì´ìƒì  ìƒí™©
- COUNT_ONLY, END_ONLY ì—ì„œ ë¹ˆ ìº”ë“¤ ì—†ëŠ” ìƒí™©(ì‹œì‘ì´ ì—…ë¹„íŠ¸ ìµœì‹  ì‹œê°„ì´ë¯€ë¡œ)
- TO_COUNT, TO_END ì—ì„œ toê°€ ìµœì‹  ì‹œê°„ ë˜ëŠ” ìµœì‹  ì‹œê°„ë³´ë‹¤ ë¯¸ë˜ ì¼ ë•Œ
- toëŠ” ì—†ê±°ë‚˜ to = 20 ë˜ëŠ” to > 20 ìƒí™©
- chunk_size = 5, count = 10 ìƒí™©
- dbë°ì´í„° ì—†ìŒ
```ìˆ˜ì§‘ìƒí™©
dbìƒíƒœ: []
í˜„ì¬ì‹œê°„(20)

ì²­í¬ ê³„íš: ì²« ì²­í¬
ì²­í¬1(ì²« ì²­í¬): chunk_to = 19, chunk_end = 15,
ì˜¤ë²„ë© ë¶„ì„ ì—†ìŒ(ì²« ì²­í¬)
apiìš”ì²­: to = 20, count = 5
api_candles = [19,18,17,16,15]
ë¹ˆìº”ë“¤ ì²˜ë¦¬ ì•ˆí•¨(ì²« ì²­í¬)
dbì €ì¥: [19,18,17,16,15]
dbìƒíƒœ: [19,18,17,16,15]

ë‹¤ìŒ ì²­í¬ ê³„íš: ì²­í¬2
ì²­í¬2: chunk_to = 14, chunk_end = 10,
ì˜¤ë²„ë© ë¶„ì„
overlab_status = NO_OVERLAP
api_start = 14, api_end = 10, api_count = 5, db_start = none, db_end = None
apiìš”ì²­: to = 15, count = 5 (ì§€ì¶œì  ë³´ì •)
api_candles = [14,13,12,11,10]
ë¹ˆìº”ë“¤ ì—†ìŒ
dbì €ì¥: [14,13,12,11,10]
dbìƒíƒœ: [19,18,17,16,15,14,13,12,11,10]
```

#### í˜„ì¬ì‹œê°„ ê¸°ì¤€ ë¹ˆ ìº”ë“¤ì´ ì²˜ìŒì— ì¡´ì¬í•  ë•Œ 1
- ë¹ˆ ìº”ë“¤ [19,18]
```ìˆ˜ì§‘ìƒí™©
dbìƒíƒœ: []
í˜„ì¬ì‹œê°„(20)

ì²­í¬ ê³„íš: ì²« ì²­í¬
ì²­í¬1(ì²« ì²­í¬): chunk_to = 19, chunk_end = 15,
ì˜¤ë²„ë© ë¶„ì„ ì—†ìŒ(ì²« ì²­í¬)
apiìš”ì²­: to = 20, count = 5
api_candles = [17,16,15,14,13]
ë¹ˆìº”ë“¤ ì²˜ë¦¬ ì•ˆí•¨(ì²« ì²­í¬)
dbì €ì¥: [17,16,15,14,13]
dbìƒíƒœ: [17,16,15,14,13]

ë‹¤ìŒ ì²­í¬ ê³„íš: ì²­í¬2
ì²­í¬2: chunk_to = 14, chunk_end = 10,
ì˜¤ë²„ë© ë¶„ì„: [14,13]
overlab_status = PATIAL_START
api_start = 12, api_end = 10, api_count = 3, db_start = 14, db_end = 13
apiìš”ì²­: to = 13, count = 3 (ì§€ì¶œì  ë³´ì •)
api_candles = [12,11,10]
ë¹ˆ ìº”ë“¤ ë¶„ì„: ë¹ˆìº”ë“¤ ì—†ìŒ
dbì €ì¥: [12,11,10]
dbìƒíƒœ: [17,16,15,14,13,12,11,10]
```

#### í˜„ì¬ì‹œê°„ ê¸°ì¤€ ë¹ˆ ìº”ë“¤ì´ ì²˜ìŒì— ì¡´ì¬í•  ë•Œ 2
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹1: [19,18]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹2: [16]
```ìˆ˜ì§‘ìƒí™©
dbìƒíƒœ: []
í˜„ì¬ì‹œê°„(20)

ì²­í¬ ê³„íš: ì²« ì²­í¬
ì²­í¬1(ì²« ì²­í¬): chunk_to = 19, chunk_end = 15,
ì˜¤ë²„ë© ë¶„ì„ ì—†ìŒ(ì²« ì²­í¬)
apiìš”ì²­: to = 20, count = 5
api_candles = [17,15,14,13,12]
ë¹ˆìº”ë“¤ ì²˜ë¦¬ ì•ˆí•¨(ì²« ì²­í¬)
dbì €ì¥: [17,15,14,13,12]
dbìƒíƒœ: [17,15,14,13,12]

ë‹¤ìŒ ì²­í¬ ê³„íš: ì²­í¬2
ì²­í¬2: chunk_to = 14, chunk_end = 10,
ì˜¤ë²„ë© ë¶„ì„: [14,13,12]
overlab_status = PARTIAL_START
api_start = 11, api_end = 10, api_count = 2, db_start = 14, db_end = 12
apiìš”ì²­: to = 12, count = 2 (ì§€ì¶œì  ë³´ì •)
api_candles = [11,10]
ë¹ˆ ìº”ë“¤ ë¶„ì„: ë¹ˆìº”ë“¤ ì—†ìŒ
dbì €ì¥: [14,13,12,11,10]
dbìƒíƒœ: [19,18,17,16,15,14,13,12,11,10]
```

#### í˜„ì¬ì‹œê°„ ê¸°ì¤€ ë¹ˆ ìº”ë“¤ì´ ì²˜ìŒì— ì¡´ì¬í•  ë•Œ 3
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹1: [19,18]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹2: [16]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹3: [13]
```ìˆ˜ì§‘ìƒí™©
dbìƒíƒœ: []
í˜„ì¬ì‹œê°„(20)

ì²­í¬ ê³„íš: ì²« ì²­í¬
ì²­í¬1(ì²« ì²­í¬): chunk_to = 19, chunk_end = 15,
ì˜¤ë²„ë© ë¶„ì„ ì—†ìŒ(ì²« ì²­í¬)
apiìš”ì²­: to = 20, count = 5
api_candles = [17,15,14,12,11]
ë¹ˆìº”ë“¤ ì²˜ë¦¬ ì•ˆí•¨(ì²« ì²­í¬)
dbì €ì¥: [17,15,14,12,11]
dbìƒíƒœ: [17,15,14,12,11]

ë‹¤ìŒ ì²­í¬ ê³„íš: ì²­í¬2
ì²­í¬2: chunk_to = 14, chunk_end = 10,
ì˜¤ë²„ë© ë¶„ì„: [14,12,11]
overlab_status = PARTIAL_MIDDLE_FRAGMENT
api_start = 14, api_end = 10, api_count =5, db_start = None, db_end = None
apiìš”ì²­: to = 15, count = 5 (ì§€ì¶œì  ë³´ì •)
api_candles = [14,12,11,10,9]
ë¹ˆ ìº”ë“¤ ë¶„ì„: gap1_start = 13, gap1_end = 13, gap1_referece = 12
ë¹ˆ ìº”ë“¤ ìƒì„±: (13)
dbì €ì¥: [14,(13),12,11,10,9]
dbìƒíƒœ: [17,16,15,14,(13),12,11,10,9]
```

#### í˜„ì¬ì‹œê°„ ê¸°ì¤€ ë¹ˆ ìº”ë“¤ì´ ì²˜ìŒì— ì¡´ì¬í•  ë•Œ 4
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹1: [19,18]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹2: [16]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹3: [13,12]
```ìˆ˜ì§‘ìƒí™©
dbìƒíƒœ: []
í˜„ì¬ì‹œê°„(20)

ì²­í¬ ê³„íš: ì²« ì²­í¬
ì²­í¬1(ì²« ì²­í¬): chunk_to = 19, chunk_end = 15,
ì˜¤ë²„ë© ë¶„ì„ ì—†ìŒ(ì²« ì²­í¬)
apiìš”ì²­: to = 20, count = 5
api_candles = [17,15,14,11,10]
ë¹ˆìº”ë“¤ ì²˜ë¦¬ ì•ˆí•¨(ì²« ì²­í¬)
dbì €ì¥: [17,15,14,11,10]
dbìƒíƒœ: [17,15,14,11,10]

ë‹¤ìŒ ì²­í¬ ê³„íš: ì²­í¬2
ì²­í¬2: chunk_to = 14, chunk_end = 10,
ì˜¤ë²„ë© ë¶„ì„: [14,11,10]
overlab_status = PARTIAL_MIDDLE_FRAGMENT
api_start = 14, api_end = 10, api_count =5, db_start = None, db_end = None
apiìš”ì²­: to = 15, count = 5 (ì§€ì¶œì  ë³´ì •)
api_candles = [14,11,10,9,8]
ë¹ˆ ìº”ë“¤ ë¶„ì„: gap1_start = 13, gap1_end = 12, gap1_referece = 11
ë¹ˆ ìº”ë“¤ ìƒì„±: (13,12)
dbì €ì¥: [14,(13),(12),11,10,9]
dbìƒíƒœ: [17,15,14,(13),(12),11,10,9]
```

#### í˜„ì¬ì‹œê°„ ê¸°ì¤€ ë¹ˆ ìº”ë“¤ì´ ì²˜ìŒì— ì¡´ì¬í•  ë•Œ 5
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹1: [19,18]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹2: [16]
- ë¹ˆ ìº”ë“¤ ê·¸ë£¹3: [13]
- - ë¹ˆ ìº”ë“¤ ê·¸ë£¹3: [11]
```ìˆ˜ì§‘ìƒí™©
dbìƒíƒœ: []
í˜„ì¬ì‹œê°„(20)

ì²­í¬ ê³„íš: ì²« ì²­í¬
ì²­í¬1(ì²« ì²­í¬): chunk_to = 19, chunk_end = 15,
ì˜¤ë²„ë© ë¶„ì„ ì—†ìŒ(ì²« ì²­í¬)
apiìš”ì²­: to = 20, count = 5
api_candles = [17,15,14,12,10]
ë¹ˆìº”ë“¤ ì²˜ë¦¬ ì•ˆí•¨(ì²« ì²­í¬)
dbì €ì¥: [17,15,14,12,10]
dbìƒíƒœ: [17,15,14,12,10]

ë‹¤ìŒ ì²­í¬ ê³„íš: ì²­í¬2
ì²­í¬2: chunk_to = 14, chunk_end = 10,
ì˜¤ë²„ë© ë¶„ì„: [14,12,10]
overlab_status = PARTIAL_MIDDLE_FRAGMENT
api_start = 14, api_end = 10, api_count =5, db_start = None, db_end = None
apiìš”ì²­: to = 15, count = 5 (ì§€ì¶œì  ë³´ì •)
api_candles = [14,12,10,9,8]
ë¹ˆ ìº”ë“¤ ë¶„ì„:
gap1_start = 13, gap1_end = 13, gap1_referece = 12
gap2_start = 11, gap1_end = 11, gap1_referece = 10
ë¹ˆ ìº”ë“¤ ìƒì„±: (13,11)
dbì €ì¥: [14,(13),12,(11),11,10,9,8]
dbìƒíƒœ: [17,15,14,(13),12,(11),10,9,8]
```

#### ì—£ì§€ ì¼€ì´ìŠ¤:  ë¹ˆ ìº”ë“¤ì´ ì²­í¬ ì²˜ìŒì— ì´ì–´ì§ˆ ë•Œ
 - ì˜ëª»ëœ ì²˜ë¦¬
```ì—£ì§€_ì¼€ì´ìŠ¤
# ìˆ«ìëŠ” ë°ì´í„°íƒ€ì„ í˜•ì‹ì´ë¼ê³  ê°€ì •
# db = []
# ì²­í¬1: 19 ~ 15
# to = 10, count =5
# ì´ìƒì  ìº”ë“¤: [19,18,17,16,15]
# ë¹ˆ ìº”ë“¤: [19,18], [15], [13,12], [10], [6,5,4]
# apiì‘ë‹µ: [17,16,14]
# [17,16] - [16,14] = [1,2]
# [16]~[14]
# [17,16,(15),14]

# db = [17,16,(15),14]
# ì²­í¬2: 14 ~ 10
# to = 10, count =5
# ì´ìƒì  ìº”ë“¤: [14,13,12,11,10]
# ì˜¤ë²„ë© ë¶„ì„: api_start = 13, api_end = 10, api_count = 4
# ë¹ˆ ìº”ë“¤: [13,12]
# apiì‘ë‹µ: [11,10,9,8]
# [11,10,9] - [10,9,8] = [1,1,1]
# ë¹ˆ ìº”ë“¤ ê²€ì¶œ ì‹¤íŒ¨!
# [11,10,9,8]
# db = [17,16,(15),14,11,10,9,8]
# db ëˆ„ë½ (13,12)!
```
- ì˜¬ë°”ë¥¸ ì²˜ë¦¬ëŠ” ì²­í¬2 ë¶€í„°ëŠ” api_start ë³´ë‹¤ í° ì´ì „ ì²­í¬ ë²”ìœ„ì˜ ì´ì „ ê°’ì„ ê°€ì ¸ì™€ì•¼ ë¨.
```
# db = [17,16,(15),14]
# ì²­í¬2: 14 ~ 10
# to = 10, count =5
# ì´ìƒì  ìº”ë“¤: [14,13,12,11,10]
# ì˜¤ë²„ë© ë¶„ì„: api_start = 13, api_end = 10, api_count = 4
# fallback_reference = 14 <-- dbì—ì„œ
# ë¹ˆ ìº”ë“¤: [13,12]
# apiì‘ë‹µ: [11,10,9,8]
# extened = [14,11,10,9,8]
# [14,11,10,9] - [11,10,9,8] = [2,1,1,1]
# ë¹ˆ ìº”ë“¤ ê²€ì¶œ ì„±ê³µ!
# sorted_datetimes[0]~sorted_datetims[1] ì‚¬ì´ì— gap ì¡´ì¬, reference_state = sorted_datetimes[1]
# db = [17,16,(15),14,(13),(12),11,10,9,8]
```

### ë¹ˆ ìº”ë“¤ ì²˜ë¦¬ ê°œì„  ë°©í–¥
#### í˜„ì¬ ë¹ˆ ìº”ë“¤ ë¬¸ì œì 
1. ë¹ˆ ìº”ë“¤ ì°¸ì¡° ë°©í–¥ ë¯¸ë˜ì ì„ ì¡ìŒ(ìº”ë“¤ì€ ê³¼ê±°ë¶€í„° ì´ì–´ì§€ëŠ” ë°ì´í„°ì´ë¯€ë¡œ ê³¼ê±°ê°€ ì°¸ì¡°ì ì´ì–´ì•¼í•¨)
2. í•„ìš” ì—†ëŠ” ë¹ˆ ìº”ë“¤ ê²½ê³„ì²˜ë¦¬(ê³¼ê±°ê°€ ì°¸ì¡°ì ì´ ë˜ë©´ì„œ ê³¼ê±°ë°©í–¥ìœ¼ë¡œ ìº”ë“¤ ì‘ë‹µì´ ê¸¸ì–´ì ¸ë„ í° ë¬¸ì œê°€ ì—†ë‹¤ëŠ” ì˜ê²¬)
3. ê³¼ê±°ê°€ ì°¸ì¡°ì ì´ ë˜ë©´ì„œ fallback_referencì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ì´ ë°©í•´ê°€ ë¨

#### ê°œì„  ë°©ì•ˆ
1. fallback_referencì‚¬ìš© ì•ˆí•¨. ì‘ì—…ì¤‘ ìˆ˜ì •ì¤‘ì¸ ì½”ë“œì—ì„œ ì˜ì¡´ì„±ë§Œ ì •ë¦¬í•˜ê³  ë§ˆì§€ë§‰ì— ë¬¸ì œê°€ ì—†ìœ¼ë©´ ì œê±°.(í˜„ì¬ ë…¼ë¦¬ê°€ ë§ìœ¼ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ì˜ì¡´ì„±ì´ ì œê±°ë¨)
2. í° ë²”ìœ„ ê³¼ê±° ë¹ˆ ìº”ë“¤ ê°€ëŠ¥ì„± ë‚®ê³  ë¯¸ì²˜ë¦¬ ì‹œ PARTIAL_MIDDLE_FRAGMENTë¥¼ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒ ì‹œí‚¤ë¯€ë¡œ ë¹ˆ ìº”ë“¤ í•„í„°ë§ ì œê±°(ë¬¸ì œê°€ ë˜ë©´ ê¸°ëŠ¥ ì¶”ê°€)
3. ì‚¬ì „ í•„í„°ë§ ì œê±°ë¡œ find_reference_previous_chunks ê¸°ëŠ¥ì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ì–´ì§. ì´ìœ ëŠ” ì‚¬ì „ í•„í„° ì²˜ë¦¬ê°€ ì‚¬ë¼ì§€ë©´ ì´ì „ ì²­í¬ëŠ” ë¬´ì¡°ê±´ ìì‹ ì˜ chunk_info.end ì™€ ê°™ê±°ë‚˜ ì‘ì€(ê³¼ê±°, ë‹¤ìŒ ì²­í¬ë²”ìœ„ì— í¬í•¨) ê²°ê³¼ë¥¼ ì–»ê²Œë¨(ì—£ì§€ ì¼€ì´ìŠ¤ë§Œ ë¬¸ì œê°€ ë˜ëŠ” ìƒí™©, ì´ì œ ë…¼ë¦¬ì ìœ¼ë¡œ ì²­í¬2ëŠ” í•­ìƒ api_start+1í‹±ì´ ì¡´ì¬í•˜ê²Œë¨)
4. ì²« ì²­í¬ ë¹ˆ ìº”ë“¤ ì²˜ë¦¬ í—ˆìš©, ë‹¨, ì²« ì²­í¬ëŠ” ë¹ˆ ìº”ë“¤ ê²€ì¶œ ì‹œ api_start +1í‹± íƒ€ì„ ì¶”ê°€ì•ˆí•¨, api_start +1í‹±ì€ ì²­í¬ 2ë¶€í„°
5. ì²­í¬2ì— api_start +1í‹± ì„ candles_datetimes ì²˜ìŒì— í•­ìƒ ë¶™ì—¬ë„ ì´ì œ ë¬¸ì œê°€ ì•ˆ ìƒê¹€.ì²˜ìŒë¶€í„° ë¹ˆ ìº”ë“¤ì´ ì•„ë‹ˆë¼ë©´ ê°­ì´ ì—†ìŒìœ¼ë¡œ ê²€ì¶œë˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì²˜ë¦¬.
6. ë¹ˆ ìº”ë“¤ gap ì²˜ë¦¬ì‹œ ì°¸ì¡°ì ì„ ì²˜ë¦¬í•˜ëŠ” ìì‹ ìœ¼ë¡œ ì„¤ì •([i-1]~[i]ì¼ë•Œ [i]ê°€ ì°¸ì¡°ì )
7. ì´ì œ gap_infoì˜ gap_startì™€ gap_endëŠ” ì‹¤ì œ ê°­ì´ ì‹œì‘í•˜ì§€ ì§ì „ê³¼ ì§í›„ ë ˆì½”ë“œê°€ ë¨. ê·¸ëŸ¬ë¯€ë¡œ ë¹ˆ ìº”ë“¤ ìƒì„± ì‹œ ë²”ìœ„ ì„¤ì • ì£¼ì˜í•„ìš”.(gap_infoë¡œ ë¹ˆ ìº”ë“¤ ìƒì„± ë£¨í”„ì—ì„œ ì‹œì‘ ì‹œ TimeUtils.get_time_by_ticks(gap_start, self.timeframe,-1)ë¡œ ì‹œì‘í•˜ê³  ë°˜ë³µí•˜ë‹¤ê°€ gap_end ë„ë‹¬ ì‹œ ì¶”ê°€ ìƒì„±í•˜ë©´ ì•ˆë¨)
8. fallback_referencë¥¼ í†µí•œ none_UUID ë°œìƒ ìƒí™©ì´ ë‹¤ë£¨ê¸° ë³µì¡í•´ì§.(gap_group_uuid ëŠ” ë‚¨ê¸°ê¸°ë¡œ í•¨, ì‚¬ìš©í•˜ëŠ” ì½”ë“œë§Œ ì œê±°)

#### ì¶”ê°€ ë…¼ì˜
1. ì˜¬ë°”ë¥¸ ì°¸ì¡°ì  ë°©í–¥ìœ¼ë¡œ ìˆ˜ì • í›„ fallback_referencë¥¼ í†µí•œ none_UUID í•„ìš” ìƒí™©ì´ ë°œìƒ ê°€ëŠ¥í•œì§€ ì‹œë‚˜ë¦¬ì˜¤ ê²€í† í•„ìš”.
2. gap_infoì˜ reference_state ìœ ì§€ í•„ìš”ì„±(ì´ì œ gap_end ê°€ ì°¸ì¡°ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•´ì§.)
3. api_candles í•„í„° ì²˜ë¦¬ ì œê±°ì— ê´€í•´ ì²­í¬ ë…ë¦½ì„±(ì²­í¬ê°€ ë‹´ë‹¹í•˜ëŠ” ë²”ìœ„ë¥¼ í¬ê²Œ ë²—ì–´ë‚œ ë°ì´í„° ë°œìƒì„ ì–µì§€) ìœ ì§€ ì¸¡ë©´ì—ì„œ api_end ë³´ë‹¤ ì‘ì€ 1ê°œ ë ˆì½”ë“œì˜ utcê¹Œì§€ëŠ” ì‚¬ìš©í•˜ëŠ” ë°©ì•ˆ ê²€í† 
4. sorted_datetimes ì˜ ì •ë ¬ì´ í•„ìš”í•œì§€ ê²€í† ê°€ í•„ìš”. ì—…ë¹„íŠ¸ ë°ì´í„°ëŠ” í•­ìƒ ë‚´ë¦¼ ì°¨ìˆœì„

### ì‘ì—…ë‚´ìš© ë° ìˆœì„œ
- api_candles í•„í„° ì²˜ë¦¬ ì œê±°
- ì‘ì—…ì¤‘ ë°œê²¬ë˜ëŠ” fallback_referenc ì˜ì¡´ì„  ì œê±°
- `empty_candle_reference_updater.py` ì˜ì¡´ì„± ì œê±°(ë°œìƒ ê°€ëŠ¥ì„±ë¶€í„° ì‚¬ì „ ê²€í† ê°€ í•„ìš”í•˜ë‹ˆ ì½”ë“œ íŒŒì¼ì€ ë‚¨ê¹€)
- mockë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ ìƒí™©ì—ì„œ ê°œì„ ëœ ë¡œì§ì´ ë¹ˆ ìº”ë“¤ì„ ì˜¬ë°”ë¥´ê²Œ ìƒì„±í•˜ëŠ”ì§€ ê²€í† 

---

## ğŸ“‹ **ê²€í†  ì˜ê²¬ ë° ë¶„ì„**

### âœ… **ê°œì„  ë°©í–¥ ì¢…í•© í‰ê°€**

**ğŸ¯ í•µì‹¬ ê°œì„ ì **:
1. **ê³¼ê±° ì°¸ì¡°ì  ë°©ì‹** - ìº”ë“¤ ë°ì´í„°ì˜ ì‹œê°„ íë¦„ì— ë§ëŠ” **ìì—°ìŠ¤ëŸ¬ìš´ ì ‘ê·¼**
2. **ì²­í¬ ê²½ê³„ Gap í•´ê²°** - api_start +1í‹± ì¶”ê°€ë¡œ **ì—£ì§€ ì¼€ì´ìŠ¤ ê·¼ë³¸ í•´ê²°**
3. **ì½”ë“œ ë‹¨ìˆœí™”** - fallback_reference ì˜ì¡´ì„± ì œê±°ë¡œ **ë³µì¡ì„± ëŒ€í­ ê°ì†Œ**

**âš ï¸ ì£¼ìš” ìœ„í—˜ ìš”ì†Œ**:
1. **GapInfo êµ¬ì¡° ë³€ê²½** - gap_start/gap_end ì˜ë¯¸ ë³€ê²½ìœ¼ë¡œ **ê¸°ì¡´ ì½”ë“œ ì˜í–¥ë„ í¼**
2. **ë¹ˆ ìº”ë“¤ ìƒì„± ë¡œì§ ì „ë©´ ìˆ˜ì •** - ê²½ê³„ ì²˜ë¦¬ ë°©ì‹ ì™„ì „ ë³€ê²½ í•„ìš”
3. **ì²« ì²­í¬ ë¹ˆ ìº”ë“¤ ì²˜ë¦¬** - ì„±ëŠ¥ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì˜í–¥ ê²€í†  í•„ìš”

### ğŸ¯ **ì¶”ê°€ ë…¼ì˜ì‚¬í•­ ê²€í† **

#### **1. fallback_referenceì˜ none_UUID í•„ìš”ì„±**
**ê²€í†  ê²°ê³¼**: **ëŒ€í­ ê°ì†Œí•˜ì§€ë§Œ ì™„ì „ ì œê±°ëŠ” ì‹ ì¤‘**
- ì²­í¬2ë¶€í„° api_start +1í‹± ì¶”ê°€ë¡œ none ìƒí™© **90% ì´ìƒ ê°ì†Œ**
- ì²« ì²­í¬ì—ì„œëŠ” ì—¬ì „íˆ ë°œìƒ ê°€ëŠ¥í•˜ë¯€ë¡œ **ë‹¨ê³„ì  ì œê±°** ê¶Œì¥

#### **2. gap_infoì˜ reference_state ìœ ì§€ í•„ìš”ì„±**
**ê²€í†  ê²°ê³¼**: **ìœ ì§€ ê¶Œì¥**
- gap_endê°€ ì°¸ì¡°ì ì´ì§€ë§Œ **ëª…ì‹œì  ì°¸ì¡° ì •ë³´**ëŠ” ë””ë²„ê¹…ì— ìœ ìš©
- ì½”ë“œ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± ì¸¡ë©´ì—ì„œ **ì¥ì ì´ ë” í¼**

#### **3. api_candles í•„í„° ì²˜ë¦¬ ì œê±°**
**ê²€í†  ê²°ê³¼**: **ë¶€ë¶„ ìœ ì§€ ê¶Œì¥**
- ì™„ì „ ì œê±° ëŒ€ì‹  ìµœì†Œí•œì˜ í•„í„°ë§ ìœ ì§€ (ì ˆì¶©ì•ˆ)
- api_end ë³´ë‹¤ ì‘ì€ 1ê°œ ë ˆì½”ë“œê¹Œì§€ëŠ” í—ˆìš© (ì²­í¬ ë…ë¦½ì„± ìœ ì§€)

#### **4. sorted_datetimes ì •ë ¬ í•„ìš”ì„±**
**ê²€í†  ê²°ê³¼**: **ìœ ì§€ ê¶Œì¥**
- ì—…ë¹„íŠ¸ APIëŠ” ë‚´ë¦¼ì°¨ìˆœì´ì§€ë§Œ **ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°** ì°¨ì›
- ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ ë¯¸ë¯¸í•˜ë¯€ë¡œ **ì•ˆì „ì„± ìš°ì„ **

---

## ğŸ“… **ë‹¨ê³„ë³„ ì‘ì—… ê³„íš**

### **âš–ï¸ Phase 1: Mock ë°ì´í„° í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•**
**ëª©í‘œ**: ì•ˆì „í•œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ìƒˆë¡œìš´ ë¡œì§ ê²€ì¦
**ê¸°ê°„**: 2-3ì¼
**ìœ„í—˜ë„**: **Low** (í…ŒìŠ¤íŠ¸ í™˜ê²½)

**ì‘ì—… ë‚´ìš©**:
1. ğŸ“‹ ë¬¸ì„œì˜ 5ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ Mock ë°ì´í„° ìƒì„±
2. ğŸ§ª í˜„ì¬ ë¡œì§ vs ìƒˆë¡œìš´ ë¡œì§ ë¹„êµ í…ŒìŠ¤íŠ¸
3. ğŸ“Š ë¹ˆ ìº”ë“¤ ìƒì„± ì •í™•ì„± ê²€ì¦
4. ğŸ” ì„±ëŠ¥ ì˜í–¥ë„ ì¸¡ì •

### **ğŸ”¥ Phase 2: ì°¸ì¡°ì  ë°©í–¥ ë³€ê²½ + GapInfo ìˆ˜ì •**
**ëª©í‘œ**: ê³¼ê±° ì°¸ì¡°ì  ë°©ì‹ìœ¼ë¡œ ì „í™˜ + gap_start/gap_end ì˜ë¯¸ ë³€ê²½
**ê¸°ê°„**: 3-5ì¼
**ìœ„í—˜ë„**: **High** (ê¸°ì¡´ ì½”ë“œ ëŒ€í­ ìˆ˜ì •)

**ì‘ì—… ë‚´ìš©**:
1. âš ï¸ GapInfo êµ¬ì¡° ë³€ê²½ ë° ì˜í–¥ë„ ë¶„ì„
2. ğŸ”§ `_generate_gap_time_points` ë¡œì§ ìˆ˜ì •
3. ğŸ”„ ë¹ˆ ìº”ë“¤ ìƒì„± ê²½ê³„ ì²˜ë¦¬ ìˆ˜ì •
4. ğŸ§ª ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦

### **ğŸ§¹ Phase 3: ì˜ì¡´ì„± ì •ë¦¬ ë° ìµœì í™”**
**ëª©í‘œ**: fallback_reference ì˜ì¡´ì„± ì œê±° + ì½”ë“œ ì •ë¦¬
**ê¸°ê°„**: 2-3ì¼
**ìœ„í—˜ë„**: **Medium** (í˜¸í™˜ì„± ê²€í† )

**ì‘ì—… ë‚´ìš©**:
1. ğŸ—‘ï¸ fallback_reference ì‚¬ìš©ì²˜ ì ì§„ì  ì œê±°
2. ğŸ“ `empty_candle_reference_updater.py` ê²€í†  í›„ ì •ë¦¬
3. âš¡ ì‚¬ì „ í•„í„°ë§ ìµœì í™” (ì™„ì „ ì œê±° ëŒ€ì‹  ìµœì†Œí™”)
4. ğŸ” ì „ì²´ ì‹œìŠ¤í…œ ì„±ëŠ¥ ë° ì•ˆì •ì„± ê²€ì¦

### **âœ… Phase 4: í†µí•© í…ŒìŠ¤íŠ¸ ë° ë°°í¬**
**ëª©í‘œ**: ì‹¤ì œ ìš´ì˜ í™˜ê²½ ì ìš© ì¤€ë¹„
**ê¸°ê°„**: 2-3ì¼
**ìœ„í—˜ë„**: **Medium** (ìš´ì˜ í™˜ê²½)

**ì‘ì—… ë‚´ìš©**:
1. ğŸ¯ ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸
2. ğŸ“ˆ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ë° ì•ˆì •ì„± ê²€ì¦
3. ğŸ“‹ ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë° ê°€ì´ë“œ ì‘ì„±
4. ğŸš€ ì ì§„ì  ë°°í¬ ë° ëª¨ë‹ˆí„°ë§

---

## ğŸ¯ **ìµœì¢… ê¶Œì¥ì‚¬í•­**

### **âœ… ì¦‰ì‹œ ì ìš© ê¶Œì¥**:
1. **Mock ë°ì´í„° í…ŒìŠ¤íŠ¸** - ì•ˆì „í•œ ê²€ì¦ í™˜ê²½ êµ¬ì¶•
2. **ì²­í¬ ê²½ê³„ Gap ë¬¸ì œ í•´ê²°** - api_start +1í‹± ì¶”ê°€ ë¡œì§ ì ìš©

### **âš–ï¸ ë‹¨ê³„ì  ì ìš© ê¶Œì¥**:
1. **ì°¸ì¡°ì  ë°©í–¥ ë³€ê²½** - ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ í›„ ì ìš©
2. **GapInfo êµ¬ì¡° ìˆ˜ì •** - ì˜í–¥ë„ ë¶„ì„ í›„ ì‹ ì¤‘í•˜ê²Œ ì§„í–‰

### **ğŸ” ì§€ì† ê²€í†  í•„ìš”**:
1. **ì•ˆì •ì„±** - ê° Phaseë³„ ì•ˆì •ì„± ê²€ì¦
2. **í˜¸í™˜ì„±** - ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ ì—°ë™ ê²€ì¦
3. **ì •í™•ì„±** - ì‹¤ì œ ìš´ì˜ ë°ì´í„°ë¡œ ì¥ê¸°ê°„ ê²€ì¦

---

## ğŸš€ **êµ¬í˜„ ì™„ë£Œ í•­ëª©**

### **âœ… GapInfo ìµœì í™” ì™„ë£Œ** (2024.09.21)
**ì‚¬ìš©ì ì œì•ˆ**: "gap_infoì—ì„œ ëª…ì‹œì ìœ¼ë¡œ -1í‹±, +1í‹± í•´ì£¼ë©´ í”„ë¡œê·¸ë¨ ì „ë°˜ì ìœ¼ë¡œ ë‚´ë¶€ì ìœ¼ë¡œ ì“°ëŠ” íƒ€ì„ì€ ë ˆì½”ë“œì˜ utc ì‹œê°„ì„ ì§€ì¹­í•˜ëŠ” ê·œì¹™ì„ ì§€í‚¬ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤"

**êµ¬í˜„ ê²°ê³¼**:
- âœ… **GapInfo êµ¬ì¡° ê°œì„ **: `gap_start`/`gap_end`ì— ì‹¤ì œ ë¹ˆ ìº”ë“¤ ë²”ìœ„ ì €ì¥
- âœ… **ì½”ë“œ ë‹¨ìˆœí™”**: TimeUtils ì¤‘ë³µ í˜¸ì¶œ ì œê±°
- âœ… **ì˜ë¯¸ë¡ ì  ëª…í™•ì„±**: ë¡œê·¸ì—ì„œ ë°”ë¡œ ë¹ˆ ìº”ë“¤ ì‹œê°„ í™•ì¸ ê°€ëŠ¥
- âœ… **ê·œì¹™ ì¤€ìˆ˜**: í”„ë¡œê·¸ë¨ ì „ë°˜ì—ì„œ "ë ˆì½”ë“œ UTC ì‹œê°„" ê·œì¹™ ìœ ì§€

**ì ìš©ëœ ë³€ê²½ì‚¬í•­**:
1. `GapInfo` í´ë˜ìŠ¤: gap_start/gap_end ì˜ë¯¸ ë³€ê²½
2. `_detect_gaps_in_datetime_list`: ì‹¤ì œ ë¹ˆ ìº”ë“¤ ë²”ìœ„ ê³„ì‚° í›„ ì €ì¥
3. `_generate_gap_time_points`: TimeUtils í˜¸ì¶œ ì—†ì´ ë°”ë¡œ ì‚¬ìš©

**ğŸ‰ ê²°ë¡ **: ì œì•ˆí•˜ì‹  ë¡œì§ ë³€ê²½ì€ **ê·¼ë³¸ì ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ë°©í–¥**ì´ë©°, **ë‹¨ê³„ì  ì ‘ê·¼**ì„ í†µí•´ **ì•ˆì „í•˜ê³  íš¨ê³¼ì ìœ¼ë¡œ ì ìš© ê°€ëŠ¥**í•©ë‹ˆë‹¤!
