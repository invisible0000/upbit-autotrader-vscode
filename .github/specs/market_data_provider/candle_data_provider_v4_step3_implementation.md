# 🚀 CandleDataProvider v4.0 - Ryan-Style Step 3: 순차 실행

## 📋 **Step 2 승인 완료**
✅ **태스크 분해 완료**: 7개 주요 컴포넌트, 21개 세부 태스크
✅ **구현 순서 정의**: 4단계 Phase, 의존성 매핑 완료
✅ **성공 지표 설정**: API 60% 감소, 캐시 90%, P95 <200ms

---

## 🎯 **Step 3: 순차 실행 가이드**

### **실행 원칙**
- **한 번에 하나의 태스크만**: 동시 처리 절대 금지
- **Plan → Implement → Self-test → Verify → Ask**: 단계별 진행
- **승인 대기**: 각 태스크 완료 후 사용자 승인 필수
- **DDD + Golden Rules 준수**: 모든 구현에서 아키텍처 원칙 유지

### **현재 진행 상태**
- **다음 실행 태스크**: 1.1 TimeUtils v4.0 확장
- **전체 진행률**: 0/21 (0%)
- **현재 Phase**: Phase 1 - 기반 시스템

---

## 📝 **태스크 실행 템플릿**

각 태스크는 다음 4단계로 진행됩니다:

### **1. Plan (계획)**
```markdown
## 🎯 태스크 X.X: [태스크명]

### **변경사항 요약**
- 수정할 파일: [파일 경로]
- 핵심 기능: [주요 구현 내용]
- 영향 범위: [다른 컴포넌트 영향]

### **구현 접근법**
- [구체적인 구현 방법]
- [고려사항 및 제약]
- [테스트 전략]
```

### **2. Implement (구현)**
```markdown
### **코드 변경사항**

#### 생성할 파일:
- `[파일경로]` - [파일 설명]

#### 수정할 파일:
- `[파일경로]` - [수정 내용]

### **Implementation Details**
[실제 코드 구현 또는 diff 제시]
```

### **3. Self-test (자체 테스트)**
```markdown
### **테스트 실행**

#### 단위 테스트:
```bash
pytest tests/infrastructure/market_data/candle/test_[component].py -v
```

#### 통합 테스트:
```bash
python -c "[테스트 코드]"
```

### **테스트 결과**
- ✅ [성공한 테스트]
- ❌ [실패한 테스트] - [해결책]
```

### **4. Verify (검증)**
```markdown
### **Acceptance Criteria 검증**
- [ ] [기준 1] - [검증 결과]
- [ ] [기준 2] - [검증 결과]
- [ ] [기준 3] - [검증 결과]

### **성능 검증**
- 응답시간: [측정값] (목표: [목표값])
- 메모리 사용: [측정값] (목표: [목표값])

### **잔여 위험 요소**
- [위험 요소 1] - [완화 방안]
- [위험 요소 2] - [완화 방안]
```

---

## 🔄 **Step 3 진행 상황 추적**

### **Phase 1: 기반 시스템** (1-2일)

#### **1.1 TimeUtils v4.0 확장** [-]
**Status**: 다음 실행 대기
**Dependencies**: 없음
**Blocked by**: 사용자 승인 대기

#### **1.2 시간 형식 표준화 메서드** [ ]
**Status**: 1.1 완료 후 진행
**Dependencies**: 1.1 완료
**Estimated Start**: 1.1 승인 후

#### **2.1 CandleTableManager 구현** [ ]
**Status**: 1.2 완료 후 진행
**Dependencies**: 1.1, 1.2 완료
**Estimated Start**: Phase 1 기반 완료 후

#### **2.2 CandleRepository 구현** [ ]
**Status**: 2.1 완료 후 진행
**Dependencies**: 2.1 완료
**Estimated Start**: 2.1 승인 후

### **Phase 2: 최적화 엔진** (3-4일)

#### **3.1 완전 겹침 확인 (count 기반)** [ ]
**Status**: Phase 1 완료 후 진행
**Dependencies**: Phase 1 전체 완료
**Estimated Start**: Phase 1 완료 후

#### **3.2 파편화 겹침 확인 (SQLite 호환)** [ ]
**Status**: 3.1 완료 후 진행
**Dependencies**: 3.1 완료

#### **3.3 연결된 끝 찾기 (SQLite datetime)** [ ]
**Status**: 3.2 완료 후 진행
**Dependencies**: 3.2 완료

#### **3.4 4단계 통합 최적화 엔진** [ ]
**Status**: 3.1-3.3 완료 후 진행
**Dependencies**: 3.1, 3.2, 3.3 완료

### **Phase 3: API 및 캐시** (5일)

#### **4.1 업비트 특화 파라미터 최적화** [ ]
**Status**: Phase 2 완료 후 진행
**Dependencies**: Phase 2 전체 완료

#### **4.2 Rate Limit 및 재시도 전략** [ ]
**Status**: 4.1 완료 후 진행
**Dependencies**: 4.1 완료

#### **5.1 CandleCache 구현** [ ]
**Status**: Phase 2 완료 후 진행 (4.1과 병렬 가능)
**Dependencies**: Phase 2 완료

### **Phase 4: 통합 및 검증** (6-7일)

#### **6.1 CandleDataProvider 메인 Facade** [ ]
**Status**: Phase 3 완료 후 진행
**Dependencies**: Phase 3 전체 완료

#### **6.2 데이터 모델 통합** [ ]
**Status**: 6.1과 병렬 진행 가능
**Dependencies**: Phase 3 완료

#### **7.1 성능 메트릭 수집** [ ]
**Status**: 6.1, 6.2 완료 후 진행
**Dependencies**: 6.1, 6.2 완료

#### **7.2 통합 테스트 및 검증** [ ]
**Status**: 모든 태스크 완료 후 최종 검증
**Dependencies**: 7.1 완료

---

## 📊 **실시간 진행 지표**

### **전체 진행률**
```
Progress: [████████████████████████████████████████████████████████████] 0% (0/21)

Phase 1: [□□□□] 0% (0/4)  |  Phase 2: [□□□□] 0% (0/4)
Phase 3: [□□□] 0% (0/3)   |  Phase 4: [□□□□] 0% (0/4)
```

### **성능 지표 추적**
| 지표 | 현재값 | 목표값 | 상태 |
|------|--------|--------|------|
| API 호출 감소율 | - | 60% | 🔄 대기 |
| 캐시 히트율 | - | 90% | 🔄 대기 |
| 응답시간 P95 | - | <200ms | 🔄 대기 |
| 시간 일관성 | - | 100% | 🔄 대기 |

### **품질 지표**
| 품질 항목 | 상태 | 비고 |
|-----------|------|------|
| 타입 힌트 | 🔄 진행 예정 | 모든 새 코드 100% |
| DDD 준수 | 🔄 진행 예정 | Repository 패턴 적용 |
| 테스트 커버리지 | 🔄 진행 예정 | 목표 95% |
| Infrastructure 로깅 | 🔄 진행 예정 | print() 금지 |

---

## 🚀 **다음 태스크 실행 준비**

### **1.1 TimeUtils v4.0 확장 - 실행 대기**

#### **Plan Preview**
- **파일**: `upbit_auto_trading/infrastructure/market_data/candle/time_utils.py`
- **변경**: `get_timeframe_seconds()` 메서드 추가
- **목표**: overlap_optimizer와 시간 처리 통일

#### **Ready for Execution**
```markdown
🎯 다음 실행할 태스크: 1.1 TimeUtils v4.0 확장

이 태스크를 지금 실행하시겠습니까?
- 예상 소요시간: 2시간
- 영향 범위: time_utils.py 확장만, 기존 코드 영향 없음
- 테스트: 단위 테스트 + 호환성 검증

명령어: "태스크 1.1 실행해 주세요" 또는 "다음 태스크 진행"
```

---

## 🛡️ **Step 3 가드레일**

### **절대 준수 사항**
- [ ] **한 번에 하나만**: 여러 태스크 동시 처리 금지
- [ ] **승인 대기**: 각 태스크 완료 후 반드시 승인 요청
- [ ] **DDD 준수**: Domain 계층 외부 의존성 금지
- [ ] **Infrastructure 로깅**: create_component_logger 사용
- [ ] **타입 안전성**: 모든 새 코드 타입 힌트 필수

### **품질 체크포인트**
- [ ] **시간 일관성**: time_utils 기반 모든 시간 계산 통일
- [ ] **SQLite 호환**: 모든 SQL 쿼리 SQLite 환경 테스트
- [ ] **성능 목표**: 각 컴포넌트별 응답시간 SLA 준수
- [ ] **테스트 우선**: TDD 원칙 따라 테스트 먼저 작성

### **위험 관리**
- [ ] **롤백 준비**: 각 태스크별 롤백 전략 수립
- [ ] **의존성 관리**: 태스크 간 의존성 엄격 준수
- [ ] **영향 분석**: 기존 7규칙 전략에 영향 없음 확인
- [ ] **점진적 검증**: 태스크별 개별 검증 후 통합 검증

---

## 📝 **Step 3 로그**

### **실행 기록** (최신순)
```
[2024-09-06] Step 3 문서 생성 완료
[2024-09-06] Step 2 태스크 분해 승인 완료
[2024-09-06] PRD v4.0 승인 완료
```

### **결정 사항**
- **시간 통일 방향**: time_utils 중심으로 통일 (overlap_optimizer 적응)
- **테이블 전략**: 심볼별 개별 테이블 (`candles_{SYMBOL}_{TIMEFRAME}`)
- **중복 제거**: INSERT OR IGNORE 방식 채택
- **최적화 전략**: 7패턴 → 4단계 업비트 특화 단순화

### **블로커 및 해결**
- **현재 블로커**: 없음 (태스크 1.1 실행 준비 완료)
- **해결된 이슈**: 시간 처리 불일치 → time_utils 확장으로 해결 예정

---

## 🏁 **최종 성공 기준**

### **구현 완료 조건**
- [ ] 21개 모든 태스크 완료
- [ ] 모든 Acceptance Criteria 100% 만족
- [ ] `python run_desktop_ui.py` → 7규칙 전략 완전 동작

### **성능 달성 조건**
- [ ] API 호출 60% 감소 달성
- [ ] 캐시 히트율 90% 이상 달성
- [ ] 응답시간 P95 <200ms 달성
- [ ] 시간 처리 100% 일관성 달성

### **품질 보증 조건**
- [ ] 테스트 커버리지 95% 이상
- [ ] DDD 아키텍처 100% 준수
- [ ] Infrastructure 로깅 100% 적용
- [ ] 타입 힌트 100% 적용

**🚀 Step 3 Ready**: 태스크 1.1 실행 대기 중입니다!

---

## 💡 **Step 3 사용 가이드**

### **태스크 실행 명령어**
```bash
# 다음 태스크 실행
"태스크 [번호] 실행해 주세요"
예: "태스크 1.1 실행해 주세요"

# 현재 진행 상황 확인
"현재 진행 상황 알려 주세요"

# 특정 태스크 상세 정보
"태스크 [번호] 상세 정보 보여 주세요"

# 성능 지표 확인
"현재 성능 지표 확인해 주세요"
```

### **승인/수정/중단 응답**
```bash
# 승인 (다음 태스크로 진행)
"승인합니다" 또는 "다음 태스크 진행해 주세요"

# 수정 요청
"[구체적인 수정 사항] 수정해 주세요"

# 중단 (더 많은 정보 필요)
"잠시 중단, [질문 내용] 확인 필요"
```

**🎯 다음 단계**: 사용자의 "태스크 1.1 실행해 주세요" 명령 대기 중
