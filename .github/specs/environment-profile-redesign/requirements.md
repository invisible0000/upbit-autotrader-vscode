# 환경 프로파일 탭 재디자인 요구사항

## 소개

현재 환경 로깅 탭의 환경 프로파일 섹션이 단일 세로 레이아웃으로 구성되어 있어 사용성에 한계가 있습니다. 사용자가 환경 설정을 직관적으로 관리하고 YAML 형태로 직접 편집할 수 있는 개선된 UI가 필요합니다. 기존 DDD 아키텍처와 Infrastructure 로깅 시스템 v4.0을 완전히 준수하면서 좌우 분할 레이아웃의 현대적인 환경 프로파일 관리 시스템을 구현해야 합니다.

## 현재 문제점

1. **레이아웃 제약**: 세로 단일 레이아웃으로 인한 공간 활용 비효율성
2. **편집 접근성 부족**: YAML 설정을 직접 편집할 수 있는 UI 부재
3. **시각적 분리 부족**: 프로파일 선택과 내용 확인이 혼재된 UI
4. **커스텀 프로파일 관리 복잡성**: 생성/편집/저장 워크플로우의 사용성 문제
5. **실시간 미리보기 부재**: 선택한 환경의 설정 내용을 즉시 확인 불가

## 요구사항

### 요구사항 1: 좌우 분할 레이아웃 시스템

**사용자 스토리:** 개발자로서 환경 프로파일을 선택하는 영역과 설정 내용을 확인/편집하는 영역이 명확히 분리된 UI에서 효율적으로 작업하고 싶습니다.

#### 수용 기준

1. WHEN 환경 프로파일 탭이 열리면 THEN 좌우 1:2 비율의 분할 레이아웃이 표시되어야 합니다
2. WHEN 윈도우 크기가 변경되면 THEN 좌우 비율이 유지되면서 자동으로 크기가 조정되어야 합니다
3. WHEN 좌측 선택기에서 프로파일을 선택하면 THEN 우측 편집기에 해당 내용이 즉시 표시되어야 합니다
4. WHEN 분할 경계선을 드래그하면 THEN 사용자가 원하는 비율로 조정할 수 있어야 합니다
5. WHEN 최소 크기 이하로 축소되면 THEN 각 영역의 핵심 기능이 유지되어야 합니다

### 요구사항 2: 퀵 환경 선택 시스템

**사용자 스토리:** 개발자로서 개발/테스트/제품 환경을 빠르게 전환할 수 있는 명확한 버튼들을 통해 즉시 환경을 바꾸고 싶습니다.

#### 수용 기준

1. WHEN 좌측 상단에 3개의 퀵 버튼이 표시되면 THEN 개발(🔧), 테스트(🧪), 제품(🚀) 환경이 색상으로 구분되어야 합니다
2. WHEN 퀵 환경 버튼을 클릭하면 THEN 즉시 해당 환경으로 전환되고 우측에 설정이 표시되어야 합니다
3. WHEN 현재 활성 환경이면 THEN 해당 버튼이 강조 표시되어야 합니다
4. WHEN 환경 전환이 진행되면 THEN 로딩 상태가 시각적으로 표시되어야 합니다
5. WHEN 환경 전환이 완료되면 THEN Infrastructure 로깅으로 전환 완료가 기록되어야 합니다

### 요구사항 3: 프로파일 선택 및 관리 시스템

**사용자 스토리:** 개발자로서 기본 3환경과 커스텀 프로파일을 콤보박스에서 선택하고 생성/삭제 등을 관리하고 싶습니다.

#### 수용 기준

1. WHEN 프로파일 선택 콤보박스가 표시되면 THEN 기본 3환경과 모든 커스텀 프로파일이 목록에 나타나야 합니다
2. WHEN 콤보박스에서 프로파일을 선택하면 THEN 우측 편집기에 해당 환경의 YAML 설정이 표시되어야 합니다
3. WHEN "현재 환경으로 전환" 버튼을 클릭하면 THEN 선택된 프로파일이 활성 환경으로 설정되어야 합니다
4. WHEN "현재 환경 커스텀 저장" 버튼을 클릭하면 THEN 현재 설정으로 새 커스텀 프로파일이 생성되어야 합니다
5. WHEN 커스텀 프로파일을 선택 후 삭제 버튼을 클릭하면 THEN 확인 후 프로파일이 삭제되어야 합니다

### 요구사항 4: YAML 편집기 및 뷰어 시스템

**사용자 스토리:** 개발자로서 환경 설정을 YAML 텍스트 형태로 직접 확인하고 편집할 수 있는 편집기가 필요합니다.

#### 수용 기준

1. WHEN 우측 편집기가 표시되면 THEN 현재 환경의 YAML 설정이 구문 강조와 함께 표시되어야 합니다
2. WHEN 프로파일을 선택하면 THEN 해당 프로파일의 YAML 내용이 읽기 모드로 표시되어야 합니다
3. WHEN "편집" 버튼을 클릭하면 THEN 편집 모드로 전환되고 YAML을 직접 수정할 수 있어야 합니다
4. WHEN 기존 프로파일 편집 시 THEN temp 파일이 생성되고 저장 시 원본에 적용 후 temp 파일이 삭제되어야 합니다
5. WHEN 새 프로파일 편집 시 THEN `Custom_Profile_YYYYMMDD_HHMMSS.yaml` 형태로 생성되고 파일명 변경이 가능해야 합니다
5. WHEN YAML 구문 오류가 있으면 THEN 실시간으로 오류 위치와 메시지가 표시되어야 합니다
6. WHEN 편집기에 YAML 구문 강조가 적용되면 THEN 키, 값, 주석이 색상으로 구분되어야 합니다

### 요구사항 5: 상태 표시 및 레이블 시스템

**사용자 스토리:** 개발자로서 현재 보고 있는 설정이 '현재 환경', '선택 환경', '편집중' 중 어떤 상태인지 명확히 알고 싶습니다.

#### 수용 기준

1. WHEN 편집기 상단에 상태 레이블이 표시되면 THEN 현재 모드가 명확히 표시되어야 합니다
2. WHEN 현재 활성 환경을 보고 있으면 THEN "🟢 현재 환경: Development" 형태로 표시되어야 합니다
3. WHEN 다른 환경을 선택했으면 THEN "🔵 선택 환경: Testing" 형태로 표시되어야 합니다
4. WHEN 편집 모드에 있으면 THEN "✏️ 편집중: Custom_Profile_20250811_143000" 형태로 표시되어야 합니다
5. WHEN 상태가 변경되면 THEN 레이블이 실시간으로 업데이트되어야 합니다

### 요구사항 6: 편집 모드 제어 시스템

**사용자 스토리:** 개발자로서 편집 모드에서 저장, 취소, 편집 등의 작업을 명확한 버튼으로 제어하고 싶습니다.

#### 수용 기준

1. WHEN 편집기 하단에 제어 버튼들이 표시되면 THEN 편집, 취소, 저장 버튼이 기능에 맞게 활성화되어야 합니다
2. WHEN 읽기 모드에서 "편집" 버튼을 클릭하면 THEN 편집 모드로 전환되고 버튼 상태가 변경되어야 합니다
3. WHEN 편집 모드에서 "취소" 버튼을 클릭하면 THEN 변경사항이 취소되고 읽기 모드로 돌아가야 합니다
4. WHEN 편집 모드에서 "저장" 버튼을 클릭하면 THEN 새 커스텀 프로파일이 생성되고 콤보박스에 추가되어야 합니다
5. WHEN 편집 중 내용이 변경되면 THEN 저장 버튼이 활성화되고 변경 상태가 표시되어야 합니다

### 요구사항 7: 기본 환경 보호 및 제한 시스템

**사용자 스토리:** 개발자로서 기본 3환경(Development, Testing, Production)은 시스템 안정성을 위해 직접 편집할 수 없고 읽기 전용으로 관리되어야 합니다.

#### 수용 기준

1. WHEN 기본 3환경 중 하나를 선택하면 THEN 읽기 모드로만 표시되고 편집 버튼이 비활성화되어야 합니다
2. WHEN 기본 환경에서 편집을 시도하면 THEN "기본 환경은 편집할 수 없습니다. 커스텀 프로파일로 저장해서 편집하세요" 메시지가 표시되어야 합니다
3. WHEN 기본 환경을 삭제하려 하면 THEN "기본 환경은 삭제할 수 없습니다" 메시지가 표시되어야 합니다
4. WHEN 기본 환경의 설정을 수정하려면 THEN 외부 config 파일을 직접 편집하도록 안내되어야 합니다
5. WHEN 기본 환경이 선택되면 THEN UI에서 읽기 전용임이 시각적으로 명확히 표시되어야 합니다

### 요구사항 8: 파일명 자동 생성 및 관리

**사용자 스토리:** 개발자로서 커스텀 프로파일을 편집할 때 파일명이 자동으로 생성되고 중복을 방지하는 시스템이 필요합니다.

#### 수용 기준

1. WHEN 편집 모드로 진입하면 THEN `Custom_Profile_YYYYMMDD_HHMMSS.yaml` 형태의 기본 파일명이 생성되어야 합니다
2. WHEN 동일한 시간에 여러 프로파일을 생성하면 THEN 자동으로 순번이 추가되어 중복을 방지해야 합니다
3. WHEN 사용자가 파일명을 수정하면 THEN 유효성 검사 후 적용되어야 합니다
4. WHEN 파일명에 금지된 문자가 있으면 THEN 자동으로 안전한 문자로 치환되어야 합니다
5. WHEN 프로파일이 저장되면 THEN 파일명이 콤보박스에 표시되고 선택 가능해야 합니다

### 요구사항 9: 통합 스타일 시스템 적용

**사용자 스토리:** 개발자로서 환경 프로파일 탭이 기존 애플리케이션의 QSS 테마 시스템과 완전히 통합되어 일관된 디자인을 제공받고 싶습니다.

#### 수용 기준

1. WHEN 환경 프로파일 탭이 표시되면 THEN 기존 QSS 테마의 색상과 스타일이 일관되게 적용되어야 합니다
2. WHEN 퀵 환경 버튼이 표시되면 THEN 각 환경별로 구분되는 색상이 명확하게 적용되어야 합니다
3. WHEN 편집기 영역이 표시되면 THEN 코드 에디터에 적합한 폰트와 구문 강조가 적용되어야 합니다
4. WHEN 버튼과 레이블이 표시되면 THEN 기존 UI와 동일한 스타일링이 적용되어야 합니다
5. WHEN 테마가 변경되면 THEN 환경 프로파일 탭도 즉시 새 테마로 업데이트되어야 합니다

### 요구사항 10: Infrastructure 로깅 시스템 통합

**사용자 스토리:** 개발자로서 환경 프로파일 변경 및 편집 작업이 모두 Infrastructure 로깅 시스템 v4.0으로 기록되어 추적과 디버깅이 가능해야 합니다.

#### 수용 기준

1. WHEN 환경 프로파일 탭이 초기화되면 THEN Infrastructure 로깅으로 초기화 과정이 기록되어야 합니다
2. WHEN 환경 전환이 발생하면 THEN 전환 전후 상태와 성공/실패가 로깅되어야 합니다
3. WHEN 커스텀 프로파일이 생성/편집/삭제되면 THEN 해당 작업이 상세히 로깅되어야 합니다
4. WHEN YAML 편집 중 오류가 발생하면 THEN 오류 내용과 위치가 로깅되어야 합니다
5. WHEN 사용자 액션이 실행되면 THEN 액션 타입과 결과가 구조화된 형태로 로깅되어야 합니다

### 요구사항 11: ConfigProfileService 연동 강화

**사용자 스토리:** 개발자로서 UI 변경사항이 기존 ConfigProfileService와 완벽히 연동되어 기존 기능의 호환성이 보장되어야 합니다.

#### 수용 기준

1. WHEN UI에서 프로파일을 전환하면 THEN ConfigProfileService.switch_profile()이 정확히 호출되어야 합니다
2. WHEN 커스텀 프로파일을 저장하면 THEN ConfigProfileService를 통해 올바른 위치에 저장되어야 합니다
3. WHEN 프로파일 목록을 로드하면 THEN ConfigProfileService에서 제공하는 모든 프로파일이 표시되어야 합니다
4. WHEN 환경변수가 변경되면 THEN ConfigProfileService의 환경변수 매핑 로직이 적용되어야 합니다
5. WHEN 서비스 레이어에서 오류가 발생하면 THEN UI에서 적절한 오류 메시지가 표시되어야 합니다

### 요구사항 12: 실시간 설정 동기화

**사용자 스토리:** 개발자로서 환경 프로파일을 변경했을 때 애플리케이션의 다른 부분도 즉시 새 설정을 반영하여 일관된 동작을 보장받고 싶습니다.

#### 수용 기준

1. WHEN 환경 프로파일이 변경되면 THEN 로깅 설정이 즉시 새 환경에 맞게 적용되어야 합니다
2. WHEN 프로파일 전환이 완료되면 THEN 다른 설정 탭들도 새 환경의 값을 표시해야 합니다
3. WHEN 환경변수가 변경되면 THEN 애플리케이션이 재시작 없이 새 값을 인식해야 합니다
4. WHEN 설정 파일이 외부에서 수정되면 THEN UI가 자동으로 새로고침되어야 합니다
5. WHEN 동기화 과정에서 충돌이 발생하면 THEN 사용자에게 명확한 해결 방안이 제시되어야 합니다

### 요구사항 13: 성능 및 사용성 최적화

**사용자 스토리:** 개발자로서 환경 프로파일 관리 작업이 빠르고 직관적으로 수행되어 개발 워크플로우를 방해하지 않기를 원합니다.

#### 수용 기준

1. WHEN 프로파일을 선택하면 THEN 0.5초 이내에 YAML 내용이 표시되어야 합니다
2. WHEN 편집 모드로 전환하면 THEN 지연 없이 즉시 편집이 가능해야 합니다
3. WHEN 대용량 YAML 파일을 로드하면 THEN UI가 블록되지 않고 로딩 표시가 나타나야 합니다
4. WHEN 자동 저장 기능이 동작하면 THEN 사용자 타이핑을 방해하지 않아야 합니다
5. WHEN 키보드 단축키를 사용하면 THEN 빠른 환경 전환과 편집 모드 토글이 가능해야 합니다

### 요구사항 14: 호환성 및 확장성

**사용자 스토리:** 개발자로서 새로운 환경 프로파일 시스템이 기존 시스템과 완전히 호환되고 향후 확장 가능한 구조로 설계되기를 원합니다.

#### 수용 기준

1. WHEN 기존 환경 설정 방식을 사용하면 THEN 새 UI에서도 정상적으로 동작해야 합니다
2. WHEN 새 설정 카테고리가 추가되면 THEN 기존 코드 수정 없이 지원되어야 합니다
3. WHEN 외부 도구에서 프로파일을 생성하면 THEN UI에서 자동으로 인식되어야 합니다
4. WHEN API를 통해 프로파일을 조작하면 THEN UI가 즉시 동기화되어야 합니다
5. WHEN 다른 플랫폼에서 동작하면 THEN 동일한 기능과 성능을 제공해야 합니다

### 요구사항 15: API 키 보존 및 실거래 안전장치

**사용자 스토리:** 개발자로서 환경 프로파일을 전환해도 API 키는 보존되고, 개발/테스트 환경에서는 실거래가 안전하게 차단되어야 합니다.

#### 수용 기준

1. WHEN 환경 프로파일을 전환하면 THEN API 키 설정은 변경되지 않고 기존 값이 유지되어야 합니다
2. WHEN API 설정 탭에서 API 키를 입력/삭제하면 THEN 환경 프로파일과 무관하게 독립적으로 관리되어야 합니다
3. WHEN 개발/테스트 환경이 활성화되면 THEN 실제 거래 주문이 자동으로 차단되어야 합니다
4. WHEN 테스트 환경에서 거래 시뮬레이션을 하면 THEN paper trading으로 수수료와 슬리피지가 적용된 결과를 제공해야 합니다
5. WHEN API 설정 탭에 실거래 허용/차단 체크박스가 있으면 THEN 환경과 연동되어 자동 설정되어야 합니다

### 요구사항 16: 수동 프로파일 적용 시스템

**사용자 스토리:** 개발자로서 환경 프로파일이 자동으로 강제 적용되지 않고, 명시적으로 "전환 적용" 버튼을 누를 때만 적용되는 안전한 시스템이 필요합니다.

#### 수용 기준

1. WHEN 프로그램이 시작되면 THEN 마지막 사용 설정이 유지되고 프로파일이 자동 적용되지 않아야 합니다
2. WHEN 프로파일을 선택하면 THEN 미리보기만 표시되고 실제 설정은 변경되지 않아야 합니다
3. WHEN "전환 적용" 버튼을 클릭하면 THEN 선택된 프로파일의 설정이 현재 시스템에 적용되어야 합니다
4. WHEN 프로파일 적용 전에는 THEN 현재 실제 설정값이 뷰어에 표시되어야 합니다
5. WHEN 프로파일이 적용되면 THEN DB에 저장된 설정도 함께 업데이트되어야 합니다

### 요구사항 17: 통합 설정 동기화 메커니즘

**사용자 스토리:** 개발자로서 프로파일 전환 시 YAML 설정과 DB 설정이 일관되게 동기화되어 설정 충돌이 발생하지 않기를 원합니다.

#### 수용 기준

1. WHEN 프로파일을 적용하면 THEN YAML 설정값이 해당하는 DB 설정에 반영되어야 합니다
2. WHEN DB에 저장되는 설정이 있으면 THEN 프로파일 적용 시 자동으로 업데이트되어야 합니다
3. WHEN 설정 동기화가 진행되면 THEN 변경 전 상태가 자동으로 백업되어야 합니다
4. WHEN 동기화 과정에서 오류가 발생하면 THEN 롤백 메커니즘이 작동해야 합니다
5. WHEN 프로파일과 관련 없는 설정은 THEN 동기화 과정에서 변경되지 않아야 합니다

### 요구사항 18: 테스트 및 검증

**사용자 스토리:** 개발자로서 환경 프로파일 재디자인이 모든 시나리오에서 안정적으로 동작하는지 자동화된 테스트를 통해 검증하고 싶습니다.

#### 수용 기준

1. WHEN UI 테스트를 실행하면 THEN 모든 사용자 인터랙션이 정상 동작해야 합니다
2. WHEN 프로파일 관리 테스트를 실행하면 THEN 생성/편집/삭제/전환이 모두 성공해야 합니다
3. WHEN YAML 파싱 테스트를 실행하면 THEN 다양한 형식의 설정 파일이 올바르게 처리되어야 합니다
4. WHEN 성능 테스트를 실행하면 THEN 응답 시간과 메모리 사용량이 기준 내에 있어야 합니다
5. WHEN 호환성 테스트를 실행하면 THEN 기존 시스템과의 연동이 완벽해야 합니다

### 요구사항 19: 프로파일 표시명 및 메타데이터 시스템

**사용자 스토리:** 개발자로서 콤보박스에서 프로파일을 선택할 때 파일명이 아닌 의미있는 이름과 설명으로 구분하고 싶습니다.

#### 수용 기준

1. WHEN 콤보박스에 프로파일 목록이 표시되면 THEN "표시명 (타입)" 형태로 나타나야 합니다
2. WHEN 커스텀 프로파일에 메타데이터가 있으면 THEN 설정된 이름과 설명이 사용되어야 합니다
3. WHEN 기본 프로파일이 표시되면 THEN "Development (기본환경)" 형태로 구분되어야 합니다
4. WHEN 프로파일에 메타데이터가 없으면 THEN 파일명을 기반으로 표시명이 생성되어야 합니다
5. WHEN 프로파일 정보를 조회하면 THEN 이름, 설명, 생성일시, 타입이 포함되어야 합니다

### 요구사항 20: 고급 YAML 편집기 기능

**사용자 스토리:** 개발자로서 YAML을 편집할 때 구문 강조, 들여쓰기 도움, 오류 감지 등의 편집기 기능을 제공받고 싶습니다.

#### 수용 기준

1. WHEN YAML 편집기가 표시되면 THEN QPlainTextEdit 기반의 모노스페이스 폰트가 적용되어야 합니다
2. WHEN YAML 내용을 입력하면 THEN 키, 값, 주석이 색상별로 구문 강조되어야 합니다
3. WHEN 탭 키를 누르면 THEN 2스페이스 들여쓰기가 적용되어야 합니다
4. WHEN YAML 구문 오류가 있으면 THEN 해당 라인이 시각적으로 강조되어야 합니다
5. WHEN 편집기가 테마 변경되면 THEN 구문 강조 색상도 테마에 맞게 변경되어야 합니다

## 추가 연동 요구사항

### API 설정 탭 개선

**연동 배경:** 환경 프로파일 시스템과 완전한 호환성을 위해 API 설정 탭에 실거래 제어 기능이 추가되어야 합니다.

#### 개선 요구사항

1. **실거래 제어 체크박스 추가**
   - 개발 환경: 실거래 차단 (강제)
   - 테스트 환경: Paper Trading 모드 (강제)
   - 제품 환경: 실거래 허용 (사용자 선택)

2. **이중 저장 버튼 시스템**
   - "API 키 저장" 버튼: API 키만 저장
   - "설정 저장" 버튼: 실거래 제어 설정 + 기타 API 관련 설정 저장

3. **환경 연동 자동화**
   - 환경 프로파일 전환 시 실거래 설정 자동 적용
   - API 키는 환경 변경과 무관하게 독립적 유지

### 데이터베이스 설정 정책

**정책 배경:** 모든 환경에서 동일한 DB를 사용하되, 프로파일 전환 시 설정값만 동기화하는 단순화된 접근 방식을 채택합니다.

#### 정책 세부사항

1. **DB 파일 통합 사용**
   - 모든 환경(개발/테스트/제품)에서 동일한 3개 DB 사용
   - 환경별 DB 분리 없음 (복잡성 방지)

2. **설정 동기화 방식**
   - 프로파일 적용 시: YAML 설정 → DB 설정 반영
   - 설정 변경 시: 사용자 직접 변경사항 우선
   - 백업 정책: 프로파일 적용 전 자동 백업

3. **우선순위 체계**
   ```
   1순위: 사용자 직접 입력 (API 키, 수동 설정)
   2순위: 환경 프로파일 설정 (YAML)
   3순위: DB 기본값
   ```

## 비기능 요구사항

### 성능 요구사항
- 프로파일 로딩: 500ms 이내
- 환경 전환: 1초 이내
- YAML 편집기 반응성: 실시간
- 메모리 사용량: 50MB 이하

### 사용성 요구사항
- 직관적인 좌우 분할 레이아웃
- 명확한 상태 표시 시스템
- 키보드 단축키 지원
- 접근성 준수 (WCAG 2.1 AA)

### 신뢰성 요구사항
- 설정 변경 시 자동 백업
- 오류 복구 메커니즘
- 데이터 무결성 보장
- 중단 없는 환경 전환

### 보안 요구사항
- 민감 정보 마스킹
- 설정 파일 권한 관리
- 변경 이력 추적
- 무단 접근 방지

## 제약사항

### 기술적 제약사항
- PyQt6 UI 프레임워크 사용
- DDD 아키텍처 완전 준수
- Infrastructure 로깅 시스템 v4.0 의존
- Windows PowerShell 환경 전용

### 비즈니스 제약사항
- 기존 프로파일 시스템과 완전 호환
- 기본 7규칙 전략 시스템과 연동
- 사용자 학습 비용 최소화
- 기존 워크플로우 중단 금지

### 설계 제약사항
- MVP 패턴 엄격 적용
- QSS 테마 시스템 의존
- 파일명 일관성 유지 규칙 준수
- 3-DB 아키텍처 영향 금지
