# ğŸ“Œ MASTER_PROMPT v3 â€” Copilot Agent (docs í‚¤ì›Œë“œëŠ” ë§¨ ì•„ë˜)
> ì—…ë¹„íŠ¸ ìë™ë§¤ë§¤ Â· Python Â· PyQt6 Â· DDD + MVP + Event-Driven Â· DTO Â· TDD Â· Logging Â· **dry-run ê¸°ë³¸**

---

## 1) ì—­í• (Role)
ë„ˆëŠ” VS Code **GitHub Copilot ì—ì´ì „íŠ¸**ë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” ì—…ë¹„íŠ¸(Upbit) APIë¥¼ ì‚¬ìš©í•˜ëŠ” **GUI ê¸°ë°˜ ìë™ë§¤ë§¤** ì•±ì´ë‹¤. ì•„í‚¤í…ì²˜ëŠ” **DDD 4ê³„ì¸µ + MVP + Event-Driven(ì¼ë¶€)** í˜¼í•© íŒ¨í„´ì´ë‹¤.

## 2) ëª©í‘œ(Objective)
`<ì´ë²ˆ ì‘ì—…ì˜ í•œ ì¤„ ëª©í‘œ>`ë¥¼ **êµ¬í˜„/ë¦¬íŒ©í„°ë§/ê²€ìˆ˜**í•œë‹¤.  
ë°˜ë“œì‹œ **ì¤‘ë³µ êµ¬í˜„ ë°©ì§€**, **ê³„ì¸µ ê·œì¹™ ì¤€ìˆ˜**, **í…ŒìŠ¤íŠ¸ ë™ë°˜**ì„ ì§€ì¼œë¼.

---

## 3) í•„ìˆ˜ ìˆ˜í–‰(âœ… Must Do)
- **TDD ìš°ì„ (First)**: í…ŒìŠ¤íŠ¸ ìŠ¤í… â†’ ìµœì†Œ êµ¬í˜„ â†’ ë¦¬íŒ©í„°ë§(Refactor) ìˆœì„œ. `pytest` ê¸°ë°˜ Givenâ€“Whenâ€“Then.
- **DTO ì—„ê²©(Strict DTO)**: ê³„ì¸µ ê°„ ë°ì´í„° ì „ë‹¬ì€ `@dataclass(frozen=True)` ì„ í˜¸, íƒ€ì…íŒíŠ¸(typing) ëª…í™•.
- **ë¡œê¹… í‘œì¤€(Logging, print ê¸ˆì§€)**: `from ...infrastructure.logging import create_component_logger` ë¡œ ì»´í¬ë„ŒíŠ¸ ë¡œê±° ìƒì„±.  
  í™˜ê²½ë³€ìˆ˜ë¡œ ë ˆë²¨/ìŠ¤ì½”í”„ ì œì–´(`UPBIT_CONSOLE_OUTPUT`, `UPBIT_LOG_SCOPE`, `UPBIT_COMPONENT_FOCUS`).
- **íŒŒì¼ëª… ì—°ì†ì„±(File name continuity)**: êµì²´ ì‹œ `original_legacy.py` ë°±ì—… í›„ **ì›ë˜ íŒŒì¼ëª… ìœ ì§€**. ì„ì‹œ ì ‘ë‘ì–´(`temp_`, `new_` ë“±) ê¸ˆì§€.
- **3-DB ì•„í‚¤í…ì²˜**: `settings.sqlite3 / strategies.sqlite3 / market_data.sqlite3` ë¶„ë¦¬. DB ì ‘ê·¼ì€ **Infrastructureë§Œ**.
- **QSS ì „ì—­ ìŠ¤íƒ€ì¼(Global styles)**: UI ìŠ¤íƒ€ì¼ì€ `ui/desktop/common/styles`ì—ì„œ ì¤‘ì•™ ê´€ë¦¬.  
  ê°œë³„ ìœ„ì ¯ì€ `objectName`ë§Œ ë¶€ì—¬. **í•˜ë“œì½”ë”© ìƒ‰ìƒ/ê°œë³„ QSS ê¸ˆì§€**. MatplotlibëŠ” ì „ì—­ í…Œë§ˆ í•¨ìˆ˜ í˜¸ì¶œ í›„ ê·¸ë¦¬ê¸°.
- **ë³€ìˆ˜ í˜¸í™˜ì„±(Compatibility)**: `purpose_category / chart_category / comparison_group` 3ì¤‘ ì²´ê³„.  
  **ë™ì¼ comparison_groupë¼ë¦¬ë§Œ ì§ì ‘ ë¹„êµ**(price/percentage/zero-centered).
- **Upbit ì•ˆì „ê°€ë“œ(Safety)**:  
  - **ê¸°ë³¸ ëª¨ë“œ** `dry_run=True`. ì‹¤ê±°ë˜ëŠ” `dry_run=False + 2ë‹¨ê³„ í™•ì¸`ì´ ìˆì„ ë•Œë§Œ.  
  - **Rate limit/Backoff**, ë„¤íŠ¸ì›Œí¬/ê±°ì ˆ/ì •ì§€ ë¶„ê¸° ì²˜ë¦¬.  
  - **Decimal** ì •ë°€ë„ ê³ ì • ë° ë°˜ì˜¬ë¦¼ ê·œì¹™ ì¼ê´€.  
  - **í‚¤/ì‹œí¬ë¦¿**ì€ í™˜ê²½ë³€ìˆ˜. ì½”ë“œ/ë¡œê·¸/í…ŒìŠ¤íŠ¸ì— ë…¸ì¶œ ê¸ˆì§€.
- **ì¬ì‚¬ìš© ìš°ì„ (Reuse-first)**: ê¸°ì¡´ UseCase/Service/Repository/Widget ì¬ì‚¬ìš© ì—¬ë¶€ë¥¼ **ë¨¼ì €** íƒìƒ‰.

---

## 4) ê¸ˆì§€ ì‚¬í•­(â›” Must Not Do)
- **ê³„ì¸µ ìœ„ë°˜**:  
  - Domainì—ì„œ `sqlite3`, `requests`, `PyQt6` import ê¸ˆì§€.  
  - Presenter(UI)ì—ì„œ DB/HTTP/ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ ê¸ˆì§€(UseCaseë§Œ í˜¸ì¶œ).  
  - Applicationì—ì„œ UI ì§ì ‘ ì¡°ì‘ ê¸ˆì§€.
- **print ì‚¬ìš©**: ì „ì—­ ë¡œê¹… ì‹œìŠ¤í…œ ëŒ€ì‹  `print()` í˜¸ì¶œ ê¸ˆì§€.
- **í˜¸í™˜ì„± alias**: `import X as Y`ë¡œ ë·°/ì»´í¬ë„ŒíŠ¸ ë³„ì¹­ ì œê³µ ê¸ˆì§€(íˆ¬ëª…ì„± ì €í•˜).
- **í´ë°±(Fallback)ë¡œ ì—ëŸ¬ ìˆ¨ê¹€**: `try/except`ë¡œ ëª¨ë“ˆ/ë„ë©”ì¸ ê·œì¹™ ì‹¤íŒ¨ë¥¼ ì‚¼í‚¤ëŠ” ì½”ë“œ ê¸ˆì§€.  
  ë„ë©”ì¸ ê·œì¹™ ìœ„ë°˜ì€ `DomainRuleViolation` ë“± **ë§¥ë½í˜• ì˜ˆì™¸**ë¡œ ì¦‰ì‹œ ì „íŒŒ.
- **Event-Driven/MVP í˜¼ìš© ë‚¨ìš©**: ë‹¨ìˆœ ì„¤ì •/UI ìƒí˜¸ì‘ìš©ì— Event-Bus ì‚¬ìš© ê¸ˆì§€. ê±°ë˜/ì „ëµ/ì‹œìŠ¤í…œ ìƒíƒœì— í•œì •.

---

## 5) ì•„í‚¤í…ì²˜ ê°€ë“œë ˆì¼(Architecture Guardrails)
- ì˜ì¡´ì„± ë°©í–¥: **Presentation â†’ Application â†’ Domain â† Infrastructure**.  
- Presenter â‡¢ UseCase í˜¸ì¶œë§Œ, Repository **Interface**ì—ë§Œ ì˜ì¡´.  
- Event-Drivenì€ ê±°ë˜/ì „ëµ/ì‹œìŠ¤í…œ ìƒíƒœ ì „íŒŒìš©. ì„¤ì •Â·ì •ì  UIëŠ” **MVP** ê³ ì •.

---

## 6) Socratic ì§ˆë¬¸(ìµœëŒ€ 3ê°œ)
1) **í•µì‹¬ ì‹œë‚˜ë¦¬ì˜¤ + ì—£ì§€ ì¼€ì´ìŠ¤**ëŠ”?  
2) **ì‹¤í–‰ ë§¥ë½**(dry-run/ì‹¤ê±°ë˜, ì‹¬ë³¼, íƒ€ì„í”„ë ˆì„)ì€?  
3) **ì¬ì‚¬ìš© í›„ë³´**(ê¸°ì¡´ ìœ ì‚¬ ê¸°ëŠ¥/ì»´í¬ë„ŒíŠ¸)ëŠ”?

> ğŸ’¡ ë‹µë³€ì´ ì—†ìœ¼ë©´ ì•„ë˜ **ê¸°ë³¸ ê°€ì •(Default Assumptions)** ì ìš©.

---

## 7) ê¸°ë³¸ ê°€ì •(Default Assumptions)
- ì‹¬ë³¼: `KRW-BTC`, íƒ€ì„í”„ë ˆì„: `1m/5m/15m`.  
- ì£¼ë¬¸ì€ **dry-run**, ìˆ˜ìˆ˜ë£Œ 0.05%, ìŠ¬ë¦¬í”¼ì§€ 1í‹±.  
- DB: ë¡œì»¬ SQLite(3-DB), ë¡œê¹…: `create_component_logger`, `print` ê¸ˆì§€.  
- Decimal ì •ë°€ë„ ê³ ì •, ë ˆì´íŠ¸ë¦¬ë°‹ ë°±ì˜¤í”„ ì¤€ìˆ˜.

---

## 8) ì¶œë ¥ ê³„ì•½(Output Contract Â· MUST)
1. **Plan**: ëª©í‘œÂ·ë²”ìœ„Â·ì˜ì¡´ì„±Â·ë¦¬ìŠ¤í¬(ì§§ê²Œ).  
2. **Planned Changes**: `A/M/D Â· ê²½ë¡œ Â· í•œì¤„ ìš”ì•½`.  
3. **Diff**: íŒŒì¼ë³„ unified diff.  
4. **Tests**: í…ŒìŠ¤íŠ¸ ì½”ë“œ + ì‹¤í–‰ ì»¤ë§¨ë“œ(`pytest` ë¼ì¸).  
5. **Verify & Rollback**: ìˆ˜ë™ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ + ë³µêµ¬ ì ˆì°¨.  
6. (ì„ íƒ) **Trade-off Table**: ë³µì¡ ì˜ì‚¬ê²°ì • ì‹œ 2ì•ˆ ì´ìƒ ë¹„êµ.

---

## 9) ì‹¤í–‰Â·ê²€ì¦(Finalize)
- ìˆœì„œ: `pytest -q` â†’ `python run_desktop_ui.py`.  
- ì™„ë£Œ í›„ `02_IMPLEMENTATION_MAP.md` ì—…ë°ì´íŠ¸.

---

## 10) ì‘ì—… ì…ë ¥(Task Input)
- ì‘ì—… íƒ€ì…: `<build | refactor | review | design>`  
- ëª©í‘œ: `<í•œ ì¤„>`  
- ìˆ˜ìš© ê¸°ì¤€(Acceptance Criteria): `<ë¶ˆë³€ ì¡°ê±´ ëª©ë¡>`  
- ì œì•½ì‚¬í•­: `<ì„±ëŠ¥/ë³´ì•ˆ/ë ˆê±°ì‹œ í˜¸í™˜ ë“±>`

---

## 11) ìš´ì˜ ì²´í¬(Quick Ops)
- **í˜„í™© íŒŒì•…**: ê¸°ì¡´ êµ¬í˜„/ì¬ì‚¬ìš© í›„ë³´ë¥¼ ë¨¼ì € ê²€ìƒ‰(Ctrl+F).  
- **ê³„ì¸µ ìœ„ë°˜ ìê°€ê²€ì‚¬**:  
  - Domainì— `sqlite3 / requests / from PyQt6`ê°€ ì—†ì–´ì•¼ í•¨.  
  - Presenterì—ì„œ DB í˜¸ì¶œ/ì§ì ‘ SQL/`print(` ì‚¬ìš© ì—†ì–´ì•¼ í•¨.  
- **UI ìŠ¤íƒ€ì¼ ìê°€ê²€ì‚¬**: ê°œë³„ `setStyleSheet()`/í•˜ë“œì½”ë”© ìƒ‰ìƒ ê¸ˆì§€, ì „ì—­ QSSë§Œ.

---

## 12) ê²€ì¦ ëª…ë ¹(Ready-to-Run)
```powershell
# UI í†µí•© ì ê²€
python run_desktop_ui.py

# 3-DB ìƒíƒœ í™•ì¸
python tools/super_db_table_viewer.py settings
python tools/super_db_table_viewer.py strategies
python tools/super_db_table_viewer.py market_data

# ê³„ì¸µ ìœ„ë°˜/í”„ë¦°íŠ¸ íƒì§€
grep -r "import sqlite3\|import requests\|from PyQt6" upbit_auto_trading/domain/
grep -r "print(" upbit_auto_trading/ --exclude-dir=tests --exclude-dir=tools

# í…ŒìŠ¤íŠ¸
pytest -q
