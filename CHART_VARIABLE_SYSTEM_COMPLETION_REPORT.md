# μ°¨νΈ λ³€μ μΉ΄ν…κ³ λ¦¬ μ‹μ¤ν… μ™„μ„± λ³΄κ³ μ„

## π“‹ κµ¬ν„ μ™„λ£ λ‚΄μ©

### 1. λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ μ„¤κ³„ λ° κµ¬μ¶• β…

#### μƒλ΅μ΄ ν…μ΄λΈ”λ“¤
- **`chart_variables`**: λ³€μ μ •μ λ° ν‘μ‹ μ„¤μ •
- **`variable_compatibility_rules`**: λ³€μ κ°„ νΈν™μ„± κ·μΉ™
- **`chart_layout_templates`**: μ°¨νΈ λ μ΄μ•„μ›ƒ ν…ν”λ¦Ώ
- **`variable_usage_logs`**: λ³€μ μ‚¬μ© λ΅κ·Έ

#### μ§€μ›ν•λ” λ³€μ μΉ΄ν…κ³ λ¦¬
- **κ°€κ²© μ¤λ²„λ μ΄ (price_overlay)**: μ‹κ°€ μ°¨νΈμ— ν•¨κ» ν‘μ‹
  - ν„μ¬κ°€, μ΄λ™ν‰κ· , λ³Όλ¦°μ €λ°΄λ“
- **μ¤μ‹¤λ μ΄ν„° (oscillator)**: λ³„λ„ μ„λΈν”λ΅―, 0-100 μ¤μΌ€μΌ
  - RSI, μ¤ν† μΊμ¤ν‹±
- **λ¨λ©ν…€ (momentum)**: λ³„λ„ μ„λΈν”λ΅―
  - MACD
- **κ±°λλ‰ (volume)**: λ³„λ„ μ„λΈν”λ΅―, νμ¤ν† κ·Έλ¨
  - κ±°λλ‰

### 2. μ°¨νΈ ν‘μ‹ λ°©μ‹ μ •μ β…

#### λ©”μΈ μ°¨νΈ ν‘μ‹ λ°©μ‹
- **main_line**: λ©”μΈ μ°¨νΈμ— μ„ μΌλ΅ ν‘μ‹ (μ΄λ™ν‰κ· )
- **main_band**: λ©”μΈ μ°¨νΈμ— λ°΄λ“λ΅ ν‘μ‹ (λ³Όλ¦°μ €λ°΄λ“)
- **main_level**: λ©”μΈ μ°¨νΈμ— μν‰μ„ μΌλ΅ ν‘μ‹ (ν„μ¬κ°€)

#### μ„λΈν”λ΅― ν‘μ‹ λ°©μ‹
- **subplot_line**: μ„λΈν”λ΅―μ— μ„ μΌλ΅ ν‘μ‹ (RSI, MACD)
- **subplot_histogram**: μ„λΈν”λ΅―μ— νμ¤ν† κ·Έλ¨μΌλ΅ ν‘μ‹ (κ±°λλ‰)
- **subplot_level**: μ„λΈν”λ΅―μ— μν‰μ„ μΌλ΅ ν‘μ‹ (κ³ μ •κ°’)

### 3. νΈν™μ„± κ²€μ‚¬ μ‹μ¤ν… β…

#### κµ¬ν„λ νΈν™μ„± κ·μΉ™
- **RSI** β†” **μ¤μ‹¤λ μ΄ν„°**, **νΌμ„ΌνΈ** νΈν™
- **ν„μ¬κ°€** β†” **κ°€κ²© μ¤λ²„λ μ΄**, **ν†µν™”** νΈν™
- **MACD** β†” **λ¨λ©ν…€** νΈν™
- **μ¤ν† μΊμ¤ν‹±** β†” **μ¤μ‹¤λ μ΄ν„°** νΈν™

#### νΈν™μ„± κ²€μ‚¬ κΈ°λ¥
- μλ™ μΉ΄ν…κ³ λ¦¬ λ§¤μΉ­
- μ¤μΌ€μΌ μ μ•½ μ΅°κ±΄ κ²€μ‚¬
- μ‚¬μ©μ μΉν™”μ  μ¤λ¥ λ©”μ‹μ§€

### 4. μ„λΉ„μ¤ λ μ΄μ–΄ κµ¬ν„ β…

#### ChartVariableService ν΄λμ¤
- λ³€μ μ„¤μ • μ΅°ν λ° μΊμ‹±
- νΈν™μ„± κ²€μ‚¬
- μ°¨νΈ λ μ΄μ•„μ›ƒ μ •λ³΄ μƒμ„±
- μ‚¬μ© ν†µκ³„ κ΄€λ¦¬

#### μ£Όμ” λ©”μ„λ“
- `get_variable_config()`: λ³€μ μ„¤μ • μ΅°ν
- `is_compatible_external_variable()`: νΈν™μ„± κ²€μ‚¬
- `get_chart_layout_info()`: λ μ΄μ•„μ›ƒ μ •λ³΄ μƒμ„±
- `validate_variable_combination()`: μ΅°ν•© μ ν¨μ„± κ²€μ‚¬

### 5. μ°¨νΈ λ λ”λ§ μ—”μ§„ β…

#### ChartRenderingEngine ν΄λμ¤
- Plotly κΈ°λ° μΈν„°λ™ν‹°λΈ μ°¨νΈ
- μ„λΈν”λ΅― μλ™ λ°°μΉ
- μ§€ν‘λ³„ λ§μ¶¤ λ λ”λ§

#### μ§€μ›ν•λ” μ§€ν‘ λ λ”λ§
- **μΊ”λ“¤μ¤ν‹±**: κΈ°λ³Έ OHLC μ°¨νΈ
- **μ΄λ™ν‰κ· **: λ©”μΈ μ°¨νΈ μ„  μ¤λ²„λ μ΄
- **λ³Όλ¦°μ €λ°΄λ“**: λ©”μΈ μ°¨νΈ λ°΄λ“ μ¤λ²„λ μ΄
- **RSI**: μ„λΈν”λ΅―, 30/70 κΈ°μ¤€μ„  ν¬ν•¨
- **MACD**: μ„λΈν”λ΅―, Signal λΌμΈ ν¬ν•¨
- **κ±°λλ‰**: μ„λΈν”λ΅―, λ°” μ°¨νΈ

### 6. UI ν†µν•© β…

#### ν†µν•© μ΅°κ±΄ κ΄€λ¦¬μ ν™•μ¥
- μ°¨νΈ λ³€μ μ„ νƒκΈ° μ¶”κ°€
- μ‹¤μ‹κ°„ νΈν™μ„± μ •λ³΄ ν‘μ‹
- μΉ΄ν…κ³ λ¦¬λ³„ λ³€μ ν•„ν„°λ§
- μ°¨νΈ ν”„λ¦¬λ·° κΈ°λ¥

## π― μ”κµ¬μ‚¬ν•­ μ¶©μ΅±λ„

### β… μ™„λ£λ μ”κµ¬μ‚¬ν•­

1. **μ‹κ°€ μ°¨νΈ μ¤λ²„λ μ΄ μ§€ν‘**
   - β… μ΄λ™ν‰κ· : μ‹κ°€ μ°¨νΈμ— μ΄λ™ν‰κ· μ„  ν‘μ‹
   - β… λ³Όλ¦°μ €λ°΄λ“: μƒν•μ„ λ°΄λ“μ„  + λ°ν¬λ… μμ—­
   - β… ν„μ¬κ°€: κ³ μ •κ°’ μν‰μ„  λλ” λ™μ  κ·Έλν”„

2. **λ³„λ„ μ„λΈν”λ΅― μ§€ν‘**
   - β… MACD: λ³„λ„ μ„λΈν”λ΅―, MACD + Signal λΌμΈ
   - β… RSI: λ³„λ„ μ„λΈν”λ΅―, 0-100 μ¤μΌ€μΌ, 30/70 κΈ°μ¤€μ„ 
   - β… μ¤ν† μΊμ¤ν‹±: λ³„λ„ μ„λΈν”λ΅―, 0-100 μ¤μΌ€μΌ
   - β… κ±°λλ‰: λ³„λ„ μ„λΈν”λ΅―, νμ¤ν† κ·Έλ¨

3. **μ™Έλ¶€λ³€μ νΈν™μ„± κ²€μ‚¬**
   - β… μΉ΄ν…κ³ λ¦¬ κΈ°λ° μλ™ νΈν™μ„± νλ‹¨
   - β… μ¤μΌ€μΌ μ μ•½ μ΅°κ±΄ ν™•μΈ
   - β… μλ―Έμ—†λ” λΉ„κµ λ°©μ§€

4. **DB μ¤ν‚¤λ§ μ„¤κ³„**
   - β… ν™•μ¥ κ°€λ¥ν• λ³€μ μ •μ ν…μ΄λΈ”
   - β… νΈν™μ„± κ·μΉ™ ν…μ΄λΈ”
   - β… λ μ΄μ•„μ›ƒ ν…ν”λ¦Ώ ν…μ΄λΈ”
   - β… μ‚¬μ© λ΅κ·Έ ν…μ΄λΈ”

## π“ ν…μ¤νΈ κ²°κ³Ό

### λ°μ΄ν„°λ² μ΄μ¤ ν…μ¤νΈ
- β… 7κ° κΈ°λ³Έ λ³€μ λ“±λ΅ μ™„λ£
- β… 5κ° νΈν™μ„± κ·μΉ™ μ •μ μ™„λ£
- β… 2κ° λ μ΄μ•„μ›ƒ ν…ν”λ¦Ώ μƒμ„± μ™„λ£

### νΈν™μ„± κ²€μ‚¬ ν…μ¤νΈ
- β… RSI β†” μ¤ν† μΊμ¤ν‹±: νΈν™ (κ°™μ€ μ¤μ‹¤λ μ΄ν„°)
- β… ν„μ¬κ°€ β†” μ΄λ™ν‰κ· : νΈν™ (κ°™μ€ κ°€κ²© μ¤λ²„λ μ΄)
- β RSI β†” MACD: λ¶νΈν™ (λ‹¤λ¥Έ μΉ΄ν…κ³ λ¦¬)
- β ν„μ¬κ°€ β†” κ±°λλ‰: λ¶νΈν™ (μ™„μ „ λ‹¤λ¥Έ μΉ΄ν…κ³ λ¦¬)

### μ°¨νΈ λ μ΄μ•„μ›ƒ ν…μ¤νΈ
- β… λ©”μΈ μ°¨νΈλ§: ν„μ¬κ°€ + μ΄λ™ν‰κ· 
- β… μ„λΈν”λ΅―λ§: RSI
- β… νΌν•©: ν„μ¬κ°€ + μ΄λ™ν‰κ·  + RSI + MACD
- β… λ³µμ΅ν• μ΅°ν•©: ν„μ¬κ°€ + λ³Όλ¦°μ €λ°΄λ“ + RSI + MACD + κ±°λλ‰

## π€ ν–¥ν›„ ν™•μ¥ κ°€λ¥μ„±

### μƒλ΅μ΄ μ§€ν‘ μ¶”κ°€
```sql
INSERT INTO chart_variables (
    variable_id, variable_name, category, display_type,
    scale_min, scale_max, unit, default_color
) VALUES (
    'new_indicator', 'μƒλ΅μ΄ μ§€ν‘', 'oscillator', 'subplot_line',
    0, 100, '%', '#ff5733'
);
```

### μƒλ΅μ΄ νΈν™μ„± κ·μΉ™ μ¶”κ°€
```sql
INSERT INTO variable_compatibility_rules (
    base_variable_id, compatible_category, compatibility_reason
) VALUES (
    'new_indicator', 'percentage', 'νΌμ„ΌνΈ λ‹¨μ„ νΈν™'
);
```

### μƒλ΅μ΄ λ μ΄μ•„μ›ƒ ν…ν”λ¦Ώ μ¶”κ°€
```sql
INSERT INTO chart_layout_templates (
    template_name, description, main_chart_height_ratio,
    subplot_configurations, is_default
) VALUES (
    'scalping', 'μ¤μΊν•‘μ© λ μ΄μ•„μ›ƒ', 0.8,
    '{"rsi": {"height_ratio": 0.1, "position": 1}, "volume": {"height_ratio": 0.1, "position": 2}}',
    0
);
```

## π“ κµ¬ν„λ νμΌ λ©λ΅

### 1. λ°μ΄ν„° λ¨λΈ
- `upbit_auto_trading/data_layer/chart_variable_models.py`

### 2. λ§μ΄κ·Έλ μ΄μ…
- `tools/chart_variable_migration.py`

### 3. μ„λΉ„μ¤ λ μ΄μ–΄
- `upbit_auto_trading/ui/desktop/screens/strategy_management/trigger_builder/components/chart_variable_service.py`

### 4. μ°¨νΈ λ λ”λ§
- `upbit_auto_trading/ui/desktop/screens/strategy_management/trigger_builder/components/chart_rendering_engine.py`

### 5. UI ν†µν•©
- `upbit_auto_trading/ui/desktop/screens/strategy_management/integrated_condition_manager.py` (ν™•μ¥)
- `upbit_auto_trading/ui/desktop/screens/strategy_management/trigger_builder/components/variable_display_system.py` (μ—…λ°μ΄νΈ)

### 6. ν…μ¤νΈ λ„κµ¬
- `tools/simple_chart_test.py`
- `tools/chart_variable_demo.py`

## π‰ κ²°λ΅ 

μ°¨νΈ ν‘ν„μ„ μ„ν• λ³€μ μΉ΄ν…κ³ λ¦¬ μ‹μ¤ν…μ΄ μ„±κ³µμ μΌλ΅ μ™„μ„±λμ—μµλ‹λ‹¤. μ΄ μ‹μ¤ν…μ€:

1. **ν™•μ¥μ„±**: μƒλ΅μ΄ μ§€ν‘μ™€ ν‘μ‹ λ°©μ‹μ„ μ‰½κ² μ¶”κ°€ κ°€λ¥
2. **νΈν™μ„±**: λ³€μ κ°„ μλ―Έμλ” μ΅°ν•©λ§ ν—μ©
3. **μ‚¬μ©μ„±**: μ§κ΄€μ μΈ UIμ™€ μ‹¤μ‹κ°„ νΈν™μ„± κ²€μ‚¬
4. **μ„±λ¥**: μΊμ‹±κ³Ό ν¨μ¨μ μΈ DB μ¤ν‚¤λ§λ΅ λΉ λ¥Έ μ‘λ‹µ
5. **μ•μ •μ„±**: μ¶©λ¶„ν• ν…μ¤νΈμ™€ μ¤λ¥ μ²λ¦¬

μ΄μ  νΈλ¦¬κ±° λΉλ”μ—μ„ λ³€μλ¥Ό μ„ νƒν•  λ• μλ™μΌλ΅ μ μ ν• μ°¨νΈ ν‘ν„μ΄ μ„ νƒλκ³ , νΈν™λμ§€ μ•λ” μ΅°ν•©μ€ λ―Έλ¦¬ λ°©μ§€λ©λ‹λ‹¤. ν–¥ν›„ μƒλ΅μ΄ κΈ°μ μ  μ§€ν‘κ°€ μ¶”κ°€λμ–΄λ„ μ΄ μ‹μ¤ν…μ„ ν†µν•΄ μΌκ΄€λ μ°¨νΈ ν‘ν„μ΄ κ°€λ¥ν•©λ‹λ‹¤.
