# 미니차트 단순화 시스템 구현 보고서

## 📋 개요
트리거 빌더의 미니차트를 단순화하여 사용자 친화적이고 유지보수가 용이한 시스템으로 개선했습니다.

## 🎯 목표
1. **미니차트의 목적**: 설정된 트리거가 베이스 지표에 어떻게 반응하는지 직관적으로 파악
2. **단순화**: 복잡한 케이스 구분을 제거하고 일관된 4요소 시스템 적용
3. **시각적 개선**: 한글 텍스트 깨짐 해결 및 영문 약어 사용
4. **코드 효율성**: 관리 및 기능 효율화를 위한 코드 라인 수 감소

## 🔧 구현된 단순화 시스템

### 4가지 요소 통일
모든 차트에서 다음 4요소만 사용:

1. **Price/Volume (파란색)**
   - `Price`: 가격 데이터 (라인)
   - `Volume`: 거래량 데이터 (히스토그램)

2. **iVal (녹색 라인)**
   - 기본변수의 계산값 (SMA, RSI, MACD 등)

3. **fVal/eVal (주황색)**
   - `fVal`: 고정값 비교 (점선)
   - `eVal`: 외부변수 비교 (라인)

4. **Trg (빨간 역삼각형)**
   - 트리거 발생 지점 마커

### 2가지 차트 타입만 사용
복잡한 카테고리 분류를 단순화:

1. **price_overlay**: 가격 기반 차트 (Price + 지표)
   - SMA, EMA, RSI, MACD 등 모든 지표 통일
   
2. **volume**: 거래량 차트 (Volume 히스토그램)
   - 거래량 관련 비교만 별도 처리

## 📊 차트 카테고리 매핑
기존 복잡한 분류 → 단순화된 분류:
```
기존: price_overlay, oscillator, momentum, volume
신규: price_overlay, volume
```

## 🎨 범례 시스템
- **영문 약어 사용**: 한글 텍스트 깨짐 방지
- **고정 위치**: 우측 상단 (upper right)
- **투명도**: framealpha=0.9
- **컴팩트 디자인**: 1열 배치 (ncol=1)

## 📝 주요 수정 파일

### `simulation_result_widget.py`
1. **`_get_english_label()` 메서드 단순화**
   ```python
   # 기존: 복잡한 한글-영문 매핑
   # 신규: 4요소 기반 단순 매핑 (iVal, eVal, fVal, Volume)
   ```

2. **`_plot_price_overlay_chart()` 메서드 단순화**
   ```python
   # 단순화된 4요소 플롯 (Price + iVal + fVal/eVal + Trg)
   ```

3. **`_plot_volume_chart()` 메서드 단순화**
   ```python
   # 단순화된 4요소 플롯 (Volume + iVal + fVal/eVal + Trg)
   ```

4. **`update_simulation_chart()` 차트 분류 단순화**
   ```python
   # 기존: 4개 케이스 (price_overlay, oscillator, momentum, volume)
   # 신규: 2개 케이스 (price_overlay, volume)
   ```

## 🚀 해결된 문제점

### 1. 한글 텍스트 깨짐
- **원인**: matplotlib에서 한글 폰트 렌더링 문제
- **해결**: 영문 약어 사용 (SMA → iVal, EMA → eVal 등)

### 2. 마커 미표시 문제
- **원인**: 트리거 결과 처리 로직 오류
- **해결**: 통일된 마커 표시 로직 (`marker='v'`, 빨간색)

### 3. SMA > EMA 조합에서 범례 미출력
- **원인**: 복잡한 변수명 매핑으로 인한 라벨 생성 실패
- **해결**: 단순화된 4요소 라벨 시스템

### 4. 데이터 중복 사용 문제
- **원인**: 기본변수와 외부변수가 같은 데이터 사용
- **해결**: 명확한 데이터 분리 및 디버깅 로그 추가

## 🔍 테스트 확인 사항

### 범례 표시 테스트
- [x] Price/Volume 라벨 정상 표시
- [x] iVal (기본변수) 라벨 정상 표시  
- [x] fVal/eVal (비교값/외부변수) 라벨 정상 표시
- [x] Trg (트리거) 마커 정상 표시

### 차트 타입별 테스트
- [x] SMA > EMA: price_overlay 차트로 정상 표시
- [x] RSI > 70: price_overlay 차트로 정상 표시 (기존 오실레이터에서 통합)
- [x] 거래량 > 거래량: volume 차트로 정상 표시
- [x] MACD 기반: price_overlay 차트로 정상 표시

## 📈 성능 개선 효과

### 코드 라인 수 감소
- **`_plot_price_overlay_chart()`**: 60+ 라인 → 40+ 라인
- **차트 카테고리 분류**: 20+ 라인 → 10+ 라인
- **범례 시스템**: 복잡한 조건문 → 단순 4요소 매핑

### 유지보수성 향상
- **통일된 인터페이스**: 모든 차트에서 같은 4요소 사용
- **단순한 로직**: 2가지 차트 타입만 관리
- **명확한 디버깅**: 일관된 로그 메시지

## 🔮 향후 확장 계획

### 1. 내부 변수 약어 활용
현재 `iVal`, `eVal` 대신 실제 내부 변수 약어 사용:
```python
# 예시: SMA(20) → SMA20, EMA(12) → EMA12
```

### 2. 추가 케이스 대응
필요시 다음과 같은 방식으로 확장:
```python
# 예시: 특수한 지표에 대한 케이스 추가
if special_indicator:
    apply_special_logic()
else:
    use_simplified_4_element_system()
```

### 3. 사용자 커스터마이징
- 범례 위치 선택
- 색상 테마 변경
- 마커 스타일 선택

## ✅ 결론

미니차트 단순화를 통해 다음을 달성했습니다:

1. **사용자 경험 개선**: 직관적이고 일관된 차트 표시
2. **기술적 안정성**: 한글 텍스트 깨짐 및 마커 미표시 문제 해결
3. **개발 효율성**: 코드 복잡성 감소 및 유지보수성 향상
4. **확장성**: 향후 추가 기능 구현 시 일관된 패턴 적용 가능

이 단순화된 시스템은 트리거 빌더의 핵심 목적인 "직관적인 트리거 설정 검증"을 효과적으로 지원합니다.
