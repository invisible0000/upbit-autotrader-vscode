# **보안 설계 문서 (Security Design Document)**

## **1\. 개요**

이 문서는 업비트 자동매매 시스템의 보안 아키텍처와 주요 보안 위협, 그리고 이에 대한 대응 방안을 정의합니다. 사용자의 민감한 정보(API 키)와 자산을 안전하게 보호하고, 시스템의 무결성과 가용성을 보장하는 것을 최우선 목표로 합니다.

## **2\. 보안 위협 모델 및 대응 방안**

### **2.1. API 키 탈취 및 오용**

* **위협**: 소스 코드나 운영 서버에서 업비트 API 키(Access Key, Secret Key)가 유출되어 공격자가 사용자의 자산을 무단으로 거래하거나 출금하는 위협.  
* **대응 방안**:  
  1. **환경 변수 사용**: API 키를 소스 코드에 하드코딩하지 않고, .env 파일을 통해 환경 변수로 관리합니다. 이 .env 파일은 Git 저장소에 포함되지 않도록 .gitignore에 반드시 추가해야 합니다.  
     * **관련 코드**: upbit\_auto\_trading/data\_layer/collectors/upbit\_api.py의 \_\_init\_\_ 메서드에서 os.environ.get()을 사용하여 키를 로드합니다.  
  2. **API 키 암호화 (선택적 강화)**: 로컬 환경이나 데이터베이스에 API 키를 저장해야 할 경우, 강력한 암호화 알고리즘을 사용하여 저장합니다.  
     * **관련 코드**: upbit\_auto\_trading/utils.py의 encrypt\_api\_key() 및 decrypt\_api\_key() 함수가 PBKDF2 기반 키 유도와 Fernet 대칭키 암호화를 제공합니다. 사용자는 별도의 마스터 비밀번호를 통해 키를 관리할 수 있습니다.  
  3. **업비트 API 권한 제한**: 업비트에서 API 키를 발급받을 때, 시스템에 필요한 최소한의 권한(주문, 자산 조회)만 부여하고 '출금' 권한은 절대로 부여하지 않도록 사용자에게 강력히 권고합니다. 또한, 특정 IP에서만 접근 가능하도록 IP 주소를 등록하여 사용합니다.

### **2.2. 비인가 접근 및 데이터 위변조**

* **위협**: 공격자가 시스템(특히 웹 UI)에 비인가 접근하여 전략을 변경하거나, 데이터베이스에 직접 접근하여 거래 기록, 포트폴리오 정보 등을 위변조하는 위협.  
* **대응 방안**:  
  1. **사용자 인증 (향후 구현)**: 웹 UI(ui/web/app.py)에는 반드시 사용자 로그인 및 세션 관리 기능을 구현해야 합니다. 비밀번호는 해시(Hash)하여 저장하고, 안전한 세션 관리 정책을 적용합니다.  
  2. **데이터베이스 접근 제어**: 운영 환경의 데이터베이스는 config.yaml에 강력한 비밀번호를 설정하고, 애플리케이션 서버에서만 접근할 수 있도록 네트워크 방화벽을 설정합니다.  
     * **관련 코드**: upbit\_auto\_trading/data\_layer/storage/database\_manager.py  
  3. **API 요청 인증**: 업비트 API와 통신 시, 모든 인증이 필요한 요청은 JWT(JSON Web Token) 기반의 인증 헤더를 생성하여 전송합니다. 이를 통해 요청의 무결성을 보장하고 재전송 공격(Replay Attack)을 방지합니다.  
     * **관련 코드**: upbit\_auto\_trading/data\_layer/collectors/upbit\_api.py의 \_get\_auth\_header() 메서드.

### **2.3. 서비스 거부(DoS) 공격**

* **위협**: 업비트 API에 과도한 요청을 보내 API 키가 일시적 또는 영구적으로 차단되거나, 시스템 자체에 부하를 주어 정상적인 거래 실행을 방해하는 위협.  
* **대응 방안**:  
  1. **API 요청 속도 제어 (Rate Limiting)**: 업비트 API의 요청 제한(초당/분당)을 준수하기 위해 자체적인 요청 속도 제어 로직을 구현합니다.  
     * **관련 코드**: upbit\_auto\_trading/data\_layer/collectors/upbit\_api.py의 \_check\_rate\_limit() 메서드가 threading.RLock을 사용하여 스레드 안전하게 요청 간의 시간 간격을 조절합니다.  
  2. **재시도 로직**: 일시적인 네트워크 오류나 서버 오류 발생 시, 시스템이 즉시 중단되지 않고 지수 백오프(Exponential Backoff)를 적용한 재시도 로직을 통해 안정성을 확보합니다.  
     * **관련 코드**: upbit\_api.py의 \_create\_session()에서 requests.adapters.Retry를 사용하여 구현되어 있습니다.

## **3\. 보안 운영 가이드라인**

1. **최소 권한 원칙**: 시스템을 실행하는 운영체제 사용자 계정은 애플리케이션 실행에 필요한 최소한의 권한만 가져야 합니다.  
2. **정기적인 의존성 검사**: requirements.txt에 명시된 라이브러리들에 대해 정기적으로 보안 취약점을 검사하고, 발견 시 즉시 업데이트합니다. (예: pip-audit, safety 도구 사용)  
3. **보안 로깅 및 감사**: config/logging\_config.yaml 설정을 통해 주요 보안 이벤트(예: API 키 로드 실패, 인증 오류 등)를 별도의 로그 파일에 기록하고, 정기적으로 모니터링하여 비정상적인 활동을 감지해야 합니다.  
4. **정기적인 데이터 백업**: BackupManager를 사용하여 데이터베이스를 정기적으로 백업하고, 백업 파일은 안전한 별도의 저장소에 보관하여 데이터 유실 및 위변조 사고에 대비합니다.  
   * **관련 코드**: upbit\_auto\_trading/data\_layer/storage/backup\_manager.py

## **4\. 사고 대응 계획 (Incident Response)**

1. **탐지**: 비정상적인 거래, API 키 오류, 시스템 로그의 반복적인 에러 등 보안 사고 징후를 모니터링합니다.  
2. **즉시 조치**: 보안 사고가 의심될 경우, 즉시 시스템을 중지(stop\_all\_trading())하고, 업비트 웹사이트에서 해당 API 키를 비활성화하여 추가 피해를 막습니다.  
3. **분석**: 로그 파일과 거래 내역을 분석하여 피해 범위와 공격 원인을 파악합니다.  
4. **복구**: BackupManager를 통해 사고 발생 이전의 안전한 시점으로 데이터베이스를 복구하고, 원인이 된 보안 취약점을 패치합니다.  
5. **사후 조치**: 사고의 원인, 조치 내역, 재발 방지 대책을 문서화하고 팀에 공유합니다.