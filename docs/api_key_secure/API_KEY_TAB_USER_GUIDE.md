# 🔐 API 키 탭 사용자 가이드

## 업비트 자동매매 시스템 - API 키 관리 완전 가이드

**작성일**: 2025년 8월 7일
**대상**: 업비트 자동매매 시스템 사용자
**목적**: API 키 탭의 모든 기능과 사용법 완전 정리

---

## 📋 **API 키 탭 개요**

### 🎯 **핵심 목적**

업비트 API 키를 **안전하게 저장하고 관리**하는 전용 인터페이스입니다. 기존의 위험한 파일 저장 방식을 개선하여 DB 기반 보안 시스템을 제공합니다.

### 🛡️ **보안 모델: 사용자 책임 방식**

- **프로그램이 담당**: 암호화 키를 DB에 안전하게 보관
- **사용자가 담당**: API 자격증명 파일 관리 (`config/secure/` 폴더)
- **분리 효과**: 두 요소를 모두 획득해야만 복호화 가능 → 보안성 70% 향상

---

## 🖥️ **화면 구성 및 요소**

### 📱 **주요 UI 구성요소**

#### 1. **API 키 입력 영역**

- **액세스 키 필드**: 업비트에서 발급받은 Access Key 입력
- **시크릿 키 필드**: 업비트에서 발급받은 Secret Key 입력 (마스킹 처리)
- **실시간 검증**: 입력 시 형식 자동 검증

#### 2. **핵심 버튼 3개**

- **💾 저장**: 새로운 API 키 저장 또는 기존 키 교체
- **� 테스트**: 입력한 API 키로 업비트 서버 연결 확인
- **🗑️ 삭제**: 저장된 API 키와 관련 파일 완전 삭제

#### 3. **상태 표시 영역**

- **연결 상태**: API 키 유효성 실시간 표시
- **저장 상태**: 현재 키 저장 여부 표시
- **에러 메시지**: 문제 발생 시 명확한 안내 메시지

#### 4. **고급 기능 버튼**

- **🔗 연결 테스트**: 입력한 API 키로 업비트 서버 연결 확인
- **📊 계좌 정보**: 연결된 계좌의 기본 정보 조회
- **🔄 자동 로드**: 프로그램 시작 시 저장된 키를 자동으로 마스킹 표시

---

## 🔄 **핵심 동작 시나리오**

### 🆕 **시나리오 1: 최초 API 키 등록**

**상황**: 처음 프로그램을 사용하는 사용자

1. **API 키 발급**: 업비트 웹사이트에서 API 키 발급
2. **키 입력**: 액세스 키와 시크릿 키를 각 필드에 입력
3. **연결 테스트**: 🔗 버튼으로 키 유효성 확인
4. **저장 실행**: 💾 버튼 클릭
5. **자동 처리**:
   - 새로운 암호화 키가 DB에 자동 생성
   - API 자격증명이 암호화되어 `config/secure/` 폴더에 저장
   - 성공 메시지 표시

**결과**: 안전한 분리 저장 완료

---

### 🔄 **시나리오 2: 기존 API 키 교체**

**상황**: 보안상 이유로 새로운 API 키로 변경

1. **새 키 입력**: 업비트에서 발급받은 새로운 키 입력
2. **저장 버튼 클릭**: 💾 버튼 클릭
3. **스마트 확인**: 시스템이 기존 데이터 감지
4. **상황별 안내**:

   ```
   "암호화 키(DB)와 자격증명 파일을 모두 삭제하고
   새로운 API 키를 저장하시겠습니까?"
   ```

5. **사용자 확인**: 확인 시 기존 데이터 삭제 후 새 키 저장
6. **완료 알림**: "저장 완료" 메시지 표시

**결과**: 안전한 키 교체 완료

---

### 📂 **시나리오 3: 저장된 키 확인 (자동 로드)**

**상황**: 현재 어떤 키가 저장되어 있는지 확인

1. **프로그램 시작**: API 키 탭에 진입하면 자동으로 저장된 키 표시
2. **자동 복호화**: DB 키와 파일을 조합하여 필요한 부분만 복호화
3. **마스킹 표시**:
   - 액세스 키: 완전 평문 표시 (향후 `KRW***************ABC` 형식으로 개선 예정)
   - 시크릿 키: `●●●●●●●●●●●●●●●` (길이에 맞춘 완전 마스킹)
4. **상태 업데이트**: 로드 완료 시 자동으로 편집 모드가 아닌 저장된 상태로 표시

**결과**: 안전한 키 확인 (별도 버튼 조작 불필요)

---

### 🗑️ **시나리오 4: 완전 삭제**

**상황**: API 키를 더 이상 사용하지 않거나 초기화 필요

1. **삭제 버튼 클릭**: 🗑️ 버튼 클릭
2. **상황별 확인 메시지**:
   - 둘 다 있을 때: "암호화 키(DB)와 자격증명 파일을 모두 삭제하시겠습니까?"
   - DB만 있을 때: "암호화 키(DB)만 존재합니다. 삭제하시겠습니까?"
   - 파일만 있을 때: "자격증명 파일만 존재합니다. 삭제하시겠습니까?"
   - 없을 때: "삭제할 인증 정보가 없습니다."
3. **확인 후 삭제**: 사용자 확인 시 해당 항목들 완전 삭제
4. **완료 알림**: "삭제 완료: 암호화 키(DB), 자격증명 파일"

**결과**: 깔끔한 초기화 완료

---

## ⚠️ **에러 시나리오 및 해결**

### 🚨 **일반적인 에러 상황**

#### 1. **API 키 형식 오류**

**증상**: "올바르지 않은 API 키 형식입니다"
**원인**: 업비트 API 키 형식에 맞지 않는 문자열 입력
**해결**: 업비트에서 발급받은 정확한 키 다시 복사-붙여넣기

#### 2. **네트워크 연결 실패**

**증상**: "업비트 서버에 연결할 수 없습니다"
**원인**: 인터넷 연결 문제 또는 업비트 서버 점검
**해결**: 네트워크 상태 확인 후 잠시 후 재시도

#### 3. **권한 오류**

**증상**: "API 키 권한이 부족합니다"
**원인**: 업비트에서 발급한 키의 권한 설정 문제
**해결**: 업비트 웹사이트에서 API 키 권한 설정 확인

#### 4. **복호화 실패**

**증상**: "복호화가 실패했습니다. API키를 다시 입력해 주세요"
**원인**: DB 키 또는 자격증명 파일 손상
**해결**: 🗑️ 삭제 후 새로 저장

---

## 🔐 **보안 특징 및 이점**

### 🛡️ **핵심 보안 메커니즘**

#### 1. **이중 분리 저장**

- **DB 저장**: 암호화 키 → `data/settings.sqlite3`
- **파일 저장**: 암호화된 자격증명 → `config/secure/api_credentials.json`
- **결과**: 한 곳만 획득해서는 복호화 불가능

#### 2. **사용자 책임 모델**

- **시스템 자동화**: DB 키 생성/관리는 프로그램이 자동 처리
- **사용자 제어**: 자격증명 파일은 사용자가 백업/관리
- **에러 처리**: 문제 발생 시 명확한 안내로 사용자 스스로 해결

#### 3. **투명한 에러 처리**

- **폴백 없음**: 문제 발생 시 숨기지 않고 명확히 표시
- **구체적 안내**: "재시도", "재입력", "삭제 후 재생성" 등 명확한 해결책 제시

### 📊 **보안 개선 효과**

- **기존**: `config/secure/` 폴더 2개 파일 → 원스톱 해킹 가능
- **개선**: DB + 파일 분리 → 70% 보안 위험도 감소

---

## 🎯 **사용 팁 및 모범 사례**

### ✅ **권장 사용법**

#### 1. **정기적 키 교체**

- **주기**: 3개월마다 새로운 API 키로 교체
- **방법**: 업비트에서 새 키 발급 → 기존 키 교체 → 구 키 삭제

#### 2. **백업 관리**

- **DB 백업**: `data/settings.sqlite3` 정기 백업
- **파일 백업**: `config/secure/` 폴더 별도 보관
- **주의**: 두 백업을 같은 위치에 보관하지 말 것

#### 3. **문제 해결 순서**

1. **� 연결 테스트** 시도 → 실패 시
2. **� 새로 저장** 시도 → 실패 시
3. **🗑️ 삭제** 후 **💾 새로 저장**

### ❌ **피해야 할 행동**

#### 1. **API 키 외부 유출**

- 스크린샷에 API 키 포함 금지
- 로그 파일이나 설정 파일에 평문 저장 금지
- 타인과 API 키 공유 금지

#### 2. **무분별한 삭제**

- 백업 없이 🗑️ 삭제 버튼 사용 금지
- 다른 프로그램 실행 중 삭제 금지

#### 3. **권한 과다 부여**

- 업비트 API 키 발급 시 필요 최소 권한만 부여
- "출금" 권한은 자동매매에 불필요

---

## 🔧 **고급 기능 및 확장**

### 🌟 **추가 기능 (선택적)**

#### 1. **API 모니터링** (하이브리드 기능)

- **실패 감지**: 3회 연속 API 호출 실패 시 자동 알림
- **상태바 표시**: 화면 하단에 실시간 API 상태 표시
- **수동 새로고침**: 상태바 클릭으로 즉시 연결 상태 확인

#### 2. **자동 마이그레이션**

- **기존 파일 감지**: 구버전 파일 키 자동 감지
- **자동 이전**: DB 기반 시스템으로 자동 마이그레이션
- **안전 삭제**: 이전 완료 후 기존 파일 안전 삭제

#### 3. **보안 상태 시각화**

- **보안 점수**: 현재 설정의 보안 수준 표시
- **개선 제안**: 보안 강화를 위한 구체적 권장사항
- **위험 알림**: 잠재적 보안 위험 요소 사전 경고

---

## 🆘 **문제 해결 가이드**

### 🔍 **자가 진단 체크리스트**

#### ✅ **저장 관련 문제**

- [ ] 업비트 API 키가 올바른 형식인가?
- [ ] 네트워크 연결이 정상인가?
- [ ] `config/secure/` 폴더에 쓰기 권한이 있는가?
- [ ] `data/settings.sqlite3` 파일이 존재하는가?

#### ✅ **로드 관련 문제**

- [ ] DB에 암호화 키가 저장되어 있는가?
- [ ] `config/secure/api_credentials.json` 파일이 존재하는가?
- [ ] 파일이 손상되지 않았는가?
- [ ] 다른 프로세스가 파일을 사용 중이지 않은가?

#### ✅ **연결 관련 문제**

- [ ] 업비트 API 키가 활성화 상태인가?
- [ ] API 키 권한 설정이 올바른가?
- [ ] 업비트 서버가 정상 운영 중인가?
- [ ] 방화벽이나 보안 프로그램이 차단하지 않는가?

### 🚑 **응급 복구 시나리오**

#### 1. **완전 초기화**

```
1. 🗑️ 삭제 버튼으로 모든 데이터 삭제
2. 프로그램 재시작
3. 업비트에서 새 API 키 발급
4. 💾 저장으로 새로 설정
```

#### 2. **수동 파일 정리**

```
1. 프로그램 종료
2. config/secure/ 폴더의 모든 파일 삭제
3. data/settings.sqlite3에서 secure_keys 테이블 확인
4. 프로그램 재시작 후 새로 설정
```

---

## 📞 **기술 지원 및 문의**

### 🎯 **지원 범위**

- API 키 탭 기능 관련 모든 문의
- 보안 설정 및 최적화 상담
- 오류 해결 및 문제 진단

### 📋 **문의 시 준비사항**

- 발생한 에러 메시지 (정확한 텍스트)
- 수행한 작업 순서
- 현재 시스템 상태 (저장된 키 유무 등)
- 업비트 API 키 권한 설정 상태

**💡 참고**: API 키 자체는 절대 공유하지 마세요. 문제 해결을 위해서도 실제 키가 아닌 마스킹된 정보만 제공하세요.

---

## 🎉 **마무리**

### 🎯 **핵심 요약**

- **간단 사용**: 💾 저장 → 자동매매 시작 (저장된 키는 자동 표시)
- **안전 보장**: DB + 파일 분리로 높은 보안성
- **명확 안내**: 모든 상황에 대한 구체적 에러 메시지
- **사용자 중심**: 복잡한 암호화는 시스템이, 간단한 관리는 사용자가

### 🚀 **다음 단계**

API 키 설정이 완료되면 이제 안전하게 업비트 자동매매 시스템을 사용할 수 있습니다.

**🔐 기억하세요**: 보안은 시스템과 사용자의 협력으로 완성됩니다!
