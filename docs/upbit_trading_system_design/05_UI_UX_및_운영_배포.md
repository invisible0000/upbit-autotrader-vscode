# 자동 매매 프로그램 개발 기획 v2 - 5부: UI/UX 및 운영/배포

## 1. 개요

5부의 목표는 1~4부에서 설계한 모든 강력한 기능들을 사용자가 쉽고 직관적으로 사용할 수 있도록 하는 **사용자 인터페이스(UI/UX)**를 구체화하고, 완성된 시스템을 안정적으로 **운영하고 배포**하기 위한 방안을 수립하는 것이다.

---

## 2. 최적화 관련 UI 설계

### 2.1. 최적화 설정 UI (`OptimizationSetupWidget`)
사용자가 최적화 작업을 시작하기 전에 모든 조건을 설정하는 화면. '전략 메이커' 화면 내 '최적화' 탭을 통해 접근한다.

*   **UI 구성 요소**:
    1.  **최적화 대상 파라미터 목록**: 현재 전략에 포함된 트리거 중 `is_optimizable: true`로 설정된 파라미터만 테이블 형태로 보여준다. 사용자는 여기서 각 파라미터의 최적화 범위(`start`, `end`, `step`)를 최종 조절할 수 있다.
    2.  **유전 알고리즘 설정**: 세대 수(Generations), 한 세대당 인구 수(Population Size), 교차 확률(Crossover Rate), 변이 확률(Mutation Rate) 등을 설정하는 입력 필드.
    3.  **적합도 함수(Fitness Function) 편집기**: 사용자가 직접 적합도 계산 수식을 입력할 수 있는 텍스트 박스. (예: `0.7 * profit_factor + 0.3 * sharpe_ratio`) 자동 완성 및 유효성 검사 기능을 제공하여 편의성을 높인다.
    4.  **데이터 기간 선택**: 최적화에 사용할 과거 데이터의 시작일과 종료일을 선택하는 캘린더 위젯.

### 2.2. 최적화 모니터링 UI (`OptimizationMonitorWidget`)
최적화 작업이 실행되는 동안 진행 상황을 실시간으로 시각화하여 보여주는 화면.

*   **UI 구성 요소**:
    1.  **진행 상태 표시줄**: 전체 세대 중 현재 몇 번째 세대가 진행 중인지 표시한다.
    2.  **실시간 성능 그래프**: 각 세대가 끝날 때마다 해당 세대의 '최고 적합도 점수'와 '평균 적합도 점수'를 라인 그래프로 시각화한다. 이를 통해 최적화 과정이 잘 수렴하고 있는지 직관적으로 파악할 수 있다.
    3.  **현재까지의 최고 결과**: 현재까지 발견된 가장 좋은 파라미터 조합과 그 때의 성과 지표(수익률, MDD 등)를 실시간으로 업데이트하여 보여준다.
    4.  **제어 버튼**: '일시 중지(Pause)', '재개(Resume)', '강제 종료(Cancel)' 버튼을 제공하여 사용자가 최적화 프로세스를 제어할 수 있게 한다.

### 2.3. 최적화 결과 분석 UI (`OptimizationResultWidget`)
완료된 최적화 작업의 결과를 상세히 분석하고, 최적의 파라미터를 실제 전략에 적용하는 화면.

*   **UI 구성 요소**:
    1.  **결과 요약**: 최종적으로 선택된 최적 파라미터 조합과 핵심 성과 지표를 명확하게 보여준다.
    2.  **성과 시각화**:
        *   **수익 곡선 차트**: 최적 파라미터를 적용했을 때의 누적 수익 곡선을 시각화한다.
        *   **파라미터-성능 관계 히트맵**: 2개 또는 3개의 핵심 파라미터 변화에 따라 적합도 점수가 어떻게 변하는지를 색상으로 표현하는 히트맵 또는 3D 표면 그래프를 제공하여, 파라미터의 민감도를 분석할 수 있게 돕는다.
    3.  **'전략에 적용' 버튼**: 클릭 한 번으로 분석된 최적 파라미터를 현재 '전략 메이커'의 파라미터 값으로 즉시 업데이트한다.

---

## 3. 설치 및 운영

### 3.1. 설치 및 초기 설정
사용자가 프로그램을 처음 설치하고 실행하는 과정을 간단하고 명확하게 만든다.

*   **설치 절차**: `PyInstaller`와 같은 도구를 사용하여 모든 파이썬 의존성을 포함하는 **단일 실행 파일(.exe)** 형태로 프로그램을 배포한다. 사용자는 복잡한 설치 과정 없이 압축을 풀고 바로 실행할 수 있다.
*   **환경 설정 (`.env`)**: 프로그램 실행에 필요한 API 키(ACCESS_KEY, SECRET_KEY)는 소스코드나 DB가 아닌, 프로그램 루트 폴더의 `.env` 파일에 저장하도록 안내한다. 프로그램은 시작 시 이 파일을 읽어 API 키를 로드한다.

### 3.2. 데이터베이스 백업 및 복원
사용자의 소중한 전략과 매매 기록을 안전하게 보호하기 위한 기능.

*   **자동 백업**: 프로그램 종료 시 또는 매일 특정 시간에 `strategies.sqlite3` 파일을 자동으로 백업(`*.bak`)하는 기능을 내장한다.
*   **수동 백업/복원 UI**: 시스템 설정 화면에 '데이터베이스 관리' 탭을 추가하여, 사용자가 원할 때 언제든지 '지금 백업'하거나 '백업에서 복원'할 수 있는 UI를 제공한다. 복원 시에는 데이터 유실 위험을 명확히 경고하고 재확인 절차를 거친다.

### 3.3. 시스템 모니터링 및 알림
시스템이 24시간 안정적으로 동작하는지 확인하고, 문제 발생 시 즉시 대응할 수 있는 체계를 갖춘다.

*   **시스템 로그 뷰어**: 3부에서 설계한 대시보드의 로그 뷰어를 통해 시스템의 모든 동작을 상세히 추적할 수 있게 한다.
*   **외부 알림 시스템 (텔레그램)**: 사용자가 설정에서 텔레그램 봇 토큰과 채팅 ID를 입력하면, 다음과 같은 중요 이벤트 발생 시 실시간으로 알림을 보낸다.
    *   포지션 상태가 `error`로 변경될 때
    *   '전역 포트폴리오 손실 제한'이 발동될 때
    *   API 연결에 연속적으로 실패할 때
    *   프로그램의 심각한 예외(Exception)가 발생했을 때

### 3.4. 프로그램 업데이트 및 데이터 마이그레이션
향후 프로그램 기능 개선 시, 기존 사용자의 데이터를 안전하게 유지하며 업데이트할 수 있는 방안.

*   **스키마 버전 관리**: `settings.sqlite3`의 `table_schemas` 테이블을 이용해 각 테이블의 스키마 버전을 관리한다.
*   **마이그레이션 로직**: 프로그램 시작 시, 현재 스키마 버전과 코드에 정의된 최신 스키마 버전을 비교한다. 버전이 다를 경우, `ALTER TABLE`과 같은 SQL을 실행하여 기존 데이터를 보존하면서 테이블 구조를 변경하는 마이그레이션 스크립트를 자동으로 실행한다.
