# 업비트 자동매매 시스템 통합 청사진 v2.2 - 01: 시스템 개요 및 아키텍처

## 프로젝트 현황 (75% 완료 상태)

### ✅ 완성된 핵심 구조
- **3-Database 고정 아키텍처**: `data/` 폴더 표준 구조 (settings/strategies/market_data.sqlite3)
- **컴포넌트 기반 시스템**: `component_system/` 완전 분리된 트리거/액션/조건 모듈
- **계층별 분리**: data_layer, business_logic, ui 계층 명확한 역할 분담
- **데이터베이스 경로 관리**: `config/database_paths.py` 중앙 집중식 경로 매핑
- **전역 DB 매니저**: `utils/global_db_manager.py` 싱글톤 패턴 연결 관리

### 현재 시스템 구조
```
📁 업비트 자동매매 시스템 구조:
├── 📊 데이터 계층 (data_layer/)
│   ├── collectors/             # 업비트 API 데이터 수집
│   ├── processors/             # 기술적 지표 처리
│   └── storage/               # 백업/복원 관리
├── 🧠 비즈니스 로직 계층 (business_logic/)
│   ├── backtester/            # 백테스팅 엔진 (완료)
│   ├── portfolio/             # 포트폴리오 관리
│   ├── screener/              # 종목 스크리닝
│   └── trader/                # 실시간 거래 엔진
├── 🎯 컴포넌트 시스템 (component_system/)
│   ├── triggers/              # 트리거 컴포넌트
│   ├── actions/               # 액션 컴포넌트  
│   ├── conditions/            # 조건 컴포넌트
│   └── strategies/            # 전략 예시
├── 🖥️ UI 계층 (ui/)
│   ├── desktop/               # PyQt6 데스크톱 UI
│   │   ├── screens/          # 화면별 컴포넌트
│   │   └── common/           # 공통 UI 컴포넌트
│   └── web/                  # 웹 인터페이스 (향후)
├── ⚙️ 설정 및 유틸리티
│   ├── config/               # 데이터베이스 경로, 시스템 설정
│   └── utils/                # 로거, DB 매니저, 공통 유틸리티
└── 📁 data/                  # 데이터베이스 파일 (루트 배치)
    ├── settings.sqlite3      # 시스템 설정 + 거래변수
    ├── strategies.sqlite3    # 사용자 전략 + 실행 데이터
    ├── market_data.sqlite3   # 시장 데이터 + 차트 정보
    └── settings/            # API 키 암호화 폴더
```

## 아키텍처 설계 원칙

### 🎯 핵심 설계 철학
1. **컴포넌트 기반 모듈러 시스템**: 레고 블록처럼 조합 가능한 전략 요소
2. **계층별 역할 분담**: 데이터/비즈니스/UI 계층 간 명확한 책임 경계
3. **중앙 집중식 설정 관리**: 모든 경로와 설정을 config/ 에서 통합 관리
4. **3-Database 분산 저장**: 역할별 데이터 분리로 성능 및 유지보수성 향상
5. **폴백 코드 제거**: 실제 오류를 숨기지 않고 즉시 표면화

### 📊 3-Database 아키텍처 (최종 확정)
```python
# 데이터베이스 역할 분담
SETTINGS_DB = "data/settings.sqlite3"      # 시스템 설정 + 거래변수 정의
STRATEGIES_DB = "data/strategies.sqlite3"   # 사용자 전략 + 실행 데이터  
MARKET_DATA_DB = "data/market_data.sqlite3" # 시장 데이터 + 차트 정보

# 테이블 매핑 (TableMappings 클래스로 중앙 관리)
- cfg_*, tv_*, sys_* → settings.sqlite3    (17개 테이블)
- strategies, trading_conditions → strategies.sqlite3 (16개 테이블)  
- candlestick_*, technical_* → market_data.sqlite3 (20개 테이블)
```

### 🏗️ 컴포넌트 시스템 아키텍처
```python
# 컴포넌트 타입별 분류
COMPONENT_CATALOG = {
    "triggers": {
        "price": [PriceChangeTrigger, PriceBreakoutTrigger, PriceCrossoverTrigger],
        "indicator": [RSITrigger, MACDTrigger, BollingerTrigger],
        "time": [TimeBasedTrigger, MarketOpenTrigger]
    },
    "actions": {
        "trading": [BuyAction, SellAction, PositionManagementAction],
        "alert": [NotificationAction, LogAction]
    },
    "conditions": {
        "risk_management": [BalanceCondition, PositionSizeCondition],
        "profit_loss": [ProfitLossCondition, StopLossCondition],
        "technical": [TechnicalIndicatorCondition, VolumeCondition]
    }
}
```

## 핵심 시스템 통합 현황

### ✅ 완료된 핵심 시스템
1. **백테스팅 엔진** (business_logic/backtester/) - 100% 완료
   - BacktestRunner, BacktestAnalyzer, BacktestResultsManager
   - 단일 코인 및 포트폴리오 백테스트 지원
   - 성과 분석 및 시각화 완료

2. **차트 시각화 시스템** (ui/desktop/screens/) - 90% 완료
   - 캔들스틱 차트, 기술적 지표 오버레이
   - 거래 시점 마커, 확대/축소 기능
   - 다양한 시간대 지원 (1분~1주)

3. **컴포넌트 카탈로그** (component_system/) - 85% 완료
   - 15개 트리거, 8개 액션, 12개 조건 컴포넌트
   - 드래그앤드롭 UI 지원을 위한 메타데이터
   - 피라미딩 전략 예시 구현

4. **데이터베이스 통합 시스템** (config/database_paths.py) - 95% 완료
   - 53개 테이블의 정확한 DB 할당
   - 레거시 호환성 유지하며 점진적 마이그레이션
   - 전역 DB 매니저를 통한 연결 풀링

### 🚧 진행 중인 작업 (25% 남은 개발)
1. **실시간 거래 엔진** (business_logic/trader/) - 개발 진행 중
2. **포트폴리오 관리 시스템** (business_logic/portfolio/) - 기본 구조 완료
3. **종목 스크리너** (business_logic/screener/) - 설계 단계
4. **웹 인터페이스** (ui/web/) - 향후 계획

## 리팩토링 우선순위

### 🎯 Phase 1: 컴포넌트 시스템 완성 (우선순위: 최고)
- **목표**: 현재 85% 완료된 컴포넌트 시스템을 100% 완성
- **작업**: 누락된 컴포넌트 구현, 테스트 코드 작성
- **영향**: 전체 전략 시스템의 기반이 되는 핵심 인프라

### 🎯 Phase 2: 실시간 거래 엔진 완성 (우선순위: 높음)  
- **목표**: 업비트 API 연동 실시간 거래 시스템 구현
- **작업**: 주문 실행, 리스크 관리, 포지션 추적
- **영향**: 시스템의 최종 목표인 자동매매 실현

### 🎯 Phase 3: UI/UX 개선 (우선순위: 중간)
- **목표**: 사용자 친화적 인터페이스 완성  
- **작업**: 전략 빌더 UI, 모니터링 대시보드 개선
- **영향**: 사용자 경험 및 접근성 향상

## ⚠️ 중요 고정 사항 (변경 금지)

### 📁 데이터베이스 경로 구조
```
# 배포용 최종 구조 (절대 변경 금지)
data/
├── settings.sqlite3      # 시스템 설정 + 거래변수
├── strategies.sqlite3    # 사용자 전략 + 실행 데이터
├── market_data.sqlite3   # 시장 데이터 + 차트 정보
└── settings/            # API 키 암호화 폴더
```

### 🔧 코드 네이밍 컨벤션
- **접두사 시스템**: cfg_ (설정), tv_ (거래변수), sys_ (시스템)
- **모듈 네이밍**: 소문자_언더스코어 (snake_case)
- **클래스 네이밍**: 파스칼케이스 (PascalCase)
- **컴포넌트 타입**: Trigger, Action, Condition 접미사 필수

### 🚫 레거시 코드 처리 방침
- **즉시 제거 대상**: 폴백 코드 (try...except ImportError with dummy class)
- **점진적 마이그레이션**: 기존 데이터베이스 경로 참조
- **레거시 보관**: 기능 완성 후 `_legacy` 접미사로 이동

## 다음 단계 실행 계획

### 📅 1주차: 컴포넌트 시스템 완성
- [ ] 누락된 트리거/액션/조건 컴포넌트 구현
- [ ] 컴포넌트별 단위 테스트 작성  
- [ ] 통합 테스트 및 검증

### 📅 2주차: 실시간 거래 엔진 개발
- [ ] 업비트 API 클라이언트 고도화
- [ ] 주문 실행 및 모니터링 시스템
- [ ] 리스크 관리 및 안전장치

### 📅 3주차: 시스템 통합 및 최적화
- [ ] 전체 시스템 통합 테스트
- [ ] 성능 최적화 및 메모리 관리
- [ ] 사용자 문서화 및 가이드 작성

이 아키텍처는 현재 개발된 코드 기반으로 최적화되었으며, 향후 확장성과 유지보수성을 고려한 설계입니다.
