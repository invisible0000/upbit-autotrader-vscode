# ğŸ› ï¸ ë„ë©”ì¸ ì„œë¹„ìŠ¤ êµ¬í˜„ ì‹¤ë¬´ ê²½í—˜

> **ëª©ì **: TASK-20250803-02 ì‹¤ì œ êµ¬í˜„ ê³¼ì •ê³¼ ê²½í—˜ ê³µìœ   
> **ëŒ€ìƒ**: ì¤‘ê¸‰ ê°œë°œì, DDD ì‹¤ë¬´ì  
> **ê°±ì‹ **: 2025-08-04

## ğŸ“Š í”„ë¡œì íŠ¸ ê°œìš”

### êµ¬í˜„ ëª©í‘œ
- UIì— ë¶„ì‚°ëœ í˜¸í™˜ì„± ê²€ì¦ ë¡œì§ì„ ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¡œ ì¤‘ì•™í™”
- ê¸°ì¡´ íŠ¸ë¦¬ê±° í‰ê°€ ì‹œìŠ¤í…œê³¼ ìƒˆë¡œìš´ ë„ë©”ì¸ ëª¨ë¸ í†µí•©
- DDD ì•„í‚¤í…ì²˜ ì™„ì„±: ì—”í‹°í‹° â†’ ì„œë¹„ìŠ¤ ìœ„ì„ íŒ¨í„´

### ìµœì¢… ì„±ê³¼
- **ë„ë©”ì¸ ì„œë¹„ìŠ¤**: 3ê°œ êµ¬í˜„ (í˜¸í™˜ì„±, í‰ê°€, ì •ê·œí™”)
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: 63ê°œ (100% í†µê³¼)
- **êµ¬í˜„ ì‹œê°„**: 3ì¼ (ì„¤ê³„ 1ì¼, êµ¬í˜„ 1ì¼, í…ŒìŠ¤íŠ¸ 1ì¼)

## ğŸ¯ í•µì‹¬ êµ¬í˜„ ê²°ì •ë“¤

### ê²°ì • 1: í˜¸í™˜ì„± ì„œë¹„ìŠ¤ ì„¤ê³„
```python
# ë¬¸ì œ: UIì— ë¶„ì‚°ëœ í˜¸í™˜ì„± ê²€ì¦ ë¡œì§
# ê¸°ì¡´: compatibility_validator.py (752ì¤„) - UI + DB ê²°í•©

# í•´ê²°: ìˆœìˆ˜ ë„ë©”ì¸ ì„œë¹„ìŠ¤
class StrategyCompatibilityService:
    def check_variable_compatibility(self, existing_vars, new_var):
        # 3ë‹¨ê³„ í˜¸í™˜ì„± ê²€ì¦
        # 1. ê°™ì€ ê·¸ë£¹ â†’ COMPATIBLE
        # 2. ì •ê·œí™” ê°€ëŠ¥ â†’ WARNING  
        # 3. ì™„ì „ ë¹„í˜¸í™˜ â†’ INCOMPATIBLE
```

**ì™œ ì´ë ‡ê²Œ í–ˆëŠ”ê°€?**
- UI ê³„ì¸µì— 752ì¤„ì˜ ë³µì¡í•œ ê²€ì¦ ë¡œì§ì´ DBì™€ ê°•ê²°í•©
- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ì—¬ëŸ¬ UI ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µ ë¶„ì‚°
- í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ êµ¬ì¡°

**ê²°ê³¼**:
- 310ì¤„ì˜ ìˆœìˆ˜ ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¡œ ì••ì¶•
- 21ê°œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ ì™„ì „ ê²€ì¦
- UIì—ì„œ ê°„ë‹¨í•œ ì„œë¹„ìŠ¤ í˜¸ì¶œë¡œ ë³€ê²½

### ê²°ì • 2: ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í†µí•© ë°©ì‹
```python
# ë¬¸ì œ: DataFrame ê¸°ë°˜ ê¸°ì¡´ ì‹œìŠ¤í…œ vs ìƒˆë¡œìš´ ë„ë©”ì¸ ëª¨ë¸

# í•´ê²°: ì–´ëŒ‘í„° íŒ¨í„´ í™œìš©
class TriggerEvaluationService:
    def evaluate_trigger(self, trigger: Trigger, market_data: MarketData):
        try:
            # ê¸°ì¡´ ë¡œì§ ì¬í™œìš©
            df_data = market_data.to_dataframe()
            legacy_result = trigger.evaluate(df_data)
            
            # ìƒˆë¡œìš´ ë„ë©”ì¸ ëª¨ë¸ë¡œ ë³€í™˜
            return EvaluationResult.from_legacy(legacy_result)
        except Exception as e:
            return EvaluationResult.error(f"í‰ê°€ ì‹¤íŒ¨: {e}")
```

**ì™œ ì´ë ‡ê²Œ í–ˆëŠ”ê°€?**
- ê¸°ì¡´ `Trigger.evaluate()` ë©”ì„œë“œê°€ ì˜ ì‘ë™í•¨
- ì „ì²´ ì‹œìŠ¤í…œì„ í•œ ë²ˆì— ë°”ê¾¸ê¸°ì—ëŠ” ë¦¬ìŠ¤í¬ í¼
- ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”

**ê²°ê³¼**:
- ê¸°ì¡´ ì‹œìŠ¤í…œ ë™ì‘ 100% ìœ ì§€
- ìƒˆë¡œìš´ ë„ë©”ì¸ ëª¨ë¸ ì ì§„ì  ë„ì…
- 12ê°œ í…ŒìŠ¤íŠ¸ë¡œ í˜¸í™˜ì„± ê²€ì¦

### ê²°ì • 3: Strategy íŒ¨í„´ìœ¼ë¡œ ì •ê·œí™” êµ¬í˜„
```python
# ë¬¸ì œ: ë‹¤ì–‘í•œ ì •ê·œí™” ì•Œê³ ë¦¬ì¦˜ ì§€ì› í•„ìš”

# í•´ê²°: Strategy íŒ¨í„´
class NormalizationService:
    def __init__(self):
        self._strategies = {
            NormalizationMethod.MIN_MAX: MinMaxStrategy(),
            NormalizationMethod.Z_SCORE: ZScoreStrategy(),
            NormalizationMethod.ROBUST: RobustStrategy()
        }
    
    def normalize(self, data, method):
        strategy = self._strategies[method]
        return strategy.normalize(data)
```

**ì™œ ì´ë ‡ê²Œ í–ˆëŠ”ê°€?**
- MinMax, Z-Score, Robust ë“± ë‹¤ì–‘í•œ ì •ê·œí™” ë°©ë²• í•„ìš”
- í–¥í›„ ìƒˆë¡œìš´ ì •ê·œí™” ë°©ë²• ì¶”ê°€ ì˜ˆì •
- ê° ì•Œê³ ë¦¬ì¦˜ì˜ ë…ë¦½ì  í…ŒìŠ¤íŠ¸ í•„ìš”

**ê²°ê³¼**:
- í™•ì¥ ê°€ëŠ¥í•œ ì •ê·œí™” ì‹œìŠ¤í…œ
- 23ê°œ í…ŒìŠ¤íŠ¸ë¡œ ê° ì•Œê³ ë¦¬ì¦˜ ê²€ì¦
- ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚° ê¸°ëŠ¥ ì¶”ê°€

## ğŸ”§ ì‹¤ë¬´ êµ¬í˜„ ê³¼ì •

### Phase 1: ë¶„ì„ ë° ì„¤ê³„ (1ì¼)
```
1. ê¸°ì¡´ ì½”ë“œ ë¶„ì„
   - compatibility_validator.py (752ì¤„) ë¶„ì„
   - í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì¶”ì¶œ
   - UIì™€ DB ê²°í•©ë„ íŒŒì•…

2. ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„
   - CompatibilityResult Value Object
   - TradingVariable ì—”í‹°í‹° í™œìš© ë°©ì•ˆ
   - ì„œë¹„ìŠ¤ ê°„ í˜‘ë ¥ êµ¬ì¡° ì„¤ê³„

3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ ìˆ˜ë¦½
   - ê¸°ì¡´ ì‹œìŠ¤í…œ í˜¸í™˜ì„± ìœ ì§€
   - ì ì§„ì  ì „í™˜ ê³„íš
```

### Phase 2: í•µì‹¬ êµ¬í˜„ (1ì¼)
```
1. í˜¸í™˜ì„± ì„œë¹„ìŠ¤ êµ¬í˜„
   - StrategyCompatibilityService (310ì¤„)
   - ComparisonGroupRules Value Object
   - 3ë‹¨ê³„ í˜¸í™˜ì„± ê²€ì¦ ë¡œì§

2. íŠ¸ë¦¬ê±° í‰ê°€ ì„œë¹„ìŠ¤ êµ¬í˜„
   - TriggerEvaluationService (331ì¤„)
   - MarketData/EvaluationResult Value Objects
   - BusinessLogicAdapter (289ì¤„)

3. ì •ê·œí™” ì„œë¹„ìŠ¤ êµ¬í˜„
   - NormalizationService (400+ ì¤„)
   - Strategy íŒ¨í„´ ì ìš©
   - 3ê°€ì§€ ì •ê·œí™” ì•Œê³ ë¦¬ì¦˜
```

### Phase 3: í…ŒìŠ¤íŠ¸ ë° í†µí•© (1ì¼)
```
1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ êµ¬í˜„
   - í˜¸í™˜ì„± ì„œë¹„ìŠ¤: 21ê°œ í…ŒìŠ¤íŠ¸
   - íŠ¸ë¦¬ê±° í‰ê°€: 12ê°œ í…ŒìŠ¤íŠ¸
   - ì •ê·œí™” ì„œë¹„ìŠ¤: 23ê°œ í…ŒìŠ¤íŠ¸

2. ì—”í‹°í‹°-ì„œë¹„ìŠ¤ í†µí•©
   - Strategy.check_trigger_compatibility() ì¶”ê°€
   - Trigger.evaluate() ì„œë¹„ìŠ¤ ìœ„ì„
   - 7ê°œ í†µí•© í…ŒìŠ¤íŠ¸

3. ì „ì²´ ê²€ì¦
   - 63ê°œ í…ŒìŠ¤íŠ¸ 100% í†µê³¼
   - ê¸°ì¡´ ì‹œìŠ¤í…œ í˜¸í™˜ì„± í™•ì¸
```

## ğŸ’¡ í•µì‹¬ í•™ìŠµ í¬ì¸íŠ¸

### ì„±ê³µ ìš”ì¸
1. **ê¸°ì¡´ ì½”ë“œ ë¶„ì„ ìš°ì„ **: ìƒˆë¡œ ë§Œë“¤ê¸° ì „ì— ê¸°ì¡´ ë¡œì§ ì™„ì „ ì´í•´
2. **ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜**: ì–´ëŒ‘í„° íŒ¨í„´ìœ¼ë¡œ í˜¸í™˜ì„± ìœ ì§€
3. **Value Object í™œìš©**: ë³µì¡í•œ ë°ì´í„°ë¥¼ ëª…í™•í•œ íƒ€ì…ìœ¼ë¡œ ê´€ë¦¬
4. **í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ**: ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€

### í”¼í•´ì•¼ í•  ì‹¤ìˆ˜ë“¤
1. **ê³¼ë„í•œ ì„œë¹„ìŠ¤í™”**: ëª¨ë“  ë¡œì§ì„ ì„œë¹„ìŠ¤ë¡œ ë§Œë“¤ë ¤ëŠ” ìš•êµ¬
2. **ìƒíƒœ ê´€ë¦¬**: ë„ë©”ì¸ ì„œë¹„ìŠ¤ì— ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ ì¶”ê°€
3. **ê¸°ìˆ ì  ê´€ì‹¬ì‚¬**: DBë‚˜ UI ë¡œì§ì„ ì„œë¹„ìŠ¤ì— í¬í•¨
4. **ì˜ì¡´ì„± ê³¼ë‹¤**: ë„ˆë¬´ ë§ì€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì˜ì¡´

## ğŸš¨ í•´ê²°í•œ ì‹¤ì œ ë¬¸ì œë“¤

### ë¬¸ì œ 1: í˜¸í™˜ì„± ê²€ì¦ ë¡œì§ ë¶„ì‚°
**ìƒí™©**: RSI + ê°€ê²© ì¡°í•© ì‹œ ì‚¬ìš©ì í˜¼ë€, UI ê³³ê³³ì— ì¤‘ë³µ ê²€ì¦ ë¡œì§

**í•´ê²°**:
```python
# Before: UIì— ë¶„ì‚°ëœ ë¡œì§
if variable.comparison_group == "percentage_comparable":
    # ì—¬ëŸ¬ UI ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µ

# After: ì¤‘ì•™í™”ëœ ì„œë¹„ìŠ¤
result = compatibility_service.check_variable_compatibility(existing, new)
if result.level == CompatibilityLevel.WARNING:
    show_normalization_dialog(result.message)
```

### ë¬¸ì œ 2: DataFrame vs ë„ë©”ì¸ ëª¨ë¸ ì¶©ëŒ
**ìƒí™©**: ê¸°ì¡´ DataFrame ê¸°ë°˜ ì‹œìŠ¤í…œê³¼ ìƒˆë¡œìš´ ë„ë©”ì¸ ëª¨ë¸ ë¶ˆì¼ì¹˜

**í•´ê²°**:
```python
# ì–´ëŒ‘í„° íŒ¨í„´ìœ¼ë¡œ ë¸Œë¦¿ì§€
class BusinessLogicAdapter:
    def dataframe_to_market_data(self, df: pd.DataFrame) -> MarketData:
        return MarketData(
            symbol=df.attrs.get('symbol', 'UNKNOWN'),
            timestamp=df.index[-1],
            close=df['close'].iloc[-1],
            indicators=self._extract_indicators(df)
        )
```

### ë¬¸ì œ 3: í…ŒìŠ¤íŠ¸ ë³µì¡ì„±
**ìƒí™©**: UIì™€ ê²°í•©ëœ ë¡œì§ì€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ì›€

**í•´ê²°**:
```python
# ìˆœìˆ˜ ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸ ìš©ì´
def test_compatible_variables_same_group():
    service = StrategyCompatibilityService()
    rsi = TradingVariable("RSI", "momentum", "percentage_comparable")
    stochastic = TradingVariable("Stochastic", "momentum", "percentage_comparable")
    
    result = service.check_variable_compatibility([rsi], stochastic)
    assert result.level == CompatibilityLevel.COMPATIBLE
```

## ğŸ“ˆ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜

### ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- **í˜¼ë€ í•´ì†Œ**: ë³€ìˆ˜ ì¡°í•© ì‹œ ëª…í™•í•œ ì•ˆë‚´
- **ì‹¤ì‹œê°„ ê²€ì¦**: UIì—ì„œ ì¦‰ì‹œ í˜¸í™˜ì„± í™•ì¸
- **ì¼ê´€ì„±**: ëª¨ë“  ê³³ì—ì„œ ë™ì¼í•œ ê²€ì¦ ê·œì¹™

### ê°œë°œ ìƒì‚°ì„± í–¥ìƒ
- **ì½”ë“œ ì¬ì‚¬ìš©**: 63ê°œ í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦ëœ ì•ˆì •ì  ì„œë¹„ìŠ¤
- **ìœ ì§€ë³´ìˆ˜ì„±**: ì¤‘ì•™í™”ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë³€ìˆ˜ë‚˜ ê·œì¹™ ì¶”ê°€ ìš©ì´

### ì‹œìŠ¤í…œ í’ˆì§ˆ í–¥ìƒ
- **ì•ˆì •ì„±**: 100% í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
- **ì„±ëŠ¥**: ì¤‘ë³µ ê³„ì‚° ì œê±°
- **ì¼ê´€ì„±**: ë„ë©”ì¸ ê·œì¹™ì˜ ë‹¨ì¼ ì†ŒìŠ¤

---

**ğŸ¯ í•µì‹¬ ë©”ì‹œì§€**: ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹¨ìˆœí™”í•˜ê³  ì¤‘ì•™í™”í•˜ëŠ” ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤!

**ğŸ” ë‹¤ìŒ ì½ì„ ê²ƒ**: [êµ¬í˜„ ê°€ì´ë“œ](./02_implementation_guide.md)ì—ì„œ ì‹¤ì œ ì½”ë“œ ì‘ì„± ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.
