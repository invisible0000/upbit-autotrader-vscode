# 어디에 무엇을 만들까? - 빠른 판단 가이드

## 🎯 목적

새 기능을 구현할 때 **"이걸 어느 폴더에 만들어야 하지?"를 3분 안에 판단**하기

---

## 🧭 빠른 의사결정 플로우차트

```
시작: "이 기능을 구현하고 싶다!"
  ↓
┌─────────────────────────────────────┐
│ 1단계: 이 기능이 화면에 보이나요?    │
└─────────────────────────────────────┘
  ↓ YES                    ↓ NO
  ↓                        ↓
[presentation/ 또는 ui/]  2단계로
  ↓
  완료!

┌─────────────────────────────────────────────┐
│ 2단계: 업비트 API나 DB와 직접 통신하나요?    │
└─────────────────────────────────────────────┘
  ↓ YES                    ↓ NO
  ↓                        ↓
[infrastructure/]         3단계로
  ↓
  완료!

┌─────────────────────────────────────┐
│ 3단계: 비즈니스 규칙/계산인가요?    │
│ (learning/L00_비즈니스_로직이란.md 참고) │
└─────────────────────────────────────┘
  ↓ YES                    ↓ NO
  ↓                        ↓
[domain/]                 4단계로
  ↓
  완료!

┌─────────────────────────────────────┐
│ 4단계: 여러 기능을 조합/조율하나요?  │
└─────────────────────────────────────┘
  ↓ YES                    ↓ NO
  ↓                        ↓
[application/]           다시 생각해보기
  ↓
  완료!
```

---

## 📂 현재 프로젝트 폴더 맵

### 전체 구조 한눈에 보기

```
upbit_auto_trading/
│
├── 🌐 infrastructure/         "외부 세계와의 연결"
│   ├── external_apis/         → 업비트 API 호출
│   ├── database/              → DB 저장/읽기
│   ├── logging/               → 로그 기록
│   └── config/                → 설정 파일 읽기
│
├── 💎 domain/                 "핵심 비즈니스 규칙"
│   ├── entities/              → 전략, 주문, 포지션
│   ├── value_objects/         → 가격, 수량, 시간프레임
│   ├── services/              → 계산 로직
│   └── exceptions/            → 도메인 에러 정의
│
├── 🎬 application/            "시나리오 조율"
│   ├── use_cases/             → "전략 생성하기", "주문 실행하기"
│   ├── services/              → 여러 기능 조합
│   └── dto/                   → 레이어 간 데이터 전달
│
├── 🖥️ presentation/           "화면 로직"
│   ├── presenters/            → UI 로직 (비즈니스 로직 없음)
│   └── view_models/           → 화면 표시용 데이터
│
└── 🎨 ui/                     "순수 화면 구성"
    └── desktop/
        ├── common/            → 공통 위젯, 스타일
        └── views/             → 화면별 PyQt6 파일
```

---

## 🔍 레이어별 상세 가이드

### 🌐 Infrastructure - "외부 세계와의 연결"

#### 언제 여기에 만들까?

다음 키워드가 포함되면:

- "업비트 API에서 ~을 가져오기"
- "DB에 ~을 저장하기"
- "파일을 읽고 쓰기"
- "로그를 기록하기"
- "WebSocket으로 실시간 ~"

#### 실제 경로와 예시

```
infrastructure/
│
├── external_apis/upbit/
│   ├── upbit_public_client.py       # 공개 데이터 조회
│   │   예: get_ticker(), get_orderbook()
│   │
│   ├── upbit_private_client.py      # 인증 필요 데이터
│   │   예: get_accounts(), place_order()
│   │
│   ├── upbit_websocket_client.py    # 실시간 구독
│   │   예: subscribe_ticker(), subscribe_orderbook()
│   │
│   └── upbit_rate_limiter.py        # API 제한 관리
│
├── database/
│   ├── repositories/
│   │   ├── settings_repository.py    # settings.sqlite3
│   │   ├── strategies_repository.py  # strategies.sqlite3
│   │   └── market_data_repository.py # market_data.sqlite3
│   │
│   └── connection_manager.py         # DB 연결 관리
│
├── logging/
│   └── component_logger.py           # 컴포넌트별 로깅
│
└── config/
    └── yaml_loader.py                # YAML 설정 읽기
```

#### 실전 예시

**요구사항:** "업비트에서 BTC 호가창 데이터를 가져오고 싶어요"

**판단:**

- "업비트에서 가져오기" → 외부 API 통신 ✅
- Infrastructure 레이어

**위치:**

```
infrastructure/external_apis/upbit/upbit_public_client.py
```

**요청 템플릿:**

```
upbit_public_client.py에 호가창 조회 메서드를 추가하고 싶습니다.

📍 위치: upbit_auto_trading/infrastructure/external_apis/upbit/upbit_public_client.py
🎯 목적: 특정 코인의 호가창 데이터 조회

📋 요구사항:
1. get_orderbook(symbol: str) 메서드 추가
2. 업비트 API /v1/orderbook 엔드포인트 호출
3. 매수/매도 호가 15단계 조회
4. OrderbookData 모델로 반환

✅ 제약사항:
- rate_limiter 통과 필수
- Infrastructure 로깅 사용
- 에러 처리 (네트워크, 타임아웃)
```

---

### 💎 Domain - "핵심 비즈니스 규칙"

#### 언제 여기에 만들까?

다음 질문에 YES면:

- "이것은 거래 규칙인가?" (언제 사고 팔 것인가?)
- "이것은 계산식인가?" (수익률, RSI 계산)
- "이것은 검증 규칙인가?" (이 주문이 유효한가?)
- "이것은 상태 판단인가?" (지금 과매수인가?)

**중요:** Domain은 외부 의존성 없음 (sqlite3, requests, PyQt6 import 금지)

#### 실제 경로와 예시

```
domain/
│
├── entities/                    # 핵심 개념 정의
│   ├── strategy.py              # 전략 엔티티
│   │   예: 7규칙 전략, 진입/청산 조건
│   │
│   ├── order.py                 # 주문 엔티티
│   │   예: 시장가/지정가, 매수/매도
│   │
│   └── position.py              # 포지션 엔티티
│       예: 평균 매수가, 보유 수량
│
├── value_objects/               # 불변 값 객체
│   ├── price.py                 # 가격 (Decimal 타입)
│   ├── quantity.py              # 수량 (정밀도 관리)
│   ├── timeframe.py             # 1m, 5m, 15m, 1h, 1d
│   └── symbol.py                # KRW-BTC, KRW-ETH
│
├── services/                    # 도메인 서비스 (계산 로직)
│   ├── indicator_calculator.py  # RSI, 이평선, 볼린저밴드
│   ├── profit_calculator.py     # 수익률, 손익 계산
│   ├── risk_manager.py          # 리스크 관리 규칙
│   └── strategy_validator.py    # 전략 검증
│
└── exceptions/                  # 도메인 예외
    ├── validation_error.py      # 검증 실패
    └── business_rule_error.py   # 비즈니스 규칙 위반
```

#### 실전 예시

**요구사항:** "RSI가 30 이하면 과매도, 70 이상이면 과매수로 판단하는 로직이 필요해요"

**판단:**

- "판단 규칙" → 비즈니스 로직 ✅
- "계산이나 외부 연결 없음" → Domain 레이어
- "외부 의존성 없음" → 순수 규칙

**위치:**

```
domain/services/indicator_validator.py
```

**요청 템플릿:**

```
RSI 기반 과매수/과매도 판단 로직을 구현하고 싶습니다.

📍 위치: upbit_auto_trading/domain/services/indicator_validator.py
🎯 목적: RSI 값으로 시장 상태 판단

📋 요구사항:
1. evaluate_rsi_status(rsi: Decimal) 메서드 추가
2. RSI > 70 → MarketStatus.OVERBOUGHT
3. RSI < 30 → MarketStatus.OVERSOLD
4. 그 외 → MarketStatus.NEUTRAL
5. MarketStatus enum 정의 (domain/value_objects/)

✅ 제약사항:
- Domain 레이어 - 외부 의존성 없음
- 순수 계산 로직만
- 타입 힌트 명확히
```

---

### 🎬 Application - "시나리오 조율"

#### 언제 여기에 만들까?

다음 키워드가 포함되면:

- "사용자가 ~을 하면..." (사용자 시나리오)
- "여러 기능을 조합해서..." (조율)
- "먼저 ~하고, 그다음 ~하고..." (흐름)
- "~UseCase", "~Service"

#### 실제 경로와 예시

```
application/
│
├── use_cases/                   # 사용자 시나리오
│   ├── create_strategy.py       # "전략 생성하기"
│   │   흐름: 검증 → 저장 → 알림
│   │
│   ├── execute_order.py         # "주문 실행하기"
│   │   흐름: 검증 → API 호출 → 기록
│   │
│   └── get_candle_data.py       # "캔들 데이터 조회하기"
│       흐름: DB 조회 → 도메인 변환 → 반환
│
├── services/                    # 여러 기능 조합
│   ├── strategy_service.py      # 전략 관련 조합 로직
│   └── market_data_service.py   # 시장 데이터 처리
│
└── dto/                         # Data Transfer Object
    ├── strategy_dto.py          # 레이어 간 전략 데이터
    └── order_dto.py             # 레이어 간 주문 데이터
```

#### 실전 예시

**요구사항:** "사용자가 '전략 저장' 버튼을 누르면 전략을 검증하고 DB에 저장하고 싶어요"

**판단:**

- "사용자가 ~하면" → 시나리오 ✅
- "검증 → 저장" → 여러 단계 조율 ✅
- Application 레이어

**위치:**

```
application/use_cases/create_strategy.py
```

**요청 템플릿:**

```
전략 생성 UseCase를 구현하고 싶습니다.

📍 위치: upbit_auto_trading/application/use_cases/create_strategy.py
🎯 목적: 사용자 전략 생성 시나리오 구현

📋 요구사항:
1. CreateStrategyUseCase 클래스 생성
2. execute(strategy_dto: StrategyDTO) 메서드
3. 흐름:
   - domain/services/strategy_validator.py로 검증
   - infrastructure/repositories/strategies_repository.py로 저장
   - 성공 시 전략 ID 반환
4. 에러 처리 (검증 실패, DB 저장 실패)

🔗 연관 파일:
- domain/services/strategy_validator.py: 검증 로직
- infrastructure/repositories/strategies_repository.py: 저장 로직
- application/dto/strategy_dto.py: 데이터 전달

✅ 제약사항:
- UseCase는 조율만, 비즈니스 로직은 Domain에
- Infrastructure 로깅 사용
- dry_run=True 기본값
```

---

### 🖥️ Presentation - "화면 로직"

#### 언제 여기에 만들까?

다음 키워드가 포함되면:

- "버튼 클릭하면 ~" (UI 이벤트)
- "테이블에 데이터 표시" (화면 갱신)
- "다이얼로그 띄우기" (UI 제어)
- "화면 상태 관리"

**중요:** MVP 패턴 - Presenter는 비즈니스 로직 없음, View는 Passive

#### 실제 경로와 예시

```
presentation/
│
├── presenters/                  # UI 로직 (비즈니스 로직 없음)
│   ├── strategy_list_presenter.py
│   │   역할: 전략 목록 조회 → View 갱신
│   │
│   ├── chart_view_presenter.py
│   │   역할: 차트 데이터 준비 → View 렌더링
│   │
│   └── order_dialog_presenter.py
│       역할: 주문 입력 검증 → UseCase 호출
│
└── view_models/                 # 화면 표시용 데이터
    └── strategy_view_model.py   # 전략 → UI 표시 형식 변환
```

#### 실전 예시

**요구사항:** "전략 목록 화면에서 전략을 선택하면 상세 정보를 표시하고 싶어요"

**판단:**

- "화면에서 선택" → UI 이벤트 ✅
- "상세 정보 표시" → 화면 갱신 ✅
- Presentation 레이어

**위치:**

```
presentation/presenters/strategy_list_presenter.py
```

**요청 템플릿:**

```
전략 목록 Presenter를 구현하고 싶습니다.

📍 위치: upbit_auto_trading/presentation/presenters/strategy_list_presenter.py
🎯 목적: 전략 목록 화면 로직 처리

📋 요구사항:
1. StrategyListPresenter 클래스 생성
2. on_strategy_selected(strategy_id: int) 메서드
3. 흐름:
   - application/use_cases/get_strategy_detail.py 호출
   - 결과를 view_model로 변환
   - self.view.display_strategy_detail(view_model) 호출
4. 에러 처리 (전략 없음, 조회 실패)

🔗 연관 파일:
- application/use_cases/get_strategy_detail.py: 전략 조회
- presentation/view_models/strategy_view_model.py: UI 표시 변환
- ui/desktop/views/strategy_list_view.py: 실제 화면

✅ 제약사항:
- MVP 패턴 준수 (Presenter는 조율만)
- 비즈니스 로직은 Domain/Application에 위임
- View는 Passive (Presenter가 제어)
```

---

### 🎨 UI - "순수 화면 구성"

#### 언제 여기에 만들까?

다음 키워드가 포함되면:

- "버튼 배치" (레이아웃)
- "테이블 디자인" (위젯 구성)
- "차트 그리기" (시각화)
- "재사용 위젯 만들기"

**중요:** 로직 없음, PyQt6 위젯 조립만

#### 실제 경로와 예시

```
ui/desktop/
│
├── common/                      # 공통 요소
│   ├── styles/                  # QSS 전역 스타일
│   │   ├── dark_theme.qss
│   │   └── light_theme.qss
│   │
│   ├── widgets/                 # 재사용 위젯
│   │   ├── custom_button.py
│   │   ├── custom_table.py
│   │   └── custom_chart.py
│   │
│   └── theme_notifier.py        # 테마 변경 알림
│
└── views/                       # 화면별 UI
    ├── main_window.py           # 메인 창
    ├── strategy_list_view.py    # 전략 목록 화면
    ├── chart_view.py            # 차트 화면
    └── order_dialog.py          # 주문 다이얼로그
```

#### 실전 예시

**요구사항:** "코인 선택 콤보박스와 차트를 나란히 배치하는 화면을 만들고 싶어요"

**판단:**

- "배치" → 레이아웃 ✅
- "화면 구성" → UI 조립 ✅
- UI 레이어

**위치:**

```
ui/desktop/views/chart_view.py
```

**요청 템플릿:**

```
차트 화면 View를 구현하고 싶습니다.

📍 위치: upbit_auto_trading/ui/desktop/views/chart_view.py
🎯 목적: 코인 차트 화면 UI 구성

📋 요구사항:
1. ChartView 클래스 (QWidget 상속)
2. 상단: 코인 선택 QComboBox + 타임프레임 버튼들
3. 중앙: matplotlib 차트 (MplCanvas)
4. QVBoxLayout으로 수직 배치
5. objectName 지정 (스타일 적용용)

🔗 연관 파일:
- presentation/presenters/chart_view_presenter.py: 화면 로직
- ui/desktop/common/widgets/custom_chart.py: 차트 위젯 (있다면)

✅ 제약사항:
- 로직 없음 (Presenter에 위임)
- setStyleSheet 하드코딩 금지 (전역 스타일 사용)
- Passive View (Presenter가 제어)
```

---

## 🎯 실전 시나리오 - 단계별 분해

### 시나리오: "코인 목록을 조회해서 화면에 표시하고 싶어요"

이것은 **여러 레이어 협업**이 필요한 복잡한 기능입니다.

#### 1단계: Infrastructure - 데이터 가져오기

**요구사항:** "업비트에서 코인 목록 조회"

**위치:** `infrastructure/external_apis/upbit/upbit_public_client.py`

**요청:**

```
upbit_public_client.py에 마켓 목록 조회 메서드를 추가해주세요.

📍 위치: infrastructure/external_apis/upbit/upbit_public_client.py
🎯 목적: 업비트 전체 마켓 목록 조회

📋 요구사항:
1. get_market_list() 메서드 추가
2. /v1/market/all 엔드포인트 호출
3. List[MarketData] 반환

✅ 제약사항:
- rate_limiter 통과
- Infrastructure 로깅
- 에러 처리
```

#### 2단계: Domain - 개념 정의 (필요시)

**요구사항:** "마켓 엔티티 정의"

**위치:** `domain/entities/market.py`

**요청:**

```
마켓 엔티티를 정의해주세요.

📍 위치: domain/entities/market.py
🎯 목적: 마켓(코인) 개념 정의

📋 요구사항:
1. Market 클래스 (dataclass)
2. 필드: symbol, korean_name, english_name
3. 검증 로직: symbol 형식 확인

✅ 제약사항:
- Domain - 외부 의존성 없음
- 불변 객체 (frozen=True)
```

#### 3단계: Application - 시나리오 구현

**요구사항:** "마켓 목록 조회 UseCase"

**위치:** `application/use_cases/get_market_list.py`

**요청:**

```
마켓 목록 조회 UseCase를 구현해주세요.

📍 위치: application/use_cases/get_market_list.py
🎯 목적: 마켓 목록 조회 시나리오

📋 요구사항:
1. GetMarketListUseCase 클래스
2. execute() 메서드
3. 흐름:
   - upbit_public_client.get_market_list() 호출
   - KRW 마켓만 필터링
   - MarketDTO 리스트 반환

🔗 연관 파일:
- infrastructure/external_apis/upbit/upbit_public_client.py
- application/dto/market_dto.py

✅ 제약사항:
- 조율만, 비즈니스 로직은 Domain에
```

#### 4단계: Presentation - 화면 로직

**요구사항:** "마켓 목록 Presenter"

**위치:** `presentation/presenters/market_list_presenter.py`

**요청:**

```
마켓 목록 Presenter를 구현해주세요.

📍 위치: presentation/presenters/market_list_presenter.py
🎯 목적: 마켓 목록 화면 로직

📋 요구사항:
1. MarketListPresenter 클래스
2. load_market_list() 메서드
3. 흐름:
   - GetMarketListUseCase 호출
   - MarketViewModel로 변환
   - self.view.display_markets(view_models) 호출

🔗 연관 파일:
- application/use_cases/get_market_list.py
- presentation/view_models/market_view_model.py
- ui/desktop/views/market_list_view.py

✅ 제약사항:
- MVP 패턴
- 비즈니스 로직 없음
```

#### 5단계: UI - 화면 구성

**요구사항:** "마켓 목록 View"

**위치:** `ui/desktop/views/market_list_view.py`

**요청:**

```
마켓 목록 View를 구현해주세요.

📍 위치: ui/desktop/views/market_list_view.py
🎯 목적: 마켓 목록 테이블 UI

📋 요구사항:
1. MarketListView 클래스 (QWidget)
2. QTableWidget (심볼, 한글명, 영문명 컬럼)
3. display_markets(view_models) 메서드
4. 로직 없음 (Presenter에 위임)

✅ 제약사항:
- Passive View
- setStyleSheet 금지
```

---

## ✅ 판단 연습 문제

### 문제 1: "전략의 RSI 설정값이 0~100 범위인지 검증하고 싶어요"

<details>
<summary>정답 보기</summary>

**위치:** `domain/services/strategy_validator.py`

**이유:**

- 검증 규칙 → 비즈니스 로직 ✅
- Domain 레이어

**요청 예시:**

```
전략 검증 서비스를 구현해주세요.

📍 위치: domain/services/strategy_validator.py
🎯 목적: 전략 설정값 검증

📋 요구사항:
1. validate_rsi_settings(rsi_value: Decimal) 메서드
2. 0 <= rsi_value <= 100 확인
3. 범위 밖이면 ValidationError 발생

✅ 제약사항:
- Domain - 외부 의존성 없음
```

</details>

### 문제 2: "차트에 빨간색/파란색 캔들을 그리고 싶어요"

<details>
<summary>정답 보기</summary>

**위치:** `ui/desktop/views/chart_view.py` (또는 common/widgets/)

**이유:**

- 화면 시각화 → UI 조립 ✅
- UI 레이어

**요청 예시:**

```
캔들 차트 위젯을 구현해주세요.

📍 위치: ui/desktop/common/widgets/candlestick_chart.py
🎯 목적: matplotlib 캔들 차트 그리기

📋 요구사항:
1. CandlestickChart 클래스 (FigureCanvas 상속)
2. plot_candles(candle_data) 메서드
3. 상승: 빨간색, 하락: 파란색
4. matplotlib 테마는 전역 StyleManager 사용

✅ 제약사항:
- 로직 없음
- setStyleSheet 금지
```

</details>

### 문제 3: "전략 목록을 DB에서 조회하고 싶어요"

<details>
<summary>정답 보기</summary>

**위치:** `infrastructure/database/repositories/strategies_repository.py`

**이유:**

- "DB에서 조회" → 외부 연결 ✅
- Infrastructure 레이어

**요청 예시:**

```
전략 Repository에 목록 조회 메서드를 추가해주세요.

📍 위치: infrastructure/database/repositories/strategies_repository.py
🎯 목적: 전체 전략 목록 조회

📋 요구사항:
1. get_all_strategies() 메서드 추가
2. strategies.sqlite3에서 SELECT
3. List[StrategyEntity] 반환

✅ 제약사항:
- Infrastructure 로깅
- DB 에러 처리
```

</details>

### 문제 4: "수익률을 계산하고 싶어요"

<details>
<summary>정답 보기</summary>

**위치:** `domain/services/profit_calculator.py`

**이유:**

- 계산식 → 비즈니스 로직 ✅
- Domain 레이어

**요청 예시:**

```
수익률 계산 서비스를 구현해주세요.

📍 위치: domain/services/profit_calculator.py
🎯 목적: 수익률 계산

📋 요구사항:
1. calculate_profit_rate(entry, current) 메서드
2. (현재가 - 진입가) ÷ 진입가 × 100
3. Decimal 타입 사용

✅ 제약사항:
- Domain - 외부 의존성 없음
- 순수 계산만
```

</details>

### 문제 5: "사용자가 '주문' 버튼을 누르면 확인 창을 띄우고 싶어요"

<details>
<summary>정답 보기</summary>

**위치:** `presentation/presenters/order_dialog_presenter.py`

**이유:**

- "버튼 누르면" → UI 이벤트 ✅
- "확인 창 띄우기" → 화면 제어 ✅
- Presentation 레이어

**요청 예시:**

```
주문 다이얼로그 Presenter를 구현해주세요.

📍 위치: presentation/presenters/order_dialog_presenter.py
🎯 목적: 주문 확인 흐름 제어

📋 요구사항:
1. on_order_button_clicked() 메서드
2. self.view.show_confirmation_dialog() 호출
3. 확인 시 ExecuteOrderUseCase 호출

🔗 연관 파일:
- application/use_cases/execute_order.py
- ui/desktop/views/order_dialog_view.py

✅ 제약사항:
- MVP 패턴
- 비즈니스 로직 없음
```

</details>

---

## 🎓 졸업 체크리스트

다음 질문에 자신 있게 답할 수 있나요?

- [ ] "업비트 API 호출"은 어디에? → Infrastructure
- [ ] "RSI 계산"은 어디에? → Domain
- [ ] "전략 생성 시나리오"는 어디에? → Application
- [ ] "버튼 클릭 처리"는 어디에? → Presentation
- [ ] "테이블 UI 구성"은 어디에? → UI

**모두 체크했다면 `guides/04_코파일럿에게_요청하기.md`로 이동!**

---

## 📖 다음 학습

- **guides/04_코파일럿에게_요청하기.md** - 명확한 요청 템플릿
- **learning/L01_DDD란_무엇인가.md** - DDD 전체 그림 이해
- **learning/L03~L06** - 각 레이어 심화 학습

---

**문서 버전:** v1.0
**최종 수정:** 2025-10-02
**작성자:** GitHub Copilot (Claude Sonnet 4)
