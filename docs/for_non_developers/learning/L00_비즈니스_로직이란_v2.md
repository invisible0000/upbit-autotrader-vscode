# ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë€? v2 - Domain vs Application ì™„ë²½ êµ¬ë¶„

## ğŸ¯ ì´ ë¬¸ì„œì˜ ëª©ì 

**"ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ Domainì—ë„ ìˆê³  Applicationì—ë„ ìˆë‹¤ê³ ?"**

ì´ í˜¼ë€ì„ **ì™„ë²½íˆ í•´ê²°**í•˜ê³ , **ì–´ë””ì— ë¬´ì—‡ì„ ë§Œë“¤ì§€ ì •í™•íˆ íŒë‹¨**í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

---

## ğŸ¤” í•µì‹¬ ì§ˆë¬¸: "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì–´ë””ì— ìˆë‚˜ìš”?"

### í˜¼ë€ìŠ¤ëŸ¬ìš´ ë‹µë³€ë“¤

- ğŸ“š **ì±… A**: "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Domainì— ìˆìŠµë‹ˆë‹¤"
- ğŸ“š **ì±… B**: "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Applicationì— ìˆìŠµë‹ˆë‹¤"
- ğŸ¤· **ë‹¹ì‹ **: "ë­ê°€ ë§ëŠ” ê±°ì£ ???"

### ğŸ¯ ì§„ì‹¤

**ë‘˜ ë‹¤ ë§ìŠµë‹ˆë‹¤!** í•˜ì§€ë§Œ **"ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"ì˜ ì¢…ë¥˜ê°€ ë‹¤ë¦…ë‹ˆë‹¤.**

---

## ğŸ“Š ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ 2ê°€ì§€ ì¢…ë¥˜

### ë¹„ìœ : ë ˆìŠ¤í† ë‘ìœ¼ë¡œ ì´í•´í•˜ê¸°

```
ğŸ½ï¸ ë ˆìŠ¤í† ë‘ = ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›ï¸ Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§                 â”‚
â”‚ "ìš”ë¦¬ë²• ê·œì¹™"                            â”‚
â”‚                                         â”‚
â”‚ - íŒŒìŠ¤íƒ€ëŠ” ë©´ì„ 8ë¶„ ì‚¶ëŠ”ë‹¤ (ê°œë…ì˜ ê·œì¹™)  â”‚
â”‚ - ìŠ¤í…Œì´í¬ëŠ” 150ë„ì—ì„œ êµ½ëŠ”ë‹¤            â”‚
â”‚ - ì†Œê¸ˆì€ ì¬ë£Œì˜ 1% ë¶„ëŸ‰                  â”‚
â”‚                                         â”‚
â”‚ íŠ¹ì§•: ì–´ëŠ ë ˆìŠ¤í† ë‘ì´ë“  ë™ì¼              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¬ Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§             â”‚
â”‚ "ì£¼ë¬¸ ì²˜ë¦¬ ê·œì¹™"                         â”‚
â”‚                                         â”‚
â”‚ - ì£¼ë¬¸ ë°›ê¸° â†’ ì¬ê³  í™•ì¸ â†’ ì¡°ë¦¬ â†’ ì„œë¹™    â”‚
â”‚ - VIP ê³ ê°ì€ ìš°ì„  ì²˜ë¦¬                   â”‚
â”‚ - 3ë§Œì› ì´ìƒ ë¬´ë£Œ ë°°ë‹¬                   â”‚
â”‚                                         â”‚
â”‚ íŠ¹ì§•: ë ˆìŠ¤í† ë‘ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (í•µì‹¬ ê·œì¹™)

### ì •ì˜

**"ì´ê²ƒì´ ë¬´ì—‡ì¸ê°€?"ì— ëŒ€í•œ ìˆœìˆ˜í•œ ê·œì¹™**

### íŠ¹ì§•

- âœ… **ê°œë…ì˜ ë³¸ì§ˆ**: "ì „ëµì´ë€?", "ìˆ˜ìµë¥ ì´ë€?"
- âœ… **ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ**: DB, API, íŒŒì¼ ì—†ì´ ì™„ê²°
- âœ… **ì–´ë””ì„œë“  ë™ì¼**: ì—…ë¹„íŠ¸ë“  ë°”ì´ë‚¸ìŠ¤ë“  ê°™ì€ ê·œì¹™
- âœ… **ë³€ê²½ ê±°ì˜ ì—†ìŒ**: í•µì‹¬ ê°œë…ì€ ì•ˆì •ì 

### ì‹¤ì „ ì˜ˆì‹œ

#### ì˜ˆì‹œ 1: ìˆ˜ìµë¥  ê³„ì‚°

```python
# domain/services/profit_calculator.py
class ProfitCalculator:
    """ìˆ˜ìµë¥  ê³„ì‚° - Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"""

    def calculate_profit_rate(
        self,
        entry_price: Decimal,
        current_price: Decimal
    ) -> Decimal:
        """
        í•µì‹¬ ê·œì¹™: ìˆ˜ìµë¥ ì´ë€ ë¬´ì—‡ì¸ê°€?
        ìˆ˜ìµë¥  = (í˜„ì¬ê°€ - ì§„ì…ê°€) Ã· ì§„ì…ê°€ Ã— 100

        ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ â†’ Domain!
        """
        if entry_price <= 0:
            raise DomainError("ì§„ì…ê°€ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•¨")

        return (current_price - entry_price) / entry_price * 100

    def is_profit_target_reached(
        self,
        profit_rate: Decimal,
        target_rate: Decimal
    ) -> bool:
        """
        í•µì‹¬ ê·œì¹™: ëª©í‘œ ìˆ˜ìµ ë‹¬ì„±ì´ë€?
        """
        return profit_rate >= target_rate
```

**ì™œ Domainì¸ê°€?**

- âœ… "ìˆ˜ìµë¥ "ì˜ **ê°œë… ì •ì˜**
- âœ… ê³„ì‚°ê¸°ë§Œ ìˆìœ¼ë©´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ (DB/API ë¶ˆí•„ìš”)
- âœ… ì–´ë–¤ ê±°ë˜ì†Œë“  ë™ì¼í•œ ê³µì‹

#### ì˜ˆì‹œ 2: ì „ëµ ê·œì¹™

```python
# domain/entities/strategy.py
class Strategy:
    """ì „ëµ ì—”í‹°í‹° - Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"""

    def add_rule(self, rule: TriggerRule) -> None:
        """
        í•µì‹¬ ê·œì¹™: ì „ëµì´ë€ ë¬´ì—‡ì¸ê°€?
        - ìµœëŒ€ 10ê°œ ê·œì¹™
        - ì¤‘ë³µ ê·œì¹™ ë¶ˆê°€
        """
        if len(self.rules) >= 10:
            raise DomainError("ì „ëµì€ ìµœëŒ€ 10ê°œ ê·œì¹™ë§Œ ê°€ëŠ¥")

        if self._has_duplicate_rule(rule):
            raise DomainError("ì¤‘ë³µëœ ê·œì¹™ ë¶ˆê°€")

        self.rules.append(rule)

    def validate(self) -> None:
        """
        í•µì‹¬ ê·œì¹™: ìœ íš¨í•œ ì „ëµì´ë€?
        """
        if not self.entry_rules:
            raise DomainError("ì§„ì… ê·œì¹™ í•„ìˆ˜")

        if not self.exit_rules:
            raise DomainError("ì²­ì‚° ê·œì¹™ í•„ìˆ˜")
```

**ì™œ Domainì¸ê°€?**

- âœ… "ì „ëµ"ì˜ **ë³¸ì§ˆì  ê·œì¹™**
- âœ… ì™¸ë¶€ ì—†ì´ ë©”ëª¨ë¦¬ì—ì„œ ê²€ì¦ ê°€ëŠ¥
- âœ… í”Œë«í¼ ë¬´ê´€ (ì–´ë””ì„œë“  ì „ëµ ê°œë…ì€ ë™ì¼)

#### ì˜ˆì‹œ 3: RSI íŒë‹¨

```python
# domain/services/indicator_validator.py
class IndicatorValidator:
    """ì§€í‘œ íŒë‹¨ - Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"""

    def is_oversold(self, rsi: Decimal) -> bool:
        """
        í•µì‹¬ ê·œì¹™: ê³¼ë§¤ë„ë€?
        RSI < 30 â†’ ê³¼ë§¤ë„
        """
        return rsi < Decimal("30")

    def is_overbought(self, rsi: Decimal) -> bool:
        """
        í•µì‹¬ ê·œì¹™: ê³¼ë§¤ìˆ˜ë€?
        RSI > 70 â†’ ê³¼ë§¤ìˆ˜
        """
        return rsi > Decimal("70")
```

**ì™œ Domainì¸ê°€?**

- âœ… "ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„"ì˜ **ì •ì˜**
- âœ… ìˆ«ì ë¹„êµë§Œìœ¼ë¡œ ì™„ê²°
- âœ… ê¸°ìˆ ì  ë¶„ì„ì˜ ë³´í¸ì  ê·œì¹™

---

## 2ï¸âƒ£ Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì‹œë‚˜ë¦¬ì˜¤ ê·œì¹™)

### ì •ì˜

**"ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€?"ì— ëŒ€í•œ ì‘ì—… íë¦„ ê·œì¹™**

### íŠ¹ì§•

- âœ… **ì‹œë‚˜ë¦¬ì˜¤ ì¡°ìœ¨**: ì—¬ëŸ¬ Domain + Infrastructure ì¡°í•©
- âœ… **ì™¸ë¶€ ì˜ì¡´ì„± ìˆìŒ**: Repository, API Client ì‚¬ìš©
- âœ… **í”Œë«í¼ íŠ¹í™” ê°€ëŠ¥**: ì—…ë¹„íŠ¸ë§Œì˜ ê·œì¹™ í¬í•¨ ê°€ëŠ¥
- âœ… **ë³€ê²½ ë§ìŒ**: ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ë³€í™”ì— ë¯¼ê°

### ì‹¤ì „ ì˜ˆì‹œ

#### ì˜ˆì‹œ 1: ì „ëµ ìƒì„± ì‹œë‚˜ë¦¬ì˜¤

```python
# application/use_cases/create_strategy.py
class CreateStrategyUseCase:
    """ì „ëµ ìƒì„± UseCase - Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"""

    def __init__(
        self,
        strategy_repository: IStrategyRepository,
        event_bus: IEventBus,
        auth_service: IAuthService
    ):
        self.repository = strategy_repository
        self.event_bus = event_bus
        self.auth_service = auth_service

    def execute(self, strategy_data: StrategyDTO, user_id: str) -> str:
        """
        ì‹œë‚˜ë¦¬ì˜¤ ê·œì¹™: ì „ëµì„ ì–´ë–»ê²Œ ìƒì„±í•  ê²ƒì¸ê°€?
        """
        # 1. ê¶Œí•œ ê²€ì¦ (Application ê·œì¹™)
        if not self.auth_service.can_create_strategy(user_id):
            raise ApplicationError("ì „ëµ ìƒì„± ê¶Œí•œ ì—†ìŒ")

        # 2. ì¤‘ë³µ ì²´í¬ (Application ê·œì¹™)
        if self.repository.exists_by_name(strategy_data.name):
            raise ApplicationError("ë™ì¼í•œ ì´ë¦„ì˜ ì „ëµì´ ì´ë¯¸ ì¡´ì¬")

        # 3. ì „ëµ ìƒì„± (Domain í˜¸ì¶œ)
        strategy = Strategy.create(strategy_data)
        strategy.validate()  # Domain ê·œì¹™ ì‹¤í–‰

        # 4. ì €ì¥ (Infrastructure í˜¸ì¶œ)
        strategy_id = self.repository.save(strategy)

        # 5. ì´ë²¤íŠ¸ ë°œí–‰ (Application ê·œì¹™)
        self.event_bus.publish(
            StrategyCreatedEvent(strategy_id, user_id)
        )

        return strategy_id
```

**ì™œ Applicationì¸ê°€?**

- âœ… **ì—¬ëŸ¬ ë‹¨ê³„ ì¡°ìœ¨** (ê¶Œí•œâ†’ì¤‘ë³µâ†’ìƒì„±â†’ì €ì¥â†’ì´ë²¤íŠ¸)
- âœ… **ì™¸ë¶€ ì˜ì¡´ì„±** (Repository, EventBus)
- âœ… **ì‹œë‚˜ë¦¬ì˜¤ íŠ¹í™”** (ìš°ë¦¬ ì‹œìŠ¤í…œë§Œì˜ íë¦„)

#### ì˜ˆì‹œ 2: ìµì ˆ ì‹¤í–‰ ì‹œë‚˜ë¦¬ì˜¤

```python
# application/use_cases/execute_take_profit.py
class ExecuteTakeProfitUseCase:
    """ìµì ˆ ì‹¤í–‰ UseCase - Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"""

    def __init__(
        self,
        position_repository: IPositionRepository,
        upbit_client: IUpbitClient,
        profit_calculator: ProfitCalculator,  # Domain
        event_bus: IEventBus,
        logger: Logger
    ):
        self.position_repo = position_repository
        self.upbit_client = upbit_client
        self.profit_calculator = profit_calculator
        self.event_bus = event_bus
        self.logger = logger

    def execute(self, position_id: str) -> dict:
        """
        ì‹œë‚˜ë¦¬ì˜¤ ê·œì¹™: ìµì ˆì„ ì–´ë–»ê²Œ ì‹¤í–‰í•  ê²ƒì¸ê°€?
        """
        # 1. í¬ì§€ì…˜ ì¡°íšŒ (Infrastructure)
        position = self.position_repo.find_by_id(position_id)
        if not position:
            raise ApplicationError("í¬ì§€ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ")

        # 2. í˜„ì¬ê°€ ì¡°íšŒ (Infrastructure)
        current_price = self.upbit_client.get_current_price(
            position.symbol
        )

        # 3. ìˆ˜ìµë¥  ê³„ì‚° (Domain í˜¸ì¶œ)
        profit_rate = self.profit_calculator.calculate_profit_rate(
            position.entry_price,
            current_price
        )

        # 4. ëª©í‘œ ë‹¬ì„± í™•ì¸ (Domain í˜¸ì¶œ)
        if not self.profit_calculator.is_profit_target_reached(
            profit_rate,
            position.target_profit_rate
        ):
            return {"status": "target_not_reached", "profit_rate": profit_rate}

        # 5. ì£¼ë¬¸ ìƒì„± (Domain í˜¸ì¶œ)
        order = position.create_close_order(current_price)

        # 6. ê±°ë˜ì†Œ ì£¼ë¬¸ (Infrastructure)
        result = self.upbit_client.place_order(order)

        # 7. ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ì €ì¥ (Application ê·œì¹™)
        position.mark_as_closed(result.executed_price)
        self.position_repo.save(position)

        # 8. ë¡œê¹… ë° ì´ë²¤íŠ¸ (Application ê·œì¹™)
        self.logger.info(f"ìµì ˆ ì™„ë£Œ: {position_id}, ìˆ˜ìµë¥ : {profit_rate}%")
        self.event_bus.publish(
            TakeProfitExecutedEvent(position_id, profit_rate)
        )

        return {
            "status": "success",
            "profit_rate": profit_rate,
            "order_id": result.order_id
        }
```

**ì™œ Applicationì¸ê°€?**

- âœ… **ë³µì¡í•œ ì‹œë‚˜ë¦¬ì˜¤** (8ë‹¨ê³„ íë¦„)
- âœ… **ì™¸ë¶€ ì—°ë™ ë‹¤ìˆ˜** (Repository, API Client)
- âœ… **Domain + Infrastructure ì¡°ìœ¨**

#### ì˜ˆì‹œ 3: í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ë°¸ëŸ°ì‹±

```python
# application/services/portfolio_rebalancing_service.py
class PortfolioRebalancingService:
    """í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ë°¸ëŸ°ì‹± - Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"""

    def rebalance_portfolio(self, portfolio_id: str) -> dict:
        """
        ì‹œë‚˜ë¦¬ì˜¤ ê·œì¹™: í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì–´ë–»ê²Œ ë¦¬ë°¸ëŸ°ì‹±í•  ê²ƒì¸ê°€?

        ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™:
        - ê° ì½”ì¸ì€ ì´ ìì‚°ì˜ 20%ì”© ìœ ì§€
        - 5% ì´ìƒ ë²—ì–´ë‚˜ë©´ ë¦¬ë°¸ëŸ°ì‹±
        - ê±°ë˜ ìˆ˜ìˆ˜ë£Œ ê³ ë ¤
        """
        # 1. í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ
        positions = self.position_repo.find_by_portfolio(portfolio_id)

        # 2. ì´ ìì‚° ê³„ì‚° (Domain í˜¸ì¶œ)
        total_value = self.portfolio_calculator.calculate_total_value(
            positions
        )

        # 3. ëª©í‘œ ë¹„ì¤‘ ê³„ì‚° (Application ê·œì¹™)
        target_allocation = total_value * Decimal("0.2")

        rebalancing_orders = []

        for position in positions:
            # 4. í˜„ì¬ ë¹„ì¤‘ ê³„ì‚° (Domain í˜¸ì¶œ)
            current_value = self.portfolio_calculator.calculate_position_value(
                position
            )

            # 5. ì°¨ì´ ê³„ì‚° ë° íŒë‹¨ (Application ê·œì¹™)
            diff = current_value - target_allocation
            diff_ratio = abs(diff) / target_allocation

            # ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: 5% ì´ìƒ ì°¨ì´ë§Œ ë¦¬ë°¸ëŸ°ì‹±
            if diff_ratio < Decimal("0.05"):
                continue

            # 6. ì£¼ë¬¸ ìƒì„± ë° ì‹¤í–‰
            if diff > 0:  # ì´ˆê³¼ ë³´ìœ  â†’ ë§¤ë„
                order = self._create_sell_order(position, diff)
            else:  # ë¶€ì¡± ë³´ìœ  â†’ ë§¤ìˆ˜
                order = self._create_buy_order(position, abs(diff))

            # 7. ê±°ë˜ì†Œ ì£¼ë¬¸ (Infrastructure)
            result = self.upbit_client.place_order(order)
            rebalancing_orders.append(result)

        # 8. ê²°ê³¼ ì €ì¥ ë° ì´ë²¤íŠ¸
        self.position_repo.save_all(positions)
        self.event_bus.publish(
            PortfolioRebalancedEvent(portfolio_id, rebalancing_orders)
        )

        return {
            "rebalanced_count": len(rebalancing_orders),
            "orders": rebalancing_orders
        }
```

**ì™œ Applicationì¸ê°€?**

- âœ… **ë³µì¡í•œ ì¡°ìœ¨** (ì—¬ëŸ¬ í¬ì§€ì…˜ ë™ì‹œ ì²˜ë¦¬)
- âœ… **ë¹„ì¦ˆë‹ˆìŠ¤ ì •ì±…** (5% ê¸°ì¤€, 20% ë¹„ì¤‘)
- âœ… **ì™¸ë¶€ ì˜ì¡´ì„±** (Repository, API)

---

## ğŸ¯ íŒë‹¨ ê¸°ì¤€: 3ê°€ì§€ ì§ˆë¬¸ë²•

### ì§ˆë¬¸ 1: "ì™¸ë¶€ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œê°€?"

```python
# âœ… YES â†’ Domain
def test_profit_calculator():
    calculator = ProfitCalculator()
    result = calculator.calculate_profit_rate(
        Decimal("100"),
        Decimal("110")
    )
    assert result == Decimal("10")  # 10% ìˆ˜ìµ
    # DB, API í•„ìš” ì—†ìŒ!

# âŒ NO â†’ Application
def test_create_strategy():
    # Mock í•„ìš”
    mock_repo = Mock(IStrategyRepository)
    mock_event_bus = Mock(IEventBus)

    use_case = CreateStrategyUseCase(mock_repo, mock_event_bus)
    # ...
```

### ì§ˆë¬¸ 2: "ê±°ë˜ì†Œê°€ ë°”ë€Œì–´ë„ ë™ì¼í•œê°€?"

```python
# âœ… YES â†’ Domain
# "ìˆ˜ìµë¥  = (í˜„ì¬ê°€ - ì§„ì…ê°€) Ã· ì§„ì…ê°€ Ã— 100"
# ì—…ë¹„íŠ¸ë“  ë°”ì´ë‚¸ìŠ¤ë“  ë™ì¼!

# âŒ NO â†’ Application
# "ì—…ë¹„íŠ¸ API í˜¸ì¶œ â†’ ì£¼ë¬¸ â†’ ì›¹í›… ìˆ˜ì‹ "
# ê±°ë˜ì†Œë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
```

### ì§ˆë¬¸ 3: "ì—¬ëŸ¬ ê°ì²´/ì„œë¹„ìŠ¤ë¥¼ ì¡°ìœ¨í•˜ëŠ”ê°€?"

```python
# âŒ NO â†’ Domain
class Strategy:
    def validate(self):
        # ìê¸° ìì‹ ë§Œ ê²€ì¦
        if not self.rules:
            raise DomainError("ê·œì¹™ ì—†ìŒ")

# âœ… YES â†’ Application
class CreateStrategyUseCase:
    def execute(self, data):
        # ì—¬ëŸ¬ ì„œë¹„ìŠ¤ ì¡°ìœ¨
        self.auth_service.check(...)
        self.repository.save(...)
        self.event_bus.publish(...)
```

---

## ğŸ“Š ë¹„êµí‘œ: Domain vs Application

| êµ¬ë¶„ | Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |
|------|---------------------|-------------------------|
| **ì§ˆë¬¸** | "ì´ê²ƒì´ ë¬´ì—‡ì¸ê°€?" | "ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€?" |
| **ì´ˆì ** | ê°œë…ì˜ ë³¸ì§ˆ | ì‘ì—…ì˜ íë¦„ |
| **ì˜ˆì‹œ** | "ìˆ˜ìµë¥ ì´ë€?", "ì „ëµì´ë€?" | "ì „ëµì„ ì–´ë–»ê²Œ ìƒì„±?", "ìµì ˆì„ ì–´ë–»ê²Œ ì‹¤í–‰?" |
| **ê³„ì‚°** | ë‹¨ì¼ ê³µì‹ (ìˆ˜ìµë¥ , RSI) | ì—¬ëŸ¬ ê³„ì‚° ì¡°í•© + ì €ì¥ + ì•Œë¦¼ |
| **ê²€ì¦** | ë‹¨ì¼ ê°ì²´ ìœ íš¨ì„± | ì—¬ëŸ¬ ê°ì²´ ê°„ ì •í•©ì„± |
| **ì˜ì¡´ì„±** | âŒ ì™¸ë¶€ ì—†ìŒ | âœ… Repository, API Client |
| **í…ŒìŠ¤íŠ¸** | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‰¬ì›€ | Mock í•„ìš” |
| **ë³€ê²½** | ê±°ì˜ ë³€í•˜ì§€ ì•ŠìŒ | ì‹œë‚˜ë¦¬ì˜¤ ë³€ê²½ ê°€ëŠ¥ |
| **ì¬ì‚¬ìš©** | ë†’ìŒ (ì–´ë””ì„œë“ ) | ì¤‘ê°„ (UseCaseë³„ íŠ¹í™”) |
| **í´ë”** | `domain/` | `application/` |

---

## ğŸ” ì‹¤ì „ íŒë‹¨ ì—°ìŠµ

### ì—°ìŠµ 1: "ì†ì ˆ ê·œì¹™"

**ìš”êµ¬ì‚¬í•­:** "ì†ì‹¤ë¥  -3% ë‹¬ì„± ì‹œ ìë™ ì†ì ˆ"

#### ë¶„í•´

**Domain ë¶€ë¶„:**

```python
# domain/services/loss_calculator.py
class LossCalculator:
    def calculate_loss_rate(self, entry_price, current_price):
        """ì†ì‹¤ë¥  ê³„ì‚° - Domain"""
        return (current_price - entry_price) / entry_price * 100

    def should_stop_loss(self, loss_rate, stop_loss_rate):
        """ì†ì ˆ í•„ìš” ì—¬ë¶€ - Domain"""
        return loss_rate <= stop_loss_rate
```

**Application ë¶€ë¶„:**

```python
# application/use_cases/execute_stop_loss.py
class ExecuteStopLossUseCase:
    def execute(self, position_id):
        """ì†ì ˆ ì‹¤í–‰ ì‹œë‚˜ë¦¬ì˜¤ - Application"""
        # 1. í¬ì§€ì…˜ ì¡°íšŒ
        position = self.repo.find(position_id)

        # 2. í˜„ì¬ê°€ ì¡°íšŒ (Infrastructure)
        current_price = self.upbit_client.get_price(...)

        # 3. ì†ì‹¤ë¥  ê³„ì‚° (Domain í˜¸ì¶œ)
        loss_rate = self.loss_calculator.calculate_loss_rate(...)

        # 4. ì†ì ˆ íŒë‹¨ (Domain í˜¸ì¶œ)
        if not self.loss_calculator.should_stop_loss(...):
            return "ì†ì ˆ ë¶ˆí•„ìš”"

        # 5. ì£¼ë¬¸ ìƒì„± ë° ì‹¤í–‰ (Infrastructure)
        order = position.create_close_order(...)
        result = self.upbit_client.place_order(order)

        # 6. ì €ì¥ ë° ì´ë²¤íŠ¸ (Application)
        self.repo.save(position)
        self.event_bus.publish(...)
```

### ì—°ìŠµ 2: "ë³¼ë¦°ì € ë°´ë“œ ëŒíŒŒ ë§¤ìˆ˜"

**ìš”êµ¬ì‚¬í•­:** "ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ëŒíŒŒ ì‹œ ë§¤ìˆ˜"

#### ë¶„í•´

**Domain ë¶€ë¶„:**

```python
# domain/services/bollinger_calculator.py
class BollingerCalculator:
    def calculate_bands(self, prices, period=20):
        """ë³¼ë¦°ì € ë°´ë“œ ê³„ì‚° - Domain"""
        ma = self._moving_average(prices, period)
        std = self._standard_deviation(prices, period)

        upper = ma + (std * 2)
        lower = ma - (std * 2)

        return upper, ma, lower

    def is_lower_band_break(self, current_price, lower_band):
        """í•˜ë‹¨ ëŒíŒŒ íŒë‹¨ - Domain"""
        return current_price < lower_band
```

**Application ë¶€ë¶„:**

```python
# application/use_cases/execute_bollinger_buy.py
class ExecuteBollingerBuyUseCase:
    def execute(self, symbol):
        """ë³¼ë¦°ì € ë°´ë“œ ê¸°ë°˜ ë§¤ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤ - Application"""
        # 1. ê³¼ê±° ê°€ê²© ì¡°íšŒ (Infrastructure)
        prices = self.upbit_client.get_candles(symbol, count=20)

        # 2. ë³¼ë¦°ì € ë°´ë“œ ê³„ì‚° (Domain í˜¸ì¶œ)
        upper, ma, lower = self.bollinger_calculator.calculate_bands(prices)

        # 3. í˜„ì¬ê°€ ì¡°íšŒ (Infrastructure)
        current_price = self.upbit_client.get_current_price(symbol)

        # 4. ëŒíŒŒ íŒë‹¨ (Domain í˜¸ì¶œ)
        if not self.bollinger_calculator.is_lower_band_break(
            current_price, lower
        ):
            return "ëŒíŒŒ ì•„ë‹˜"

        # 5. ë§¤ìˆ˜ ê¸ˆì•¡ ê³„ì‚° (Application ê·œì¹™)
        balance = self.upbit_client.get_balance("KRW")
        buy_amount = balance * Decimal("0.1")  # ì”ê³ ì˜ 10%

        # 6. ì£¼ë¬¸ ì‹¤í–‰ (Infrastructure)
        order = Order.create_market_buy(symbol, buy_amount)
        result = self.upbit_client.place_order(order)

        # 7. í¬ì§€ì…˜ ìƒì„± ë° ì €ì¥ (Application)
        position = Position.create_from_order(result)
        self.position_repo.save(position)

        return result
```

### ì—°ìŠµ 3: "ë¶„í•  ë§¤ìˆ˜ ì „ëµ"

**ìš”êµ¬ì‚¬í•­:** "3% í•˜ë½í•  ë•Œë§ˆë‹¤ ì¶”ê°€ ë§¤ìˆ˜ (ìµœëŒ€ 3íšŒ)"

#### ë¶„í•´

**Domain ë¶€ë¶„:**

```python
# domain/services/scaling_calculator.py
class ScalingCalculator:
    def calculate_next_buy_price(
        self,
        last_buy_price: Decimal,
        drop_rate: Decimal
    ) -> Decimal:
        """ë‹¤ìŒ ë§¤ìˆ˜ ê°€ê²© ê³„ì‚° - Domain"""
        return last_buy_price * (1 - drop_rate / 100)

    def can_scale_in(
        self,
        current_buy_count: int,
        max_buy_count: int
    ) -> bool:
        """ì¶”ê°€ ë§¤ìˆ˜ ê°€ëŠ¥ ì—¬ë¶€ - Domain"""
        return current_buy_count < max_buy_count
```

**Application ë¶€ë¶„:**

```python
# application/use_cases/execute_scaling_buy.py
class ExecuteScalingBuyUseCase:
    def execute(self, position_id):
        """ë¶„í•  ë§¤ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤ - Application"""
        # 1. í¬ì§€ì…˜ ì¡°íšŒ (Infrastructure)
        position = self.position_repo.find(position_id)

        # 2. ì¶”ê°€ ë§¤ìˆ˜ ê°€ëŠ¥ í™•ì¸ (Domain í˜¸ì¶œ)
        if not self.scaling_calculator.can_scale_in(
            position.buy_count,
            max_buy_count=3
        ):
            return "ìµœëŒ€ ë§¤ìˆ˜ íšŸìˆ˜ ë„ë‹¬"

        # 3. ë‹¤ìŒ ë§¤ìˆ˜ ê°€ê²© ê³„ì‚° (Domain í˜¸ì¶œ)
        next_buy_price = self.scaling_calculator.calculate_next_buy_price(
            position.last_buy_price,
            drop_rate=Decimal("3")
        )

        # 4. í˜„ì¬ê°€ í™•ì¸ (Infrastructure)
        current_price = self.upbit_client.get_current_price(
            position.symbol
        )

        # 5. ê°€ê²© ì¡°ê±´ í™•ì¸ (Application ê·œì¹™)
        if current_price > next_buy_price:
            return "ì•„ì§ ë§¤ìˆ˜ ê°€ê²© ë¯¸ë„ë‹¬"

        # 6. ë§¤ìˆ˜ ê¸ˆì•¡ ê³„ì‚° (Application ê·œì¹™)
        # ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì²« ë§¤ìˆ˜ì˜ 50%ì”© ì¶”ê°€
        buy_amount = position.first_buy_amount * Decimal("0.5")

        # 7. ì£¼ë¬¸ ì‹¤í–‰ (Infrastructure)
        order = Order.create_market_buy(position.symbol, buy_amount)
        result = self.upbit_client.place_order(order)

        # 8. í¬ì§€ì…˜ ì—…ë°ì´íŠ¸ (Application)
        position.add_buy(result.price, result.quantity)
        self.position_repo.save(position)

        return result
```

---

## ğŸ’¡ ì™œ ì´ë ‡ê²Œ ë‚˜ëˆ„ë‚˜ìš”?

### Domain ë¶„ë¦¬ì˜ ì¥ì 

```python
# âœ… ì¬ì‚¬ìš©ì„±: ì–´ë””ì„œë“  ì‚¬ìš© ê°€ëŠ¥
profit_rate = profit_calculator.calculate(100, 110)  # UseCaseì—ì„œ
profit_rate = profit_calculator.calculate(100, 110)  # Presenterì—ì„œ
profit_rate = profit_calculator.calculate(100, 110)  # ë°°ì¹˜ ì‘ì—…ì—ì„œ

# âœ… í…ŒìŠ¤íŠ¸ ìš©ì´: ì™¸ë¶€ ì—†ì´ ì™„ê²°
def test_profit_calculator():
    result = calculate_profit_rate(100, 110)
    assert result == 10  # Mock ë¶ˆí•„ìš”!

# âœ… ë³€ê²½ ì•ˆì •ì„±: í•µì‹¬ ê·œì¹™ì€ ê±°ì˜ ë³€í•˜ì§€ ì•ŠìŒ
# "ìˆ˜ìµë¥  ê³µì‹"ì€ 10ë…„ì´ ì§€ë‚˜ë„ ë™ì¼
```

### Application ë¶„ë¦¬ì˜ ì¥ì 

```python
# âœ… ì‹œë‚˜ë¦¬ì˜¤ ìœ ì—°ì„±: íë¦„ ë³€ê²½ ì‰¬ì›€
# AS-IS: ìƒì„± â†’ ì €ì¥
# TO-BE: ìƒì„± â†’ ìŠ¹ì¸ ëŒ€ê¸° â†’ ì €ì¥

# âœ… ì™¸ë¶€ í†µí•©: Infrastructure ì¡°ìœ¨
# Repository, API Client, EventBus ë“±ì„ ììœ ë¡­ê²Œ ì¡°í•©

# âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì •ì±…: í”Œë«í¼ íŠ¹í™” ê·œì¹™
# "ì—…ë¹„íŠ¸ëŠ” ìµœì†Œ 5,000ì›", "VIPëŠ” ìˆ˜ìˆ˜ë£Œ ë©´ì œ" ë“±
```

---

## ğŸ“ ìµœì¢… ì •ë¦¬

### Domain ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] "ì´ê²ƒì´ ë¬´ì—‡ì¸ê°€?"ì— ëŒ€í•œ ë‹µì¸ê°€?
- [ ] ì™¸ë¶€ ì˜ì¡´ì„±(DB, API) ì—†ì´ ì™„ê²°ë˜ëŠ”ê°€?
- [ ] ì–´ë–¤ í”Œë«í¼ì—ì„œë“  ë™ì¼í•œ ê·œì¹™ì¸ê°€?
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ê°„ë‹¨í•œê°€?

**â†’ ëª¨ë‘ YES â†’ Domainì— ì‘ì„±**

### Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] "ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€?"ì— ëŒ€í•œ ë‹µì¸ê°€?
- [ ] ì—¬ëŸ¬ Domain/Infrastructureë¥¼ ì¡°ìœ¨í•˜ëŠ”ê°€?
- [ ] ì™¸ë¶€ ì˜ì¡´ì„±(Repository, API)ì´ í•„ìš”í•œê°€?
- [ ] ì‹œë‚˜ë¦¬ì˜¤ê°€ ë³€ê²½ë  ê°€ëŠ¥ì„±ì´ ìˆëŠ”ê°€?

**â†’ ëª¨ë‘ YES â†’ Applicationì— ì‘ì„±**

---

## ğŸš€ ì‹¤ì „ ì ìš© ê°€ì´ë“œ

### ìƒˆ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ

1. **ë¨¼ì € Domain ìƒê°**
   - "ì´ ê¸°ëŠ¥ì˜ í•µì‹¬ ê°œë…/ê·œì¹™ì€?"
   - ê³„ì‚°ì‹, ê²€ì¦ ê·œì¹™ì„ Domainì— ë¨¼ì € êµ¬í˜„

2. **ë‹¤ìŒ Application ì„¤ê³„**
   - "ì–´ë–¤ ìˆœì„œë¡œ ì‹¤í–‰í•  ê²ƒì¸ê°€?"
   - Domain + Infrastructure ì¡°ìœ¨ ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„±

3. **í…ŒìŠ¤íŠ¸ ì‘ì„±**
   - Domain: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Mock ì—†ì´)
   - Application: í†µí•© í…ŒìŠ¤íŠ¸ (Mock ì‚¬ìš©)

---

## ğŸ“– ë‹¤ìŒ í•™ìŠµ

ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬ë¶„ì„ ì´í•´í–ˆë‹¤ë©´:

1. **learning/L01_DDDë€_ë¬´ì—‡ì¸ê°€.md** - DDD ì „ì²´ êµ¬ì¡° ì´í•´
2. **learning/L04_Domain_ì‰½ê²Œ_ì´í•´í•˜ê¸°.md** - Domain ì‹¬í™”
3. **learning/L05_Application_ì‰½ê²Œ_ì´í•´í•˜ê¸°.md** - Application ì‹¬í™”
4. **guides/01_ì–´ë””ì—_ë¬´ì—‡ì„_ë§Œë“¤ê¹Œ.md** - ì‹¤ì „ íŒë‹¨ ì—°ìŠµ

---

**ë¬¸ì„œ ë²„ì „:** v2.0
**ìµœì¢… ìˆ˜ì •:** 2025-10-02
**ì‘ì„±ì:** GitHub Copilot (Claude Sonnet 4)
**ë³€ê²½ ì‚¬í•­:** Domain vs Application ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì™„ë²½ êµ¬ë¶„
