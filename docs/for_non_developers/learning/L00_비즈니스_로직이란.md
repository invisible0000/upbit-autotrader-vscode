# 비즈니스 로직이란? - 초보자를 위한 완벽 가이드

## 🎯 이 문서의 목적

"비즈니스 로직"이라는 어려운 용어를 **일상 언어로 완벽히 이해하기**

---

## 🤔 "비즈니스 로직"이 뭐죠?

### 한 문장 정의

**"우리 프로그램만의 고유한 규칙과 계산"**

### 더 쉽게 말하면

**"이 프로그램이 해결하려는 문제의 핵심 규칙"**

---

## 🏪 현실 세계 비유

### 예시 1: 편의점 계산

당신이 편의점 주인이라고 상상해보세요.

#### ✅ 비즈니스 로직 (핵심 규칙)

- "3개 사면 1개 공짜"
- "10,000원 이상 구매 시 배달 무료"
- "유통기한 3일 이내 상품은 30% 할인"
- "포인트 1,000점당 1,000원 할인"

#### ❌ 비즈니스 로직이 아닌 것

- 계산대 화면 디자인 (화면)
- 바코드 스캐너 작동 (외부 장치)
- 매출 DB에 저장 (저장)
- 카드 결제 통신 (외부 연결)

### 예시 2: 은행 앱

#### ✅ 비즈니스 로직

- "송금액은 잔액보다 작아야 함"
- "하루 송금 한도는 500만원"
- "예금 이자 = 원금 × 연이율 ÷ 365 × 일수"
- "신용등급 1등급은 대출 금리 -0.5%"

#### ❌ 비즈니스 로직이 아닌 것

- 송금 버튼 색깔 (화면)
- 지문 인식 (외부 장치)
- 거래 내역 DB 조회 (저장)
- 타은행 송금 API 호출 (외부 연결)

---

## 💰 업비트 자동매매에서의 비즈니스 로직

### ✅ 비즈니스 로직 (Domain 레이어에 속함)

#### 1. **거래 규칙**

```
❓ "언제 사야 하지?"
✅ 비즈니스 로직: "RSI가 30 이하면 매수"

❓ "언제 팔아야 하지?"
✅ 비즈니스 로직: "수익률 5% 달성 시 익절"

❓ "얼마나 사야 하지?"
✅ 비즈니스 로직: "총 자산의 10%로 매수"
```

#### 2. **계산식**

```
❓ "RSI를 어떻게 계산하지?"
✅ 비즈니스 로직: (평균 상승분) ÷ (평균 상승분 + 평균 하락분) × 100

❓ "수익률은 어떻게 계산하지?"
✅ 비즈니스 로직: (현재가 - 매수가) ÷ 매수가 × 100

❓ "평균 매수가는?"
✅ 비즈니스 로직: (총 매수 금액) ÷ (총 매수 수량)
```

#### 3. **검증 규칙**

```
❓ "이 주문이 유효한가?"
✅ 비즈니스 로직: "최소 주문 금액은 5,000원 이상"

❓ "이 전략 설정이 올바른가?"
✅ 비즈니스 로직: "손절가는 진입가보다 낮아야 함"

❓ "지금 매수할 수 있나?"
✅ 비즈니스 로직: "현재 보유 종목 수가 5개 미만이어야 함"
```

#### 4. **상태 판단**

```
❓ "지금 시장이 과매수인가?"
✅ 비즈니스 로직: "RSI > 70 → 과매수"

❓ "이 포지션은 수익 중인가?"
✅ 비즈니스 로직: "현재가 > 평균 매수가 → 수익 중"

❓ "손절해야 하나?"
✅ 비즈니스 로직: "손실률이 -3% 이상 → 손절"
```

### ❌ 비즈니스 로직이 아닌 것

#### 1. **화면 관련** (Presentation 레이어)

```
❌ "차트를 빨간색으로 표시"
❌ "수익률을 2자리까지 표시"
❌ "버튼을 클릭하면 다이얼로그 표시"
❌ "테이블에 데이터 정렬"
```

#### 2. **외부 연결** (Infrastructure 레이어)

```
❌ "업비트에서 현재가 조회"
❌ "DB에 전략 저장"
❌ "로그 파일에 기록"
❌ "WebSocket으로 실시간 데이터 수신"
```

#### 3. **시나리오 조율** (Application 레이어)

```
❌ "사용자가 '전략 저장' 버튼을 누르면..."
❌ "먼저 DB에서 데이터 조회하고, 그 다음 계산하고..."
❌ "여러 지표를 조합해서 최종 판단"
```

---

## 🎓 판단 기준 트레이닝

### 연습 문제: 이것은 비즈니스 로직인가?

#### 문제 1

**"BTC 현재가가 90,000,000원이면 화면에 '9천만원'으로 표시"**

<details>
<summary>정답 보기</summary>

**❌ 비즈니스 로직 아님 (Presentation)**

이유:

- "90,000,000원" → 데이터 (비즈니스 로직도 아니고 표시도 아님)
- "9천만원으로 표시" → 화면 표시 방식 (Presentation)

비즈니스 로직이라면:

- "BTC 가격이 9천만원 이상이면 알림 발송" (규칙)
- "9천만원 돌파 시 매수" (거래 규칙)

</details>

#### 문제 2

**"RSI가 70을 넘으면 과매수 상태다"**

<details>
<summary>정답 보기</summary>

**✅ 비즈니스 로직 맞음 (Domain)**

이유:

- 판단 규칙 ("70 넘으면 과매수")
- 계산이나 외부 연결 없음
- 순수한 규칙 정의

</details>

#### 문제 3

**"업비트 API를 호출해서 잔고를 가져온다"**

<details>
<summary>정답 보기</summary>

**❌ 비즈니스 로직 아님 (Infrastructure)**

이유:

- 외부 연결 ("업비트 API 호출")
- 데이터 가져오기만 함
- 규칙이나 계산 없음

비즈니스 로직이라면:

- "잔고가 100만원 미만이면 알림" (규칙)
- "잔고의 10%만 투자" (계산)

</details>

#### 문제 4

**"수익률이 5% 이상이면 익절한다"**

<details>
<summary>정답 보기</summary>

**✅ 비즈니스 로직 맞음 (Domain)**

이유:

- 거래 규칙 ("5% 이상 → 익절")
- "언제 팔 것인가?"에 대한 답
- 프로그램의 핵심 목적과 직결

</details>

#### 문제 5

**"사용자가 '매수' 버튼을 누르면 주문 확인 창을 띄운다"**

<details>
<summary>정답 보기</summary>

**❌ 비즈니스 로직 아님 (Presentation + Application)**

이유:

- "버튼을 누르면" → 화면 이벤트 (Presentation)
- "확인 창을 띄운다" → 화면 표시 (Presentation)
- "주문 흐름" → 시나리오 (Application)

비즈니스 로직이라면:

- "이 주문이 가능한지 검증" (규칙)
- "주문 수량 계산" (계산)

</details>

#### 문제 6

**"7일 이동평균이 30일 이동평균보다 위에 있으면 상승 추세다"**

<details>
<summary>정답 보기</summary>

**✅ 비즈니스 로직 맞음 (Domain)**

이유:

- 시장 상태 판단 규칙
- "상승 추세"는 거래 의사결정의 기준
- 핵심 전략 규칙

</details>

#### 문제 7

**"전략 데이터를 strategies.sqlite3 DB에 저장한다"**

<details>
<summary>정답 보기</summary>

**❌ 비즈니스 로직 아님 (Infrastructure)**

이유:

- "DB에 저장" → 외부 저장소 연결
- 규칙이나 계산 없음

비즈니스 로직이라면:

- "전략은 반드시 진입 규칙과 청산 규칙을 가져야 함" (검증)
- "전략 이름은 중복될 수 없음" (규칙)

</details>

#### 문제 8

**"매수 후 손실률이 -3%가 되면 자동 손절한다"**

<details>
<summary>정답 보기</summary>

**✅ 비즈니스 로직 맞음 (Domain)**

이유:

- 리스크 관리 규칙
- "언제 손절할 것인가?"에 대한 답
- 자동매매의 핵심 규칙

</details>

---

## 🎯 실전 판단 공식

### 3가지 질문으로 판단하기

```
질문 1: "이것은 '규칙' 또는 '계산식'인가?"
        YES → 비즈니스 로직일 가능성 높음

질문 2: "화면 표시, API 호출, DB 저장과 관련 있나?"
        YES → 비즈니스 로직 아님

질문 3: "이것이 없으면 프로그램의 핵심 목적이 달성 안 되나?"
        YES → 비즈니스 로직 맞음
```

### 실전 적용 예시

**"RSI 30 이하면 매수하고, 화면에 녹색으로 표시"**

분해:

1. "RSI 30 이하면 매수" → 규칙 → ✅ 비즈니스 로직 (Domain)
2. "화면에 녹색으로 표시" → 화면 → ❌ 비즈니스 로직 아님 (Presentation)

결론: 하나의 문장이지만 **2개의 레이어**로 분리해야 함

---

## 📂 프로젝트에서 찾아보기

### Domain 폴더 (비즈니스 로직)

```
upbit_auto_trading/domain/
├── entities/                    # 핵심 개념
│   ├── strategy.py             # "전략이란 무엇인가?"
│   ├── order.py                # "주문이란 무엇인가?"
│   └── position.py             # "포지션이란 무엇인가?"
│
├── value_objects/              # 작은 값 개념
│   ├── price.py                # "가격은 어떻게 표현하나?"
│   ├── quantity.py             # "수량은 어떻게 계산하나?"
│   └── timeframe.py            # "시간프레임 종류는?"
│
└── services/                   # 계산 로직
    ├── indicator_calculator.py # "RSI, 이평선 계산"
    ├── profit_calculator.py    # "수익률, 손익 계산"
    └── risk_manager.py         # "리스크 관리 규칙"
```

### 실제 파일 예시

#### `domain/services/profit_calculator.py` (비즈니스 로직)

```python
class ProfitCalculator:
    """수익률 계산 - 비즈니스 로직"""

    def calculate_profit_rate(
        self,
        entry_price: Decimal,
        current_price: Decimal
    ) -> Decimal:
        """
        비즈니스 로직:
        수익률 = (현재가 - 진입가) ÷ 진입가 × 100
        """
        return (current_price - entry_price) / entry_price * 100

    def should_take_profit(
        self,
        profit_rate: Decimal,
        target_rate: Decimal
    ) -> bool:
        """
        비즈니스 로직:
        수익률이 목표치 이상이면 익절
        """
        return profit_rate >= target_rate
```

#### `presentation/presenters/chart_presenter.py` (비즈니스 로직 아님)

```python
class ChartPresenter:
    """화면 로직 - 비즈니스 로직 아님"""

    def update_profit_label(self, profit_rate: Decimal) -> None:
        """
        Presentation:
        수익률을 화면에 표시
        """
        # 색상 결정 (화면 로직)
        color = "green" if profit_rate > 0 else "red"

        # 포맷팅 (화면 로직)
        text = f"{profit_rate:.2f}%"

        # 화면 업데이트 (화면 로직)
        self.view.profit_label.setText(text)
        self.view.profit_label.setStyleSheet(f"color: {color}")
```

---

## 🎓 졸업 테스트

### 다음 중 비즈니스 로직은? (복수 선택)

- [ ] A. "BTC 가격이 9천만원 돌파 시 알림"
- [ ] B. "차트를 캔들스틱으로 표시"
- [ ] C. "볼린저 밴드 상단 돌파 시 매도"
- [ ] D. "업비트 WebSocket으로 실시간 시세 수신"
- [ ] E. "잔고의 20%만 한 종목에 투자"
- [ ] F. "전략 목록을 테이블에 정렬해서 표시"
- [ ] G. "이동평균 = 최근 N개 가격의 합 ÷ N"
- [ ] H. "DB에서 과거 캔들 데이터 조회"

<details>
<summary>정답 확인</summary>

**✅ 비즈니스 로직:**

- A. "BTC 가격이 9천만원 돌파 시 알림" (판단 규칙)
- C. "볼린저 밴드 상단 돌파 시 매도" (거래 규칙)
- E. "잔고의 20%만 한 종목에 투자" (리스크 관리 규칙)
- G. "이동평균 = 최근 N개 가격의 합 ÷ N" (계산식)

**❌ 비즈니스 로직 아님:**

- B. "차트를 캔들스틱으로 표시" (Presentation - 화면 표시)
- D. "업비트 WebSocket으로 실시간 시세 수신" (Infrastructure - 외부 연결)
- F. "전략 목록을 테이블에 정렬해서 표시" (Presentation - 화면 표시)
- H. "DB에서 과거 캔들 데이터 조회" (Infrastructure - DB 조회)

</details>

---

## ✅ 핵심 정리

### 비즈니스 로직 = 다음 중 하나

1. **거래 규칙** - "언제 사고 팔 것인가?"
2. **계산식** - "수익률, 지표는 어떻게 계산하나?"
3. **검증 규칙** - "이 주문/전략이 유효한가?"
4. **상태 판단** - "지금 과매수인가? 수익 중인가?"

### 비즈니스 로직 ≠ 다음 것들

1. **화면 관련** - 색상, 정렬, 버튼, 레이아웃
2. **외부 연결** - API 호출, DB 저장, 파일 읽기
3. **시나리오** - "버튼 누르면 → 조회 → 계산 → 표시"

### 실전 팁

```
💡 "만약 업비트가 아니라 바이낸스로 바뀌어도 이 규칙은 동일한가?"
   YES → 비즈니스 로직
   NO → 비즈니스 로직 아님

💡 "만약 PyQt6가 아니라 웹으로 바뀌어도 이 규칙은 동일한가?"
   YES → 비즈니스 로직
   NO → 비즈니스 로직 아님
```

---

## 📖 다음 학습

비즈니스 로직을 이해했다면:

1. **learning/L01_DDD란_무엇인가.md** - DDD 전체 구조 이해
2. **learning/L04_Domain_쉽게_이해하기.md** - 비즈니스 로직이 사는 곳
3. **guides/01_어디에_무엇을_만들까.md** - 실전 판단 연습

---

**문서 버전:** v1.0
**최종 수정:** 2025-10-02
**작성자:** GitHub Copilot (Claude Sonnet 4)
