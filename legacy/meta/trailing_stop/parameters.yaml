# ═══════════════════════════════════════════════════════════════
# 🎯 META_TRAILING_STOP (트레일링 스탑) - 매개변수 정의
# ═══════════════════════════════════════════════════════════════
# 대응 테이블: tv_variable_parameters
# 지표 ID: META_TRAILING_STOP
# ═══════════════════════════════════════════════════════════════

# 매개변수 목록
parameters:
  # ─────────────────────────────────────────────────────────────
  # 📊 계산 방식 (Calculation Method) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  calculation_method:
    # 기본 정보
    parameter_name: "calculation_method"
    parameter_type: "enum"
    default_value: "percentage_of_tracked"
    is_required: true

    # 선택 옵션
    enum_values:
      - "average_price_percent"      # 평단값 퍼센트포인트 (%p)
      - "entry_price_percent"        # 진입값 퍼센트포인트 (%p)
      - "static_value_offset"        # 정적차이 (원화/수치)
      - "percentage_of_tracked"      # 극값 비율퍼센트 (%)

    # 표시 정보
    display_name_ko: "계산 방식"
    display_name_en: "Calculation Method"
    description: "트레일링 스탑 계산 방식 선택"
    display_order: 1

    # UI 매핑
    display_mapping:
      "average_price_percent": "평단가 대비 %p"
      "entry_price_percent": "진입가 대비 %p"
      "static_value_offset": "정적 차이값"
      "percentage_of_tracked": "극값 대비 %"

  # ─────────────────────────────────────────────────────────────
  # 📈 추적 기본변수 (Tracked Variable) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  tracked_variable:
    # 기본 정보
    parameter_name: "tracked_variable"
    parameter_type: "enum"
    default_value: "CURRENT_PRICE"
    is_required: true

    # 선택 옵션
    enum_values:
      - "CURRENT_PRICE"
      - "RSI"
      - "MACD"
      - "BOLLINGER_UPPER"
      - "BOLLINGER_LOWER"
      - "SMA_20"
      - "EMA_12"

    # 표시 정보
    display_name_ko: "추적 기본변수"
    display_name_en: "Tracked Variable"
    description: "트레일링할 기본 변수 선택"
    display_order: 2

    # UI 매핑
    display_mapping:
      "CURRENT_PRICE": "현재가"
      "RSI": "RSI 지표"
      "MACD": "MACD 지표"
      "BOLLINGER_UPPER": "볼린저 상단"
      "BOLLINGER_LOWER": "볼린저 하단"
      "SMA_20": "20일 단순이평선"
      "EMA_12": "12일 지수이평선"

  # ─────────────────────────────────────────────────────────────
  # 💰 계산값 (Value) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  value:
    # 기본 정보
    parameter_name: "value"
    parameter_type: "decimal"
    default_value: "-2.0"
    is_required: true

    # 제약 조건
    min_value: "-50.0"
    max_value: "50.0"

    # 표시 정보
    display_name_ko: "계산값"
    display_name_en: "Value"
    description: "계산에 사용될 값 (음수: 하락 조건, 양수: 상승 조건)"
    display_order: 3

  # ─────────────────────────────────────────────────────────────
  # 🎯 추적 방향 (Trail Direction) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  trail_direction:
    # 기본 정보
    parameter_name: "trail_direction"
    parameter_type: "enum"
    default_value: "down"
    is_required: true

    # 선택 옵션
    enum_values:
      - "up"      # 상향 추적 (고점 추적)
      - "down"    # 하향 추적 (저점 추적)

    # 표시 정보
    display_name_ko: "추적 방향"
    display_name_en: "Trail Direction"
    description: "트레일링 방향 설정"
    display_order: 4

    # UI 매핑
    display_mapping:
      "up": "상향 추적 (고점→하락신호)"
      "down": "하향 추적 (저점→상승신호)"

# ─────────────────────────────────────────────────────────────
# 📝 매개변수 조합 규칙
# ─────────────────────────────────────────────────────────────
parameter_validation:
  # 조합 규칙
  combination_rules:
    - name: "calculation_method_value_matching"
      description: "계산 방식에 따른 적절한 값 범위"
      rule: "percentage methods should use values between -100 and 100"

    - name: "direction_value_logic"
      description: "방향과 값의 논리적 일치성"
      rule: "up direction typically uses negative values, down uses positive"

  # 경고 조건
  warnings:
    - condition: "abs(value) > 20"
      message: "너무 큰 값은 신호가 발생하지 않을 수 있습니다"

    - condition: "tracked_variable != 'CURRENT_PRICE' and calculation_method in ['average_price_percent', 'entry_price_percent']"
      message: "가격 기준 계산은 현재가 추적시 권장됩니다"

# ─────────────────────────────────────────────────────────────
# 🎨 UI 표시 설정
# ─────────────────────────────────────────────────────────────
ui_settings:
  parameter_layout: "vertical"

  calculation_method:
    widget_type: "combobox"
    group_separator: true
    groups:
      price_based: ["average_price_percent", "entry_price_percent"]
      value_based: ["static_value_offset", "percentage_of_tracked"]

  tracked_variable:
    widget_type: "combobox"
    group_separator: true
    groups:
      price: ["CURRENT_PRICE"]
      indicators: ["RSI", "MACD"]
      bands: ["BOLLINGER_UPPER", "BOLLINGER_LOWER"]
      moving_averages: ["SMA_20", "EMA_12"]

  value:
    widget_type: "doublespinbox"
    step_size: 0.1
    suffix_by_method:
      "average_price_percent": "%p"
      "entry_price_percent": "%p"
      "static_value_offset": "원"
      "percentage_of_tracked": "%"

  trail_direction:
    widget_type: "radiobutton"
    layout: "horizontal"
  # ═══════════════════════════════════════════════════════════
  # 🎯 UnifiedParameter 구조 - 외부 제어형 상태 변수 지원
  # ═══════════════════════════════════════════════════════════

  # ─────────────────────────────────────────────────────────────
  # 📊 계산 방식 (Calculation Method) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  - name: "calculation_method"
    type: "enum"
    default_value: "percentage_of_tracked"
    required: true
    min_value: null
    max_value: null
    enum_values:
      - "average_price_percent"      # 평단값 퍼센트포인트 (%p) - 평단가 기준
      - "entry_price_percent"        # 진입값 퍼센트포인트 (%p) - 진입가 기준
      - "static_value_offset"        # 정적차이 (원화/수치) - 절대값 차이
      - "percentage_of_tracked"      # 극값 비율퍼센트 (%) - 최고/최저점 대비
    display_name: "계산 방식"
    description: "트레일링 스탑 계산 방식 (평단가%p/진입가%p/정적차이/극값비율%)"
    display_order: 1

  # ─────────────────────────────────────────────────────────────
  # 📈 추적 기본변수 (Tracked Variable) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  - name: "tracked_variable"
    type: "enum"
    default_value: "CURRENT_PRICE"
    required: true
    min_value: null
    max_value: null
    enum_values:
      - "CURRENT_PRICE"     # 현재가 (실시간)
      - "RSI"               # RSI 지표
      - "MACD"              # MACD 지표
      - "BOLLINGER_UPPER"   # 볼린저 상단
      - "BOLLINGER_LOWER"   # 볼린저 하단
      - "SMA_20"            # 20일 단순이평선
      - "EMA_12"            # 12일 지수이평선
    display_name: "추적 기본변수"
    description: "트레일링할 기본 변수 선택 (현재가, 지표 등)"
    display_order: 2

  # ─────────────────────────────────────────────────────────────
  # � 계산값 (Value) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  - name: "value"
    type: "decimal"
    default_value: "-2.0"
    required: true
    min_value: "-50.0"
    max_value: "50.0"
    enum_values: null
    display_name: "계산값"
    description: "계산에 사용될 값 (퍼센트: -2.0=-2%, 원화: 1000=1000원)"
    display_order: 3

  # ─────────────────────────────────────────────────────────────
  # 🎯 추적 방향 (Trail Direction) - 필수 매개변수
  # ─────────────────────────────────────────────────────────────
  - name: "trail_direction"
    type: "enum"
    default_value: "down"
    required: true
    min_value: null
    max_value: null
    enum_values:
      - "up"      # 상향 추적 (고점 추적, 하락 시 신호)
      - "down"    # 하향 추적 (저점 추적, 상승 시 신호)
    display_name: "추적 방향"
    description: "트레일링 방향 (UP: 고점추적→하락신호, DOWN: 저점추적→상승신호)"
    display_order: 4

  # ─────────────────────────────────────────────────────────────
  # ⚠️ 타임프레임 (Timeframe) - 추적변수 따름 (정보용)
  # ─────────────────────────────────────────────────────────────
  - name: "timeframe"
    type: "enum"
    default_value: "follow_tracked_variable"
    required: false
    min_value: null
    max_value: null
    enum_values:
      - "follow_tracked_variable"    # 추적 변수의 타임프레임 따름 (기본)
      - "realtime"                   # 실시간 (현재가용)
    display_name: "타임프레임"
    description: "추적 변수의 타임프레임을 따름 (별도 설정 불필요)"
    display_order: 5
