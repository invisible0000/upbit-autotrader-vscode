물론입니다. UI를 논하기 전, 시스템의 가장 근본적인 단위인 '전략 컴포넌트'를 명확히 정의하는 것은 매우 중요하고 올바른 접근 방식입니다. 제시해주신 구조를 바탕으로, 이전 논의에서 제안된 아키텍처와 완벽하게 호환되면서도, LLM이 이해하고 코드로 구현할 수 있을 만큼 정교하고 체계적인 **전략의 원자적 구성 요소 설계 문서**를 완성해 드리겠습니다.

이 문서는 모든 매매 아이디어를 표준화된 '레고 블록'으로 분해하여, 어떤 복잡한 전략이라도 이 블록들을 조립하여 만들 수 있도록 하는 것을 목표로 합니다.

---

## **자동매매 시스템의 원자적 구성 요소 설계: 전략의 해부학**

### **서론: 전략의 원자적 분해**

모든 복잡한 매매 전략은 결국 더 작은, 재사용 가능한 논리적 단위들의 조합으로 이루어집니다. 이 문서에서는 하나의 완성된 전략을 구성하는 가장 작은 단위부터 계층적으로 정의하여, 시스템의 유연성과 확장성을 극대화하는 데이터 모델을 설계합니다. 이 모델은 **"무엇을 볼 것인가(변수) → 어떤 상황인가(조건) → 무엇을 할 것인가(액션) → 이들을 어떻게 묶을 것인가(규칙) → 규칙들을 어떻게 조합할 것인가(전략)"** 라는 명확한 흐름을 따릅니다.

---

### **계층 1: 변수 (Variable) - "무엇을 볼 것인가?"**

'변수'는 시스템이 판단의 근거로 삼는 모든 데이터 포인트를 의미합니다. 이는 사용자가 언급한 '대상'에 해당하며, 시스템이 접근할 수 있는 모든 정량적 정보를 포함합니다.

| 속성 | 설명 | 예시 |
| :--- | :--- | :--- |
| **ID** | 변수를 식별하는 고유한 시스템 이름 | `indicator.rsi`, `price.close`, `state.profit_percent` |
| **이름** | UI에 표시될 사용자 친화적 이름 | "RSI 지표", "현재가", "현재 수익률(%)" |
| **종류** | 변수의 출처를 구분하는 카테고리 | `지표`, `가격`, `상태`, `시간` |
| **파라미터** | 변수 계산에 필요한 설정값 (JSON 형태) | `{"period": 14}`, `{"atr_multiplier": 2}` |
| **반환값** | 변수가 제공하는 데이터의 형태 | 숫자(Scalar), 시계열(Series), 객체(Object) |
| **설명** | 변수에 대한 상세 설명 | "지정된 기간(period)의 상대강도지수" |

---

### **계층 2: 조건 (Condition) - "어떤 상황인가?"**

'조건'은 하나 또는 두 개의 '변수'를 논리적으로 비교하여 참(True) 또는 거짓(False)을 반환하는 명제입니다. 이는 사용자가 언급한 '트리거'의 핵심 로직에 해당합니다.

| 속성 | 설명 | 예시 |
| :--- | :--- | :--- |
| **ID** | 조건을 식별하는 고유 ID | `cond_rsi_oversold`, `cond_price_cross_sma` |
| **이름** | UI에 표시될 사용자 친화적 이름 | "RSI 과매도 진입", "가격이 이평선 상향 돌파" |
| **변수 A** | 비교의 주체가 되는 변수의 ID | `indicator.rsi` |
| **연산자** | 비교 방식을 정의하는 연산자 | `>`, `<`, `==`, `crosses_above`, `crosses_below` |
| **비교 대상** | 비교의 객체. 고정값이거나 다른 변수의 ID | `30` (고정값), `indicator.sma_20` (다른 변수) |
| **설명** | 조건이 어떤 상황을 판단하는지에 대한 설명 | "RSI(14) 값이 30 미만인가?" |

---

### **계층 3: 액션 (Action) - "무엇을 할 것인가?"**

'액션'은 조건이 충족되었을 때 시스템이 수행해야 할 구체적인 행동을 정의합니다. 이는 사용자가 언급한 '매수/매도'의 실행 계획에 해당합니다.

| 속성 | 설명 | 예시 |
| :--- | :--- | :--- |
| **ID** | 액션을 식별하는 고유 ID | `action_buy_full_equity`, `action_sell_half_position` |
| **이름** | UI에 표시될 사용자 친화적 이름 | "가용 현금 전량 매수", "보유 포지션 50% 매도" |
| **행동 유형** | 수행할 행동의 종류 | `BUY`, `SELL`, `EXIT_ALL` (전량 청산) |
| **수량 계산 규칙** | 주문 수량을 결정하는 방식 | `PERCENT_EQUITY` (총자산 대비), `PERCENT_POSITION` (포지션 대비), `FIXED_AMOUNT` (고정 금액), `FIXED_QUANTITY` (고정 수량) |
| **수량 파라미터** | 수량 계산 규칙에 사용될 값 | `1.0` (100%), `0.5` (50%), `100000` (10만원), `0.1` (0.1개) |
| **설명** | 액션이 어떤 주문을 생성하는지에 대한 설명 | "현재 가용 현금의 100%를 사용하여 시장가 매수 주문을 생성한다." |

---

### **계층 4: 규칙 (Rule) - "상황과 행동을 어떻게 묶을 것인가?"**

'규칙'은 시스템의 가장 중요한 논리적 단위로, **"만약 어떤 조건(들)이 충족되면, 어떤 액션을 취하라"**는 하나의 완전한 'IF-THEN' 문장입니다. 이는 여러 '조건'을 `AND` 또는 `OR`로 조합하는 역할을 합니다.

| 속성 | 설명 | 예시 |
| :--- | :--- | :--- |
| **ID** | 규칙을 식별하는 고유 ID | `rule_oversold_entry`, `rule_trailing_stop_exit` |
| **이름** | UI에 표시될 사용자 친화적 이름 | "과매도 진입 규칙", "트레일링 스탑 청산 규칙" |
| **역할 (Role)** | 시스템 상태 관리를 위한 역할 구분 | `ENTRY` (진입), `EXIT` (청산), `SCALE_IN` (추가 매수), `RISK_FILTER` (진입 필터) |
| **조건부** | 이 규칙을 발동시키는 `조건` ID들의 리스트 | `['cond_rsi_oversold', 'cond_bb_lower_break']` |
| **논리 조합** | 조건들을 어떻게 결합할지 정의 | `AND`, `OR` |
| **액션** | 조건 충족 시 실행할 `액션`의 ID | `action_buy_full_equity` |
| **설명** | 규칙의 전체 논리를 자연어로 설명 | "만약 RSI가 과매도 상태이고 AND 가격이 볼린저밴드 하단을 하향 돌파하면, THEN 가용 현금 전량을 매수하라." |

---

### **계층 5: 전략 (Strategy) - "규칙들을 어떻게 조합할 것인가?"**

'전략'은 하나의 완전한 매매 시나리오를 구성하기 위한 '규칙'들의 묶음입니다. 예를 들어, 하나의 진입 규칙과 두 개의 다른 청산 규칙(익절, 손절)을 묶어 하나의 '전략'을 만들 수 있습니다.

| 속성 | 설명 | 예시 |
| :--- | :--- | :--- |
| **ID** | 전략을 식별하는 고유 ID | `strat_mean_reversion_v1` |
| **이름** | UI에 표시될 사용자 친화적 이름 | "평균 회귀 전략 v1.2" |
| **구성 규칙** | 이 전략을 구성하는 `규칙` ID들의 리스트 | `['rule_oversold_entry', 'rule_take_profit_exit', 'rule_stop_loss_exit']` |
| **설명** | 이 전략의 전체적인 목표와 컨셉 설명 | "과매도 구간에서 진입하여, 목표 수익률 도달 시 익절하거나 최대 손실 도달 시 손절하는 역추세 매매 전략" |

---

### **계층 6: 포지션 관리자 (Position Manager) - "전략을 사용하여 거래를 지휘"**

'포지션 관리자'는 이 모든 구성 요소를 사용하여 실제 거래의 생명주기를 관리하는 최상위 지휘자입니다. 이는 데이터 객체가 아닌, 시스템의 '두뇌' 컴포넌트입니다.

*   **책임:**
    1.  **상태 관리:** 현재 포지션 유무(`IDLE`, `IN_POSITION`)를 추적합니다.
    2.  **규칙 활성화/비활성화:** 현재 상태에 따라 적절한 '역할(Role)'을 가진 규칙들만 활성화합니다. (예: `IDLE` 상태에서는 `ENTRY` 규칙만, `IN_POSITION` 상태에서는 `EXIT` 규칙만 활성화)
    3.  **최종 결정:** 활성화된 규칙들로부터 발생한 여러 액션 제안들을 받아, 사전에 정의된 조합 규칙(예: 우선순위, 가중치 합산)에 따라 최종적으로 실행할 단 하나의 액션을 결정합니다.

---

### **사용자 예시의 재구성**

사용자가 제시한 예시: `매수1(...) [트리거1(...)] and [트리거2(...)]`를 위 설계에 따라 재구성하면 다음과 같습니다.

1.  **정의될 변수 (Variables):**
    *   `ID: indicator.rsi`, `파라미터: {"period": 14}`
    *   `ID: indicator.bollinger_bands`, `파라미터: {"period": 20, "std": 2}`
    *   `ID: price.close`

2.  **정의될 조건 (Conditions):**
    *   `ID: cond_rsi_lt_20`, `변수 A: indicator.rsi`, `연산자: <`, `비교 대상: 20`
    *   `ID: cond_price_lt_bb_lower`, `변수 A: price.close`, `연산자: <`, `비교 대상: indicator.bollinger_bands.lower`

3.  **정의될 액션 (Action):**
    *   `ID: action_buy_all_cash`, `행동 유형: BUY`, `수량 계산 규칙: PERCENT_EQUITY`, `수량 파라미터: 1.0`

4.  **정의될 규칙 (Rule):**
    *   `ID: rule_bb_rsi_entry`
    *   `이름:` "볼린저밴드 및 RSI 과매도 진입"
    *   `역할:` `ENTRY`
    *   `조건부:` `['cond_rsi_lt_20', 'cond_price_lt_bb_lower']`
    *   `논리 조합:` `AND`
    *   `액션:` `action_buy_all_cash`

5.  **정의될 전략 (Strategy):**
    *   `ID: strat_dual_oversold_entry`
    *   `이름:` "이중 과매도 지표 진입 전략"
    *   `구성 규칙:` `['rule_bb_rsi_entry',... (여기에 청산 규칙들이 추가될 수 있음)]`

이처럼 모든 매매 아이디어를 원자적 단위로 분해하고 체계적으로 조립하는 구조를 통해, 복잡하고 모호했던 전략 관리 문제를 명확하고 확장 가능한 엔지니어링 문제로 전환할 수 있습니다.